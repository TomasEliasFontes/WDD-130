module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=51)}([function(e,t){e.exports=require("vscode")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTruthy=function(e){return!!e},t.parseDate=function(e){const t=/(\d{4})\/(\d{2})\/(\d{2})(?: (\d{2}):(\d{2}):(\d{2}))?/.exec(e.trim());if(t){const[,e,i,n,r,o,s]=t,a=r&&o&&s;return new Date(parseInt(e),parseInt(i)-1,parseInt(n),a?parseInt(r):void 0,a?parseInt(o):void 0,a?parseInt(s):void 0)}},t.pluralise=function(e,t,i,n){const r=e===i;return e+(r?"+ ":" ")+(1!==e||r?n||t+"s":t)},t.isPositiveOrZero=function(e){const t=parseInt(e);return!isNaN(t)&&t>=0},t.dedupe=function(e,t){const i=new Set;return e.filter(e=>!i.has(e[t])&&i.add(e[t]))},t.addUniqueKeysToSet=function(e,t,i){return t.filter(t=>!e.has(t[i])&&e.add(t[i]))},t.splitBy=function(e,t){const i=new Map;return e.forEach(e=>{var n;const r=t(e);i.get(r)||i.set(r,[]),null===(n=i.get(r))||void 0===n||n.push(e)}),[...i.values()]}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(3));function s(e){return e.fragment}function a(e){return e?e.startsWith("@")?e:"#"+e:""}function c(e){const t=w(e.query).authority,i="null"===t?"":null!=t?t:e.authority;return e.with({authority:i})}function l(e){return c(e).fsPath}function u(e,t){var i,n;const r=w(e.query),o=null!==(n=null!==(i=r.authority)&&void 0!==i?i:e.authority)&&void 0!==n?n:"";return e.with({authority:a(t),fragment:t,query:v({...r,authority:o||"null"})})}function h(e){var t;return"//"+(null!==(t=w(e.query).depotName)&&void 0!==t?t:e.authority)+c(e).path}function d(e,t){return!!w(e.query)[t]}function p(e){return d(e,"depot")}function f(e){const t=w(e.query).workspace;return t?r.Uri.file(t):void 0}function m(e){return!p(e)&&e.fsPath&&"/Command_Output"!==e.fsPath?r.Uri.file(c(e).fsPath):f(e)}function g(e,t){return e.with({scheme:"perforce",query:v({command:"print",p4Args:"-q",...w(e.query),...t})})}function v(e){return Object.entries(e).filter(e=>!!e[1]).map(e=>{return t=e[0],void 0!==(i=e[1])&&"string"==typeof i?encodeURIComponent(t)+"="+encodeURIComponent(i):void 0===i||i?encodeURIComponent(t):void 0;var t,i}).filter(e=>!!e).join("&")}function w(e){var t;const i=null!==(t=null==e?void 0:e.split("&"))&&void 0!==t?t:[],n={};return i.forEach(e=>{const t=e.split("="),i=decodeURIComponent(t[0]),r=!t[1]||decodeURIComponent(t[1]);n[i]=r}),n}t.isSameFileOrDepotPath=function(e,t){return p(e)&&p(t)?h(e)===h(t):l(e)===l(t)},t.getRevOrAtLabel=s,t.revOrLabelAsSuffix=a,t.emptyFileUri=function(){return r.Uri.parse("perforce:/EMPTY")},t.fsPathWithoutRev=l,t.basenameWithoutRev=function(e){return o.basename(l(e))},t.basenameWithRev=function(e,t){return o.basename(l(e))+a(null!=t?t:s(e))},t.getDepotPathFromDepotUri=h,t.parse=function(e){return r.Uri.parse(e)},t.fromDepotPath=function(e,t,i){var n;const o=u(r.Uri.parse("perforce:"+t),i),s=t.split("/")[2];return g(o,{depot:!0,workspace:(null!==(n=m(e))&&void 0!==n?n:e).fsPath,depotName:s,rev:i})},t.isDepotUri=p,t.isUsableForWorkspace=function(e){return!p(e)&&!!e.fsPath||d(e,"workspace")},t.getWorkspaceFromQuery=f,t.getUsableWorkspace=m,t.forCommand=function(e,t,i){return g(r.Uri.parse("perforce:/Command_Output"),{command:t,p4Args:i,workspace:e.fsPath})},t.fromUri=g,t.fromUriWithRevision=function(e,t){return u(g(c(e),{rev:t}),t)},t.withArgs=function(e,t,i){const n=w(e.query),r=v(void 0!==i?{...n,...t,rev:i}:{...n,...t});return void 0!==i?u(c(e).with({query:r}),i):e.with({query:r})},t.encodeQuery=v,t.decodeUriQuery=w},function(e,t){e.exports=require("path")},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(34),s=n(i(6)),a=n(i(2)),c=i(1);let l;var u;!function(e){e.OPEN="OPEN",e.NOT_OPEN="NOT_OPEN",e.NOT_IN_WORKSPACE="NOT_IN_WORKSPACE"}(u=t.ActiveEditorStatus||(t.ActiveEditorStatus={})),function(e){let t;e.channel=r.window.createOutputChannel("Perforce Log");const i=new r.EventEmitter;e.onActiveFileStatusKnown=i.event;const n=new r.EventEmitter;e.onActiveFileStatusCleared=n.event;let h=!1;function d(){e.channel.show()}async function p(){return(await r.env.clipboard.readText()).trim()}e.updateEditor=o.debounce((async function(){if(!h)return;const e=r.window.activeTextEditor;if(!e)return void(l&&l.hide());const n=e.document;if(n.isUntitled||""===n.uri.fsPath)l.hide();else{let e,r=u.NOT_IN_WORKSPACE;try{const t=await s.getOpenedFileDetails(n.uri,{files:[n.uri]});if(t.open.length>0)l.text="P4: $(check)",l.tooltip=t.open[0].message,r=u.OPEN,e=t.open[0];else if(t.unopen.length>0){const e=t.unopen[0].reason===s.UnopenedFileReason.NOT_OPENED;l.text=e?"P4: $(file-text)":"P4: $(circle-slash)",l.tooltip=t.unopen[0].message,r=e?u.NOT_OPEN:u.NOT_IN_WORKSPACE}else l.text="P4: $(circle-slash)",l.tooltip="unknown",r=u.NOT_IN_WORKSPACE}catch(e){l.text="P4: $(circle-slash)",l.tooltip=e.toString(),r=u.NOT_IN_WORKSPACE}t={file:n.uri,status:r,details:e},i.fire(t)}}),1e3,()=>{var e;h&&(t=void 0,n.fire(null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri),l&&(l.show(),l.text="P4: $(sync~spin)",l.tooltip="Checking file status"))}),e.initialize=function(t){t.push(r.commands.registerCommand("perforce.showOutput",d)),t.push(e.channel),l=r.window.createStatusBarItem(r.StatusBarAlignment.Left,Number.MIN_VALUE),l.command="perforce.menuFunctions",t.push(l),t.push(i),t.push(n),t.push(r.window.onDidChangeActiveTextEditor(e.updateEditor)),e.updateEditor()},e.getLastActiveFileStatus=function(){return t},e.activateStatusBar=function(){h||(h=!0,e.updateEditor())},e.isSameAsOpenFile=async function(t){var i;const n=null===(i=r.window.activeTextEditor)||void 0===i?void 0:i.document.uri;return!!n&&(a.isSameFileOrDepotPath(t,n)||function(t){var i,n,o;if(!(null===(i=r.window.activeTextEditor)||void 0===i?void 0:i.document.uri)||!a.isDepotUri(t))return!1;const s=null===(o=null===(n=e.getLastActiveFileStatus())||void 0===n?void 0:n.details)||void 0===o?void 0:o.depotPath;return s&&s===a.getDepotPathFromDepotUri(t)}(t)||await async function(e){var t;const i=null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document.uri;if(!i||!a.isDepotUri(e))return!1;const n=await s.have(i,{file:i});return!!n&&n.depotPath===a.getDepotPathFromDepotUri(e)}(t))},e.showMessage=function(t){r.window.setStatusBarMessage("Perforce: "+t.replace(/\r?\n/g," "),3e3),e.channel.append(t+"\n")},e.showModalMessage=function(e){r.window.showInformationMessage(e,{modal:!0})},e.requestConfirmation=async function(e,t){return await r.window.showWarningMessage(e,{modal:!0},t)===t},e.showError=function(t){r.window.setStatusBarMessage("Perforce: "+t.replace(/\r?\n/g," "),3e3),e.channel.appendLine("ERROR: "+JSON.stringify(t))},e.showImportantError=function(t){r.window.showErrorMessage(t),e.channel.appendLine("ERROR: "+JSON.stringify(t))},e.doLoginFlow=async function(t){let i=await s.isLoggedIn(t);if(i)e.showMessage("Login successful"),e.updateEditor(),i=!0;else{const n=await r.window.showInputBox({prompt:"Enter password",password:!0});if(n)try{await s.login(t,{password:n}),e.showMessage("Login successful"),e.updateEditor(),i=!0}catch{}}return i},e.doLogoutFlow=async function(t){try{return await s.logout(t,{}),e.showMessage("Logout successful"),e.updateEditor(),!0}catch{}return!1},e.requestChangelistNumber=async function(){const e=await p(),t=c.isPositiveOrZero(e)?e:void 0;return await r.window.showInputBox({placeHolder:"Changelist number",prompt:"Enter a changelist number",value:t,validateInput:e=>{if(!c.isPositiveOrZero(e))return"must be a positive number"}})},e.requestJobId=async function(){const e=await p(),t=/^[a-zA-Z]+[0-9]+[a-zA-Z0-9]*$/.test(e)?e:void 0;return await r.window.showInputBox({placeHolder:"job00000n",prompt:"Enter a job",value:t})}}(t.Display||(t.Display={}))},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(22),o=i(35),s=n(i(2)),a=i(21),c=i(4),l=i(1);function u(e,t){return e.flatMap(e=>function(e,t){const i="-"+e;return"string"==typeof t?[i,t]:"number"==typeof t?[i,t.toString()]:t?[i]:[]}(e[0],e[1])).concat(...null!=t?t:[])}t.removeLeadingNewline=e=>e.replace(/^\r*?\n/,""),t.splitIntoLines=e=>e.split(/\r*?\n/),t.splitIntoSections=e=>e.split(/\r*?\n\r*?\n/),t.removeIndent=e=>e.map(e=>e.replace(/^\t/,"")),t.extractSection=function(e,t,i){const n=e.findIndex(t);if(n>=0){const t=e.findIndex(i);return e.slice(n+1,t>=0?t:void 0)}},t.sectionArrayBy=function(e,t){const i=[];let n=e.findIndex(t),r=-1;for(;n>r;)r=n,n=e.slice(r+1).findIndex(t)+r+1,i.push(e.slice(r,n>r?n:void 0));return i},t.splitIntoChunks=e=>{return(t=32,e=>{const i=[];for(let n=0;n<e.length;n+=t)i.push(e.slice(n,n+t));return i})(e);var t},t.applyToEach=function(e){return t=>t.map(t=>e(t))},t.concatIfOutputIsDefined=function(...e){return t=>e.reduce((e,i)=>{const n=i(t);return void 0!==n?e.concat([n]):e},[])},t.makeFlags=u,t.flagMapper=function(e,t,i,n){return r=>(null!=i?i:[]).concat(u(e.map(e=>[e[0],r[e[1]]]),t?function(e,t){if("boolean"!=typeof e)return"string"==typeof e?[e]:"number"==typeof e?[e.toString()]:o.isUri(e)?[p(e,null==t?void 0:t.ignoreRevisionFragments)]:(null==t?void 0:t.lastArgIsFormattedArray)?e:f(e,t)}(r[t],n):void 0))};const h=e=>null==e?void 0:e.filter(l.isTruthy);function d(e,t){return t?"":s.revOrLabelAsSuffix(e)}function p(e,t){return s.isDepotUri(e)?s.getDepotPathFromDepotUri(e)+d(s.getRevOrAtLabel(e),t):r.Utils.expansePath(s.fsPathWithoutRev(e))+d(s.getRevOrAtLabel(e),t)}function f(e,t){var i;return null!==(i=null==e?void 0:e.map(e=>o.isUri(e)?p(e,null==t?void 0:t.ignoreRevisionFragments):e||void 0))&&void 0!==i?i:[]}function m(e,t,i,n){return g(e,t,i,{stdErrIsOk:!0,hideStdErr:n})}async function g(e,t,i,n){const{input:r,hideStdErr:o,stdErrIsOk:s,useTerminal:a,logStdOut:l}=n;try{const[n,u]=await v(e,t,i,r,a,l);if(u&&(o?c.Display.channel.appendLine(u.toString()):c.Display.showError(u.toString()),!s))throw u;return n}catch(e){throw c.Display.showError(e.toString()),e}}function v(e,t,i,n,r,o){return new Promise((s,l)=>a.PerforceService.execute(e,t,(e,t,i)=>{o&&t&&c.Display.channel.appendLine("< "+t),e?l(e):s([t,i])},i,n,r))}t.fragmentAsSuffix=d,t.pathsToArgs=f,t.runPerforceCommandIgnoringStdErr=m,t.runPerforceCommand=g,t.mergeAll=function(...e){return e.reduce((e,t)=>({...e,...t}))},t.makeSimpleCommand=function(e,t,i){const n=(n,r,o)=>{var s;return g(n,e,h(t(r)),function(...e){return e.reduce((e,t)=>({...t,...e}))}(null!=o?o:{},null!==(s=null==i?void 0:i(r))&&void 0!==s?s:{}))};return n.raw=(i,n)=>v(i,e,h(t(n))),n.ignoringStdErr=(i,n)=>m(i,e,h(t(n))),n.ignoringAndHidingStdErr=(i,n)=>m(i,e,h(t(n)),!0),n},t.asyncOuputHandler=function(e,t){return async(...i)=>t(await e(...i))}},function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(52)),n(i(53)),n(i(54)),n(i(61)),n(i(62)),n(i(63)),n(i(64)),n(i(65)),n(i(66)),n(i(67)),n(i(68)),n(i(69)),n(i(70)),n(i(35))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);var r,o,s;!function(e){e[e.SHOW_ALL=0]="SHOW_ALL",e[e.HIDE_FILES=1]="HIDE_FILES",e[e.HIDE_CHANGELISTS=2]="HIDE_CHANGELISTS",e[e.HIDE_CHANGELISTS_AND_DEFAULT_FILES=3]="HIDE_CHANGELISTS_AND_DEFAULT_FILES"}(r=t.HideNonWorkspace||(t.HideNonWorkspace={})),function(e){e[e.SWAP=0]="SWAP",e[e.KEEP_BOTH=1]="KEEP_BOTH",e[e.PROMPT=2]="PROMPT"}(o=t.FileShelveMode||(t.FileShelveMode={})),function(e){e[e.WHOLE_CLIENT=0]="WHOLE_CLIENT",e[e.WORKSPACE_ONLY=1]="WORKSPACE_ONLY"}(s=t.SyncMode||(t.SyncMode={}));class a{constructor(){}getConfigItem(e){return n.workspace.getConfiguration("perforce").get(e)}setConfigItem(e,t){n.workspace.getConfiguration("perforce").update(e,t)}setConfigItemGlobally(e,t){n.workspace.getConfiguration("perforce").update(e,void 0),n.workspace.getConfiguration("perforce").update(e,t,n.ConfigurationTarget.Global)}get changelistOrder(){var e;return null!==(e=this.getConfigItem("changelistOrder"))&&void 0!==e?e:"descending"}get ignoredChangelistPrefix(){return this.getConfigItem("ignoredChangelistPrefix")}get hideNonWorkspaceFiles(){const e=this.getConfigItem("hideNonWorkspaceFiles");if("boolean"==typeof e)return e?r.HIDE_FILES:r.SHOW_ALL;if("string"==typeof e){if("show all files"===e)return r.SHOW_ALL;if("hide changelists, hide files in default changelist"===e)return r.HIDE_CHANGELISTS_AND_DEFAULT_FILES;if(e.startsWith("hide changelists"))return r.HIDE_CHANGELISTS;if(e.startsWith("show all changelists")||"hide non workspace files"===e)return r.HIDE_FILES}return r.SHOW_ALL}get hideEmptyChangelists(){var e;return null!==(e=this.getConfigItem("hideEmptyChangelists"))&&void 0!==e&&e}get hideShelvedFiles(){var e;return null!==(e=this.getConfigItem("hideShelvedFiles"))&&void 0!==e&&e}get maxFilePerCommand(){var e;return null!==(e=this.getConfigItem("maxFilePerCommand"))&&void 0!==e?e:32}get countBadge(){var e;return null!==(e=this.getConfigItem("countBadge"))&&void 0!==e?e:"all-but-shelved"}get promptBeforeSubmit(){var e;return null!==(e=this.getConfigItem("promptBeforeSubmit"))&&void 0!==e&&e}get refreshDebounceTime(){return 1e3}get editOnFileSave(){var e;return null!==(e=this.getConfigItem("editOnFileSave"))&&void 0!==e&&e}get editOnFileModified(){var e;return null!==(e=this.getConfigItem("editOnFileModified"))&&void 0!==e&&e}get addOnFileCreate(){var e;return null!==(e=this.getConfigItem("addOnFileCreate"))&&void 0!==e&&e}get deleteOnFileDelete(){var e;return null!==(e=this.getConfigItem("deleteOnFileDelete"))&&void 0!==e&&e}get resolveP4EDITOR(){return this.getConfigItem("resolve.p4editor")}get swarmHost(){return this.getConfigItem("swarmHost")}getSwarmLink(e){const t=this.swarmHost;if(t)return t.includes("${chnum}")?t.replace("${chnum}",e):t+"/changes/"+e}get changelistSearchMaxResults(){var e;return null!==(e=this.getConfigItem("changelistSearch.maxResults"))&&void 0!==e?e:200}get fileShelveMode(){const e=this.getConfigItem("fileShelveMode");return"keep both"===e?o.KEEP_BOTH:"swap"===e?o.SWAP:o.PROMPT}set fileShelveMode(e){e===o.KEEP_BOTH?this.setConfigItemGlobally("fileShelveMode","keep both"):e===o.SWAP?this.setConfigItemGlobally("fileShelveMode","swap"):e===o.PROMPT&&this.setConfigItemGlobally("fileShelveMode","prompt")}get annotateFollowBranches(){var e;return null!==(e=this.getConfigItem("annotate.followBranches"))&&void 0!==e&&e}get syncMode(){return"workspace only"===this.getConfigItem("syncMode")?s.WORKSPACE_ONLY:s.WHOLE_CLIENT}}t.ConfigAccessor=a,t.configAccessor=new a;t.WorkspaceConfigAccessor=class extends a{constructor(e){super(),this._workspaceUri=e}getWorkspaceConfigItem(e){return n.workspace.getConfiguration("perforce",this._workspaceUri).get(e)}get pwdOverride(){return this.getWorkspaceConfigItem("dir")}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=i(1),s=i(4),a=n(i(2));t.asUri=function(e){return"string"==typeof e?a.parse(e):e};const c=new Map,l=[];let u=[];t.registerQuickPickProvider=function(e,t){c.set(e,t)};const h="$(discard) Go Back";function d(){const e=l[l.length-1];e?(l.pop(),p(e.type,...e.args)):s.Display.showImportantError("No previous quick pick available")}async function p(e,...t){var i,n;const s=c.get(e);if(!s)throw new Error("No registered quick pick provider for type "+e);{const a=await r.window.withProgress({location:r.ProgressLocation.Window,title:"Getting actions for quick pick",cancellable:!1},()=>s.provideActions(...t)),c={type:e,args:t,description:a.placeHolder,recentKey:null!==(i=a.recentKey)&&void 0!==i?i:a.placeHolder};a.excludeFromHistory||function(e){const t=u.findIndex(t=>e.recentKey===t.recentKey);t>=0&&u.splice(t,1),u=[e,...u.slice(0,49)]}(c);const f={label:"$(location) "+a.placeHolder},m=function(){const e=l[l.length-1];return[e?{label:h,description:"to "+e.description,performAction:()=>{d()}}:{label:h,description:"n/a"}].filter(o.isTruthy)}(),g=await r.window.showQuickPick([...m,f,...a.items],{matchOnDescription:!0,matchOnDetail:!0,placeHolder:a.placeHolder});if(g&&!g.performAction)return void await p(e,...t);const v=h!==(null==g?void 0:g.label)&&!a.excludeFromHistory;v&&l.push(c);const w=()=>{v&&l.pop(),p(e,...t)};await(null===(n=null==g?void 0:g.performAction)||void 0===n?void 0:n.call(g,w))}}t.openLastQuickPick=d,t.chooseRecentQuickPick=async function(){const e=u.map(e=>({label:e.description,value:e})),t=await r.window.showQuickPick(e,{placeHolder:"Choose a recent quick pick to open",matchOnDescription:!0});t&&p(t.value.type,...t.value.args)},t.showQuickPick=p,t.toRevString=function(e,t){return e?e+","+t:t},t.makeClipPick=function(e,t){const i=null!=t?t:"";return{label:"$(clippy) Copy "+e+" to clipboard",description:i,performAction:e=>{r.env.clipboard.writeText(i),r.window.setStatusBarMessage("Copied to clipboard"),e()}}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(71),s=i(41),a=i(10),c=i(22),l=i(27),u=i(7),h=n(i(13)),d=n(i(2)),p=n(i(3)),f=i(4);class m{constructor(e){this._clientRoot=e,this.disposables=[],this._contributingDirs=new Set,this._nonContributingDirs=new Set,this._contributingDocs=new Set;const t=r.scm.createSourceControl(this.id,this.label,this._clientRoot.clientRoot);this._model=new o.Model(this._clientRoot.configSource,this._clientRoot.clientName,t),this.disposables.push(this._model,t),m.instances.push(this),m._onDidChangeScmProviders.fire(),this._model._sourceControl.quickDiffProvider={provideOriginalResource:e=>this.provideOriginalResource(e)},this._model._sourceControl.acceptInputCommand={command:"perforce.processChangelist",title:"Process Changelist",arguments:[this._model._sourceControl]},this._model.onDidChange(this.onDidModelChange.bind(this),this,this.disposables),this._model._sourceControl.inputBox.value="",this._model._sourceControl.inputBox.placeholder="Message (press {0} to create changelist)"}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[];const e=m.instances.findIndex(e=>e===this);e>=0&&m.instances.splice(e,1)}get onDidChange(){return c.mapEvent(this._model.onDidChange,()=>this)}get clientRoot(){return this._clientRoot}static get clientRoots(){return this.instances.map(e=>e.clientRoot)}static get onDidChangeScmProviders(){return this._onDidChangeScmProviders.event}get resources(){return this._model.ResourceGroups}get id(){return"perforce"}get label(){return"Perforce"}get count(){const e=u.configAccessor.countBadge,t=this._model.ResourceGroups.flatMap(e=>e.resourceStates);switch(e){case"off":return 0;case"all-but-shelved":return t.filter(e=>e.status!==a.Status.MOVE_DELETE&&!e.isShelved).length;case"all":default:return t.filter(e=>e.status!==a.Status.MOVE_DELETE).length}}get sourceControl(){return this._model._sourceControl}get stateContextKey(){return void 0===r.workspace.workspaceFolders?"norepo":"idle"}async Initialize(){await this._model.RefreshImmediately()}addContributingDir(e){this._contributingDirs.add(e.fsPath)}isInDir(e,t){const i=p.relative(e,t);return!i||!i.startsWith("..")&&!p.isAbsolute(i)}removeContributingDirsUnder(e){this._contributingDirs.forEach(t=>{this.isInDir(e.fsPath,t)&&this._contributingDirs.delete(t)})}addContributingDoc(e){this._contributingDocs.add(e),this._nonContributingDirs.add(p.dirname(e.uri.fsPath))}removeContributingDoc(e){return this._contributingDocs.delete(e)}hasContributingDirFor(e){for(const t of this._contributingDirs)if(this.isInDir(t,e.uri.fsPath))return!0;return!1}hasNonContributingDirFor(e){for(const t of this._nonContributingDirs)if(this.isInDir(t,e.uri.fsPath))return!0;return!1}checkAndAddContributingDoc(e){return!!this._contributingDocs.has(e)||(!!this.hasContributingDirFor(e)||!!this.hasNonContributingDirFor(e)&&(this.addContributingDoc(e),!0))}hasContributors(){return this._contributingDirs.size>0||this._contributingDocs.size>0}static checkAndAddContributingDoc(e){for(const t of this.instances)if(t.checkAndAddContributingDoc(e))return!0;return!1}static removeContributingDirsUnder(e){this.instances.forEach(t=>t.removeContributingDirsUnder(e))}static removeContributingDoc(e){return this.instances.filter(t=>t.removeContributingDoc(e))}static disposeInstancesWithoutContributors(){const e=this.instances.filter(e=>!e.hasContributors());return this.instances=this.instances.filter(e=>e.hasContributors()),e.forEach(e=>e.dispose()),e.length>0&&this._onDidChangeScmProviders.fire(),e}static get instanceCount(){return this.instances.length}static forceClose(e){const t=this.GetInstance(e);t&&(f.Display.channel.appendLine("Closing perforce client "+t.clientRoot.clientName+" @ "+t.clientRoot.clientRoot.fsPath),t.dispose(),this._onDidChangeScmProviders.fire())}static registerCommands(){r.commands.registerCommand("perforce.Refresh",m.Refresh.bind(this)),r.commands.registerCommand("perforce.CleanRefresh",e=>m.Refresh(e,!0)),r.commands.registerCommand("perforce.info",m.Info.bind(this)),r.commands.registerCommand("perforce.Sync",m.Sync.bind(this)),r.commands.registerCommand("perforce.openFile",m.OpenFile.bind(this)),r.commands.registerCommand("perforce.openResource",m.Open.bind(this)),r.commands.registerCommand("perforce.openResourcevShelved",m.OpenvShelved.bind(this)),r.commands.registerCommand("perforce.submitDefault",m.SubmitDefault.bind(this)),r.commands.registerCommand("perforce.processChangelist",m.ProcessChangelist.bind(this)),r.commands.registerCommand("perforce.editChangelist",m.EditChangelist.bind(this)),r.commands.registerCommand("perforce.editChangeSpec",m.EditChangeSpec.bind(this)),r.commands.registerCommand("perforce.newChangeSpec",m.NewChangeSpec.bind(this)),r.commands.registerCommand("perforce.newJobSpec",m.NewJobSpec.bind(this)),r.commands.registerCommand("perforce.describe",m.Describe.bind(this)),r.commands.registerCommand("perforce.submitChangelist",m.Submit.bind(this)),r.commands.registerCommand("perforce.submitSelectedFiles",m.SubmitSelectedFiles.bind(this)),r.commands.registerCommand("perforce.revertChangelist",m.Revert.bind(this)),r.commands.registerCommand("perforce.revertUnchangedChangelist",m.RevertUnchanged.bind(this)),r.commands.registerCommand("perforce.shelveChangelist",m.ShelveChangelist.bind(this)),r.commands.registerCommand("perforce.shelveRevertChangelist",m.ShelveRevertChangelist.bind(this)),r.commands.registerCommand("perforce.unshelveChangelist",m.UnshelveChangelist.bind(this)),r.commands.registerCommand("perforce.deleteShelvedChangelist",m.DeleteShelvedChangelist.bind(this)),r.commands.registerCommand("perforce.shelve",m.Shelve.bind(this)),r.commands.registerCommand("perforce.unshelve",m.Unshelve.bind(this)),r.commands.registerCommand("perforce.deleteShelvedFile",m.DeleteShelvedFile.bind(this)),r.commands.registerCommand("perforce.revertFile",m.Revert.bind(this)),r.commands.registerCommand("perforce.revertUnchangedFile",m.RevertUnchanged.bind(this)),r.commands.registerCommand("perforce.reopenFile",m.ReopenFile.bind(this)),r.commands.registerCommand("perforce.fixJob",m.FixJob.bind(this)),r.commands.registerCommand("perforce.unfixJob",m.UnfixJob.bind(this)),r.commands.registerCommand("perforce.copyChangelistId",m.CopyChangelistId.bind(this)),r.commands.registerCommand("perforce.resolveChangelist",m.ResolveChangelist.bind(this)),r.commands.registerCommand("perforce.reresolveChangelist",m.ReResolveChangelist.bind(this)),r.commands.registerCommand("perforce.resolveFiles",m.ResolveFiles.bind(this)),r.commands.registerCommand("perforce.reresolveFiles",m.ReResolveFiles.bind(this)),r.commands.registerCommand("perforce.loginScm",m.Login.bind(this)),r.commands.registerCommand("perforce.logoutScm",m.Logout.bind(this)),r.commands.registerCommand("perforce.goToChangelist",m.GoToChangelist.bind(this)),r.commands.registerCommand("perforce.goToJob",m.GoToJob.bind(this)),r.commands.registerCommand("perforce.openReviewTool",m.OpenChangelistInReviewTool.bind(this)),r.commands.registerCommand("perforce.closeScm",m.forceClose.bind(this))}onDidModelChange(){this._model._sourceControl.count=this.count,r.commands.executeCommand("setContext","perforceState",this.stateContextKey)}static isSourceControl(e){return e&&e.inputBox}static GetInstance(e){var t;return this.isSourceControl(e)?this.instances.find(t=>t.sourceControl===e):null===(t=m.instances)||void 0===t?void 0:t[0]}static isSameClient(e,t){return e.clientName===t.clientName&&e.clientRoot.fsPath===t.clientRoot.fsPath&&e.userName===t.userName}static GetInstanceByClient(e){return this.instances.find(t=>this.isSameClient(t._clientRoot,e))}static async chooseScmProvider(e){if(this.isSourceControl(e))return this.GetInstance(e);{if(1===this.instances.length)return this.instances[0];const e=this.instances.map(e=>({label:e._clientRoot.clientName+" / "+e._clientRoot.userName,value:e})),t=await r.window.showQuickPick(e,{placeHolder:"Choose a context for this operation"});if(t)return t.value}}static async Login(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.Login())}static async Logout(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.Logout())}static async GoToChangelist(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.GoToChangelist())}static async GoToJob(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.GoToJob())}static async NewChangeSpec(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.NewChangeSpec())}static async NewJobSpec(e){const t=await m.chooseScmProvider(e);await(null==t?void 0:t._model.NewJobSpec())}static async OpenFile(...e){const t=e.filter(e=>e instanceof s.Resource),i=1===t.length,n=t.map(e=>r.commands.executeCommand("vscode.open",e.openUri,{preview:i}));await Promise.all(n)}static async Open(...e){const t=e.filter(e=>e instanceof s.Resource),i=[];for(const e of t)i.push(m.open(e,void 0,1===t.length));await Promise.all(i)}static async OpenvShelved(...e){const t=e.filter(e=>e instanceof s.Resource),i=[];for(const e of t)i.push(m.open(e,h.DiffType.WORKSPACE_V_SHELVE,1===t.length));await Promise.all(i)}static Sync(e){const t=m.GetInstance(e);if(t){const e=this._config.syncMode===u.SyncMode.WORKSPACE_ONLY?[...t._contributingDirs].map(e=>r.Uri.file(p.join(e,"..."))):void 0;t._model.Sync(e)}}static async Refresh(e,t=!1){const i=m.GetInstance(e);await(null==i?void 0:i._model.RefreshPolitely(t))}static async RefreshAll(){const e=m.instances.map(e=>e._model.Refresh());await Promise.all(e)}static Info(e){const t=m.GetInstance(e);null==t||t._model.Info()}static async ProcessChangelist(e){const t=m.GetInstance(e);await(null==t?void 0:t._model.ProcessChangelist())}static async EditChangelist(e){const t=e.model;t&&await t.EditChangelist(e)}static async EditChangeSpec(e){const t=e.model;t&&await t.EditChangeSpec(e)}static async Describe(e){const t=e.model;t&&await t.Describe(e)}static async SubmitDefault(e){const t=m.GetInstance(e);await(null==t?void 0:t._model.SubmitDefault())}static async Submit(e){const t=e.model;t&&await t.Submit(e)}static async SubmitSelectedFiles(...e){const t=e.filter(e=>e instanceof s.Resource);await t[0].model.SubmitSelectedFile(t)}static async Revert(e,...t){if(e instanceof s.Resource){const i=[...t,e].map(e=>e.model.Revert(e));await Promise.all(i)}else{const t=e,i=t.model;await i.Revert(t)}}static async RevertUnchanged(e,...t){if(e instanceof s.Resource){const i=[...t,e].map(e=>e.model.Revert(e,!0));await Promise.all(i)}else{const t=e,i=t.model;await i.Revert(t,!0)}}static CopyChangelistId(e){r.env.clipboard.writeText(e.chnum)}static async ResolveChangelist(e){const t=e.model;t&&await t.ResolveChangelist(e)}static async ReResolveChangelist(e){const t=e.model;t&&await t.ReResolveChangelist(e)}static async ResolveFiles(...e){var t;const i=e.filter(e=>e instanceof s.Resource);await(null===(t=i[0])||void 0===t?void 0:t.model.ResolveFiles(i))}static async ReResolveFiles(...e){var t;const i=e.filter(e=>e instanceof s.Resource);await(null===(t=i[0])||void 0===t?void 0:t.model.ReResolveFiles(i))}static async ShelveChangelist(e){const t=e.model;t&&await t.ShelveChangelist(e)}static async ShelveRevertChangelist(e){const t=e.model;t&&await t.ShelveChangelist(e,!0)}static async UnshelveChangelist(e){const t=e.model;t&&await t.UnshelveChangelist(e)}static async DeleteShelvedChangelist(e){const t=e.model;t&&await t.DeleteShelvedChangelist(e)}static async Shelve(...e){var t;const i=e.filter(e=>e instanceof s.Resource);await(null===(t=i[0])||void 0===t?void 0:t.model.ShelveMultiple(i))}static async Unshelve(...e){var t;const i=e.filter(e=>e instanceof s.Resource);await(null===(t=i[0])||void 0===t?void 0:t.model.UnshelveMultiple(i))}static async DeleteShelvedFile(...e){const t=e.filter(e=>e instanceof s.Resource).map(e=>e.model.DeleteShelvedFile(e));await Promise.all(t)}static async ReopenFile(e,...t){let i=void 0;if(e instanceof r.Uri)console.log("ReopenFile: "+e.toString());else{{let n=void 0;if(!(e instanceof s.Resource))return void console.log("ReopenFile: should never happen");n=e,n&&(i=[...t,n])}i&&0!==i.length&&await i[0].model.ReopenFile(i)}}static async FixJob(e){const t=e.model;t&&await t.FixJob(e)}static async UnfixJob(e){const t=e.model;t&&await t.UnfixJob(e)}static OpenChangelistInReviewTool(e){const t=this._config.getSwarmLink(e.chnum);if(!t)throw new Error("perforce.swarmHost has not been configured");try{r.env.openExternal(r.Uri.parse(t,!0))}catch{f.Display.showImportantError("Could not open swarm link "+t+" - Have you included the protocol? (e.g. https://)")}}async provideOriginalResource(e){if("file"!==e.scheme)return;const t=this._model.getOpenResource(e);return t&&t.status===a.Status.MOVE_ADD&&t.fromFile&&t.fromEndRev?t.fromFile:await this._model.haveFile(e)?d.fromUriWithRevision(e,"have"):void 0}static hasOpenFile(e){return this.instances.some(t=>t._model.getOpenResource(e))}static mayHaveConflictForFile(e){return this.instances.some(t=>t._model.mayHaveConflictForFile(e))}static async open(e,t,i=!0){if(e.FileType.base!==l.FileType.BINARY)await h.diffDefault(e,t,i);else{const t=d.fromUri(e.openUri,{command:"fstat"});await r.workspace.openTextDocument(t).then(e=>r.window.showTextDocument(e))}}}t.PerforceSCMProvider=m,m._config=u.configAccessor,m.instances=[],m._onDidChangeScmProviders=new r.EventEmitter},function(e,t,i){"use strict";var n;function r(e){switch(e.trim().toLowerCase()){case"add":return n.ADD;case"archive":return n.ARCHIVE;case"branch":return n.BRANCH;case"delete":return n.DELETE;case"edit":return n.EDIT;case"integrate":return n.INTEGRATE;case"import":return n.IMPORT;case"lock":return n.LOCK;case"move/add":return n.MOVE_ADD;case"move/delete":return n.MOVE_DELETE;case"purge":return n.PURGE;default:return n.UNKNOWN}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ADD=0]="ADD",e[e.ARCHIVE=1]="ARCHIVE",e[e.BRANCH=2]="BRANCH",e[e.DELETE=3]="DELETE",e[e.EDIT=4]="EDIT",e[e.IMPORT=5]="IMPORT",e[e.INTEGRATE=6]="INTEGRATE",e[e.LOCK=7]="LOCK",e[e.MOVE_ADD=8]="MOVE_ADD",e[e.MOVE_DELETE=9]="MOVE_DELETE",e[e.PURGE=10]="PURGE",e[e.UNKNOWN=11]="UNKNOWN"}(n=t.Status||(t.Status={})),t.operationCreatesFile=function(e){return[n.ADD,n.BRANCH,n.MOVE_ADD].includes(e)},t.operationDeletesFile=function(e){return[n.DELETE,n.MOVE_DELETE].includes(e)},t.GetStatus=r,t.GetStatuses=function(e){const t=[];if(!e)return t;const i=e.split(",");for(let e=0;e<i.length;e++)t.push(r(i[e]));return t}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(2)),s=n(i(6)),a=n(i(8)),c=i(4),l=i(14),u=i(16),h=i(7),d=i(44),p=i(9),f=i(1),m=i(47),g=i(30),v=i(15);async function w(e,t){try{const i=await s.unshelve(e,t);if(c.Display.showMessage("Changelist unshelved"),p.PerforceSCMProvider.RefreshAll(),i.warnings.length>0){const n=t.toChnum?"Resolve changelist":void 0,o=await r.window.showWarningMessage("Changelist #"+t.shelvedChnum+" was unshelved, but "+f.pluralise(i.warnings.length,"file needs",0,"files need")+" resolving",...[n].filter(f.isTruthy));o&&o===n&&await s.resolve(e,{chnum:t.toChnum})}}catch(e){c.Display.showImportantError(e),p.PerforceSCMProvider.RefreshAll()}}async function y(e,t,i){return a.showQuickPick("unshelveChange",e,t,!0,i)}function _(e){switch(e){case"add":return"diff-added";case"delete":case"move/delete":case"purge":return"diff-removed";case"move/add":case"integrate":case"branch":return"diff-renamed";default:return"diff-modified"}}t.changeQuickPickProvider={provideActions:async(e,t)=>{const i=a.asUri(e),n=await s.describe(i,{chnums:[t],omitDiffs:!0});if(n.length<1)throw c.Display.showImportantError("Unable to find change details"),new Error("Unable to find change details");const p=n[0],f=(p.isPending?await s.describe(i,{omitDiffs:!0,shelved:!0,chnums:[t]}):[])[0];return{items:function(e,t){return[{label:"$(multiple-windows) Focus in changelist search view",performAction:()=>{d.focusChangelist(e,t)}}]}(i,p).concat(function(e){const t=h.configAccessor.getSwarmLink(e.chnum);if(!t)return[];try{const e=r.Uri.parse(t,!0);return[{label:"$(eye) Open in review tool",description:"$(link-external) "+e.toString(),performAction:()=>{r.env.openExternal(e)}}]}catch(e){return c.Display.showImportantError("Could not parse swarm link "+t+" - make sure you have included the protocol, e.g. https://"),[]}}(p),function(e,t){return[a.makeClipPick("change number",t.chnum),a.makeClipPick("user",t.user),a.makeClipPick("change description",t.description.join("\n"))]}(0,p),function(e,t){return[{label:"$(edit) Edit changelist",description:"Edit the full changelist spec in the editor",performAction:()=>{v.changeSpecEditor.editSpec(e,t.chnum)}}]}(i,p),function(e,t){if(!t||t.shelvedFiles.length<1)return[];return[{label:"$(cloud-download) Unshelve changelist...",description:"Unshelve into a selected changelist",performAction:()=>{y(e,t.chnum)}},{label:"$(cloud-download) Unshelve via branch mapping...",description:"Unshelve, mapping through a branch spec",performAction:async i=>{const n=await r.window.showInputBox({prompt:"Enter branch name to unshelve changelist "+t.chnum+" through (use * to search by wildcard)",ignoreFocusOut:!0}),o=(null==n?void 0:n.includes("*"))?await async function(e,t){try{const i=await s.branches(e,{max:200,nameFilter:t.replace("*","...")});return i.length<1?void c.Display.showImportantError("No branch mappings match "+t):await r.window.showQuickPick(i.map(e=>e.branch),{placeHolder:"Choose a matching branch"})}catch(e){c.Display.showImportantError(e)}}(e,n):n;void 0===o?i():y(e,t.chnum,o)}}]}(i,f),function(e,t){return[{label:"Jobs fixed: "+t.fixedJobs.length}].concat(t.fixedJobs.map(t=>({label:" ".repeat(3)+"$(tools) "+t.id,description:t.description.join(" "),performAction:()=>{g.showQuickPickForJob(e,t.id)}})))}(i,p),function(e,t){return[{label:"Changed files: "+t.affectedFiles.length}].concat(t.affectedFiles.map(t=>({label:" ".repeat(3)+"$("+_(t.operation)+") "+t.depotPath+"#"+t.revision,description:t.operation,performAction:()=>{var i;const n=o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,t.depotPath,t.revision);l.showQuickPickForFile(n)}})))}(i,p),function(e,t){if(!t||t.shelvedFiles.length<1)return[];return[{label:"Shelved files: "+t.shelvedFiles.length}].concat(t.shelvedFiles.map(i=>({label:" ".repeat(3)+"$("+_(i.operation)+") "+i.depotPath+"#"+i.revision,description:i.operation,performAction:()=>{var n;m.showQuickPickForShelvedFile(null!==(n=o.getUsableWorkspace(e))&&void 0!==n?n:e,i,t)}})))}(i,f)),placeHolder:(p.isPending?"Pending":"Submitted")+" change "+t+" by "+p.user+" on "+u.toReadableDateTime(p.date)+" : "+p.description.join(" ")}}},t.unshelveChangeQuickPickProvider={provideActions:async(e,t,i=!0,n)=>{const r=a.asUri(e);return{items:[{label:"Default changelist",description:"Unshelve into the default changelist, or the current changelist if already unshelved",performAction:()=>w(r,{shelvedChnum:t,branchMapping:n,force:i})},{label:"New changelist",description:"Unshelve into a new changelist",performAction:async()=>{const e=await s.getChangeSpec(r,{});e.description="Unshelved from change #"+t,e.files=[];const o=await s.inputChangeSpec(r,{spec:e});await w(r,{shelvedChnum:t,toChnum:o.chnum,branchMapping:n,force:i})}},...await async function(e,t,i,n){const r=(await s.getInfo(e,{})).get("User name");if(!r)return[];return(await s.getChangelists(e,{user:r,status:s.ChangelistStatus.PENDING})).map(r=>({label:r.chnum,description:r.description.join(" "),performAction:()=>w(e,{shelvedChnum:t,toChnum:r.chnum,branchMapping:n,force:i})}))}(r,t,i,n)],excludeFromHistory:!0,placeHolder:"Unshelve changelist "+t+(n?" through branch "+n:"")+" into..."+(i?" (WILL CLOBBER WRITABLE FILES)":"")}}},t.showUnshelveQuickPick=y,t.showQuickPickForChangelist=async function(e,t){await a.showQuickPick("change",e,t)},t.getOperationIcon=_},function(e,t){e.exports=require("fs")},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(10),s=i(27),a=i(4),c=n(i(3)),l=n(i(12)),u=n(i(2)),h=n(i(6));var d;function p(e,t=0){return e.slice(t).split("").findIndex(e=>"/"!==e&&"\\"!==e)}function f(e,t){return t<=0?c.basename(e):e.slice(t)}function m(e,t){const i=function(e,t){const i=c.dirname(e),n=c.dirname(t);if(i===n){const r=Math.max(0,Math.min(p(e,i.length),p(t,n.length)));return i.length+r}return e.split("").findIndex((e,i)=>e!==t[i])}(e,t);return[f(e,i),f(t,i)]}function g(e,t,i){return t?isNaN(parseInt(t))?e+t:e+"#"+t:i?e+" (workspace)":e}function v(e,t,i,n){const[r,o]=m(e,i);return g(r,t)+" ⟷ "+g(o,n)}async function w(e,t,i,n=!0){var o;const s=u.withArgs(e,{leftUri:void 0}),a=null!==(o=u.decodeUriQuery(t.query).diffStartFile)&&void 0!==o?o:u.decodeUriQuery(e.query).diffStartFile,c="perforce"===t.scheme?u.withArgs(t,{leftUri:s.toString(),diffStartFile:null!=a?a:t.toString()}):t,l=null!=i?i:function(e,t){if(!u.isDepotUri(t)){const i=u.getRevOrAtLabel(t);return g(u.basenameWithoutRev(e),u.getRevOrAtLabel(e))+" ⟷ "+g(u.basenameWithoutRev(t),i,!0)}const i=u.getDepotPathFromDepotUri(e),n=u.getDepotPathFromDepotUri(t);return v(i,u.getRevOrAtLabel(e),n,u.getRevOrAtLabel(t))}(e,t);await r.commands.executeCommand("vscode.diff",s,c,l,{preview:n})}async function y(e){if(!e)return void a.Display.showImportantError("No previous revision available");const t=function(e){const t=parseInt(u.getRevOrAtLabel(e));if(!(isNaN(t)||t<=1))return u.fromUriWithRevision(e,(t-1).toString())}(e);t?await w(t,e):a.Display.showImportantError("No previous revision available")}async function _(e,t){const i=u.getRevOrAtLabel(e),n=parseInt(u.getRevOrAtLabel(e));i.startsWith("@=")?await async function(e,t){var i;const n=null===(i=(await h.getFstatInfo(e,{depotPaths:[e],limitToShelved:!0,chnum:t}))[0])||void 0===i?void 0:i.workRev;if(n){const t=u.withArgs(e,{},n);await w(t,e)}}(e,i.slice(2)):isNaN(n)?await async function(e,t){var i;const n=null===(i=await h.have(e,{file:e}))||void 0===i?void 0:i.depotUri;if(!n)return void a.Display.showImportantError("No previous revision available");const r=u.withArgs(n,{haveRev:u.getRevOrAtLabel(n),diffStartFile:e.toString()});t?await y(r):await w(r,e)}(e,t):await y(e)}!function(e){e[e.WORKSPACE_V_DEPOT=0]="WORKSPACE_V_DEPOT",e[e.SHELVE_V_DEPOT=1]="SHELVE_V_DEPOT",e[e.WORKSPACE_V_SHELVE=2]="WORKSPACE_V_SHELVE"}(d=t.DiffType||(t.DiffType={})),t.getPathsWithoutCommonPrefix=m,t.diffTitleForDepotPaths=v,t.diffFiles=w,t.diffPreviousIgnoringLeftInfo=async function(e){await _(e)},t.diffPrevious=async function(e,t){const i=function(e){const t=u.decodeUriQuery(e.query);if(!u.getUsableWorkspace(e))throw new Error("No usable workspace found for "+e);return!!t.leftUri&&y(u.withArgs(u.parse(t.leftUri),{diffStartFile:t.diffStartFile}))}(e);i?await i:await _(e,t)},t.diffNext=async function(e){const t=parseInt(u.getRevOrAtLabel(e));if(isNaN(t))return void a.Display.showImportantError("No more revisions available");const i=e,n=u.decodeUriQuery(e.query),r=n.haveRev&&parseInt(n.haveRev)===t&&n.diffStartFile?u.parse(n.diffStartFile):u.fromUriWithRevision(e,(t+1).toString());await w(i,r)},t.diffDefault=async function(e,t,i=!0){if(e.FileType.base===s.FileType.BINARY){const t=u.fromUri(e.openUri,{command:"fstat"});return void await r.workspace.openTextDocument(t).then(e=>r.window.showTextDocument(e))}void 0===t&&(t=e.isShelved?d.SHELVE_V_DEPOT:d.WORKSPACE_V_DEPOT);const n=function(e,t){var i;if(t===d.WORKSPACE_V_SHELVE)switch(e.status){case o.Status.ADD:case o.Status.EDIT:case o.Status.INTEGRATE:case o.Status.MOVE_ADD:case o.Status.BRANCH:const t=u.fromUriWithRevision(e.openUri,"@="+e.change);return{title:u.basenameWithRev(t,"@="+e.change),uri:t};case o.Status.DELETE:case o.Status.MOVE_DELETE:}else{const t=u.emptyFileUri();switch(e.status){case o.Status.ADD:case o.Status.BRANCH:return{title:u.basenameWithoutRev(e.openUri)+"#0",uri:t};case o.Status.MOVE_ADD:return{title:e.fromFile?u.basenameWithRev(e.fromFile):"Depot Version",uri:null!==(i=e.fromFile)&&void 0!==i?i:t};case o.Status.INTEGRATE:case o.Status.EDIT:case o.Status.DELETE:case o.Status.MOVE_DELETE:const n=u.fromUriWithRevision(e.openUri,e.workingRevision);return{title:u.basenameWithRev(n),uri:n}}}}(e,t),a=function(e,t){var i;const n=u.emptyFileUri();if(t===d.SHELVE_V_DEPOT)switch(e.status){case o.Status.ADD:case o.Status.EDIT:case o.Status.MOVE_ADD:case o.Status.INTEGRATE:case o.Status.BRANCH:return e.openUri}else{const t=!e.isShelved||e.underlyingUri&&l.existsSync(e.underlyingUri.fsPath);switch(e.status){case o.Status.ADD:case o.Status.EDIT:case o.Status.MOVE_ADD:case o.Status.INTEGRATE:case o.Status.BRANCH:return t&&null!==(i=e.underlyingUri)&&void 0!==i?i:n}}}(e,t);if(!n)return a?void await r.window.showTextDocument(a):void console.error("Status not supported: "+e.status.toString());if(!a)return void await r.window.showTextDocument(n.uri);const c=u.withArgs(n.uri,{haveRev:e.workingRevision}),h="file"===a.scheme?a:u.withArgs(a,{haveRev:e.workingRevision});await w(c,h,function(e,t,i){const n=u.basenameWithoutRev(e.openUri),r=u.basenameWithRev(e.openUri);let o="";switch(i){case d.SHELVE_V_DEPOT:o=t+" ⟷ "+r;break;case d.WORKSPACE_V_SHELVE:o=t+" ⟷ "+n+" (workspace)";break;case d.WORKSPACE_V_DEPOT:o=t+" ⟷ "+n+" (workspace)"}return o}(e,n.title,t),i)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(2)),s=n(i(6)),a=n(i(13)),c=i(4),l=n(i(28)),u=i(1),h=n(i(11)),d=n(i(8)),p=i(43),f=i(16),m=n(i(3));async function g(e,t){await d.showQuickPick("file",e,t)}async function v(e,t){await d.showQuickPick("filerev",e,!1,!1,!0,t)}async function w(e,t,i,n,r){await d.showQuickPick("filerev",e,t,i,n,r)}async function y(e){await d.showQuickPick("filediff",e,!0)}function _(e){return{filelog:e.all,haveFile:e.haveFile}}function C(e){return"#"+e.revision+(e.date?"  $(calendar) "+f.timeAgo.format(e.date):"")+" $(person) "+e.user+" $(circle-filled) "+e.description.slice(0,32)}async function S(e,t,i){var n,r;const a=null!==(n=null==t?void 0:t.haveFile)&&void 0!==n?n:await s.have(e,{file:e}),l=o.getRevOrAtLabel(e),u=!l||isNaN(parseInt(l))?null==a?void 0:a.revision:l;if(!u)throw c.Display.showError("Unable to get file details without a revision"),new Error("No revision available for "+e.toString());const h=o.fromUriWithRevision(e,""),d=null!==(r=null==t?void 0:t.filelog)&&void 0!==r?r:await s.getFileHistory(e,{file:h,followBranches:i});if(0===d.length)throw c.Display.showImportantError("No file history found"),new Error("Filelog info empty");const p=d.findIndex(e=>e.revision===u);return{all:d,current:d[p],currentIndex:p,next:d[p-1],prev:d[p+1],latest:d[0],haveFile:a}}t.fileQuickPickProvider={provideActions:async(e,t)=>{const i=d.asUri(e),n=await S(i,t);return{items:function(e,t){const i=t.prev,n=t.next,r=t.current.integrations.find(e=>e.direction===s.Direction.FROM);return[i?{label:"$(arrow-small-left) Previous revision",description:C(i),performAction:()=>{var n;return g(o.fromDepotPath(null!==(n=o.getUsableWorkspace(e))&&void 0!==n?n:e,i.file,i.revision),_(t))}}:{label:"$(arrow-small-left) Previous revision",description:"n/a"},n?{label:"$(arrow-small-right) Next revision",description:C(n),performAction:()=>{var i;return g(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,n.file,n.revision),_(t))}}:{label:"$(arrow-small-right) Next revision",description:"n/a"},{label:"$(symbol-numeric) File history...",description:"Go to a specific revision",performAction:()=>{v(e,_(t))}},r?{label:"$(git-merge) Go to integration source revision",description:r.operation+" from "+r.file+"#"+r.endRev,performAction:()=>{var t;return g(o.fromDepotPath(null!==(t=o.getUsableWorkspace(e))&&void 0!==t?t:e,r.file,r.endRev))}}:void 0,{label:"$(source-control) Go to integration target...",description:"See integrations that include this revision",performAction:()=>p.showIntegPickForFile(e)}].filter(u.isTruthy)}(i,n).concat(function(e,t){return[d.makeClipPick("depot path",t.current.file+"#"+t.current.revision)]}(0,n),function(e,t){return[{label:"$(repo-pull) Sync this revision",description:"Sync "+m.basename(t.current.file)+"#"+t.current.revision,performAction:async()=>{await s.sync(e,{files:[t.current.file+"#"+t.current.revision]}),c.Display.showMessage("File synced")}}]}(i,n),function(e,t){const i=t.prev,n=t.latest,s=t.haveFile;return[{label:"$(file) Show this revision",description:"Open this revision in the editor",performAction:()=>{r.window.showTextDocument(e)}},s?{label:"$(file) Open workspace file",description:"Open the local file in the editor",performAction:()=>{r.window.showTextDocument(s.localUri)}}:void 0,{label:"$(list-ordered) Annotate this revision",description:"Open in the editor, with change details for each line",performAction:()=>{l.annotate(e)}},i?{label:"$(diff) Diff against previous revision",description:a.diffTitleForDepotPaths(i.file,i.revision,t.current.file,t.current.revision),performAction:()=>a.diffPreviousIgnoringLeftInfo(e)}:void 0,n!==t.current?{label:"$(diff) Diff against latest revision",description:a.diffTitleForDepotPaths(t.current.file,t.current.revision,n.file,n.revision),performAction:()=>{var i,r;return a.diffFiles(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,t.current.file,t.current.revision),o.fromDepotPath(null!==(r=o.getUsableWorkspace(e))&&void 0!==r?r:e,n.file,n.revision))}}:void 0,{label:"$(diff) Diff against workspace file",description:s?"":"No matching workspace file found",performAction:s?()=>{var i;a.diffFiles(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,t.current.file,t.current.revision),s.localUri)}:void 0},{label:"$(diff) Diff against...",description:"Choose another revision to diff against",performAction:()=>{y(e)}}].filter(u.isTruthy)}(i,n),function(e,t){return[{label:"$(list-flat) Go to changelist details",description:"Change "+t.current.chnum+"  $(book)  "+t.current.description,performAction:()=>h.showQuickPickForChangelist(e,t.current.chnum)}]}(i,n)),placeHolder:(w=n.current,w.file+"#"+w.revision+" "+w.operation+" on "+f.toReadableDateTime(w.date)+" by "+w.user+" : "+w.description),recentKey:"file:"+o.fsPathWithoutRev(i)};var w}},t.showQuickPickForFile=g,t.fileRevisionQuickPickProvider={provideActions:async(e,t,i,n,r)=>{const a=d.asUri(e),c=await S(a,r);return{items:function(e,t,i,n,r){const a=(r?t.all:t.all.slice(t.all.findIndex(e=>e.chnum===t.current.chnum))).flatMap(r=>{const a=r===t.current?"$(location)":"$(debug-stackframe-dot)",c=i?r.integrations.filter(e=>e.direction===s.Direction.FROM):[],l=n?r.integrations.filter(e=>e.direction===s.Direction.TO):[],h={label:a+" #"+r.revision,description:r.description,detail:" ".repeat(10)+r.operation+" $(person) "+r.user+"  $(calendar)  "+f.toReadableDateTime(r.date),performAction:()=>{var i;return g(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,r.file,r.revision),_(t))}},p=c.map(t=>({label:" ".repeat(10)+"$(git-merge) "+t.operation+" from "+t.file+"#"+d.toRevString(t.startRev,t.endRev),performAction:()=>{var i;return g(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,t.file,t.endRev))}}));return[h,...l.map(t=>({label:" ".repeat(10)+"$(source-control) "+t.operation+" into "+t.file+"#"+t.endRev,performAction:()=>{var i;return g(o.fromDepotPath(null!==(i=o.getUsableWorkspace(e))&&void 0!==i?i:e,t.file,t.endRev))}})),...p].filter(u.isTruthy)});return[{label:n?"$(exclude) Hide integration target files":"$(gear) Show integration target files",performAction:()=>w(e,i,!n,r,_(t))},{label:i?"$(exclude) Hide integration source files":"$(gear) Show integration source files",performAction:()=>w(e,!i,n,r,_(t))},{label:r?"$(exclude) Hide newer revisions":"$(gear) Show newer revisions",performAction:()=>w(e,i,n,!r,_(t))}].concat(a)}(a,c,t,i,n),excludeFromHistory:!0,placeHolder:"Choose revision for "+c.current.file+"#"+c.current.revision}}},t.showRevChooserForFile=v,t.fileDiffQuickPickProvider={provideActions:async(e,t)=>{const i=d.asUri(e),n=await S(i,void 0,!0);return{items:function(e,t,i){var n;const r=o.fromDepotPath(null!==(n=o.getUsableWorkspace(e))&&void 0!==n?n:e,t.current.file,t.current.revision),s=[{label:i?"$(exclude) Hide newer revisions":"$(gear) Show newer revisions",performAction:()=>async function(e,t){await d.showQuickPick("filediff",e,t)}(e,!i)}],c=(i?t.all:t.all.slice(t.all.findIndex(e=>e.chnum===t.current.chnum))).map((i,n)=>{const s=i===t.current?"$(location) ":i.file===t.current.file?"$(debug-stackframe-dot) ":"$(git-merge) "+i.file,c=n>t.currentIndex;return{label:s+"#"+i.revision,description:i.operation+" $(person) "+i.user+"  $(book)  "+i.description,performAction:()=>{var t;const n=o.fromDepotPath(null!==(t=o.getUsableWorkspace(e))&&void 0!==t?t:e,i.file,i.revision);a.diffFiles(c?n:r,c?r:n)}}});return s.concat(c)}(i,n,t),excludeFromHistory:!0,placeHolder:"Diff revision for "+n.current.file+"#"+n.current.revision}}},t.showDiffChooserForFile=y},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(6)),s=n(i(3)),a=i(17),c=i(4),l=i(9);class u{constructor(e,t){this._type=t,this._state=e.globalState,this._store=r.Uri.file(e.globalStoragePath),this._hasUnresolvedPrompt=!1,this._subscriptions=[],this._subscriptions.push(r.workspace.onWillSaveTextDocument(e=>{this.checkSavedDoc(e)}))}dispose(){this._subscriptions.forEach(e=>e.dispose())}get mapName(){return this._type+"Map"}async setResource(e,t){var i;const n=null!==(i=this._state.get(this.mapName))&&void 0!==i?i:{};n[e.fsPath]={resource:t.fsPath,lastAccessed:(new Date).getTime()},await this._state.update(this.mapName,n)}getResource(e){var t;const i=this._state.get(this.mapName),n=null===(t=null==i?void 0:i[e.fsPath])||void 0===t?void 0:t.resource;if(n)return r.Uri.file(n)}clearCached(e){var t;const i=null!==(t=this._state.get(this.mapName))&&void 0!==t?t:{};Object.keys(i).forEach(t=>{try{i[t].lastAccessed<e&&(r.workspace.fs.delete(r.Uri.file(t)),delete i[t])}catch{}}),this._state.update(this.mapName,i)}archiveOldItems(){const e=(new Date).getTime()-432e6;this.clearCached(e)}static async checkTabSettings(){if(r.workspace.getConfiguration("perforce").get("specEditor.showIndentWarning")&&r.workspace.getConfiguration("editor").get("insertSpaces")&&!r.workspace.getConfiguration("editor").get("detectIndentation")){const e="Enable tab detection in this workspace",t="Don't show this warning",i=await r.window.showWarningMessage("WARNING - your editor is configured to use spaces and never tabs, which causes strange indentation when editing perforce spec files. Consider enabling the `editor.detectIndentation` setting",e,t);i===e&&await r.workspace.getConfiguration("editor").update("detectIndentation",!0),i===t&&await r.workspace.getConfiguration("perforce").update("specEditor.showIndentWarning",!1,r.ConfigurationTarget.Global)}}async createSpecFile(e,t){await r.workspace.fs.createDirectory(this._store);const i=e+"."+this._type+"spec",n=r.Uri.file(s.join(this._store.fsPath,i)),o=(new a.TextEncoder).encode(t);return await r.workspace.fs.writeFile(n,o),n}static selectNewDescription(e){const t=e.document.getText().split(/\r?\n/),i=t.findIndex(e=>e.includes("<enter description here>"));if(i>=0){const n=t[i].indexOf("<"),o=t[i].indexOf(">");e.selection=new r.Selection(i,n,i,o+1)}}async editSpecImpl(e,t){const i=await this.getSpecText(e,t)+"\n\n# When you are done editing, click the 'apply spec' button\n# on this editor's toolbar to apply the edit to the perforce server",n=await this.createSpecFile(t,i);await this.setResource(n,e);const o=await r.window.showTextDocument(n,{preview:"new"===t});"new"===t&&u.selectNewDescription(o),u.checkTabSettings()}async editSpec(e,t){await r.window.withProgress({location:r.ProgressLocation.Window,title:"Retrieving spec for "+this._type+" "+t},()=>this.editSpecImpl(e,t))}get specSuffix(){return this._type+"spec"}isValidSpecFilename(e){return e.endsWith("."+this.specSuffix)}getSpecItemName(e){return s.basename(e).split(".")[0]}async validateAndGetResource(e){const t=e.uri,i=s.basename(t.fsPath);if(!this.isValidSpecFilename(i))throw new Error("Filename "+i+" does not end in ."+this.specSuffix);const n=this.getSpecItemName(i),r=this.getResource(t);if(!r)throw new Error("Could not find workspace details for "+this._type+" "+n);(null==e?void 0:e.isDirty)&&(this._suppressNextSave=e,await(null==e?void 0:e.save()));return{item:n,resource:r,text:e.getText()}}async inputSpec(e){var t;try{const{item:i,resource:n,text:o}=await this.validateAndGetResource(e),s=await r.window.withProgress({location:r.ProgressLocation.Window,title:"Uploading spec for "+this._type+" "+i},()=>this.inputSpecText(n,i,o));s&&s!==i&&(null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document)===e&&r.commands.executeCommand("workbench.action.closeActiveEditor"),this.editSpec(n,null!=s?s:i)}catch(e){c.Display.showImportantError(e)}}async refreshSpec(e){const{item:t,resource:i}=await this.validateAndGetResource(e);await this.editSpec(i,t)}async checkSavedDoc(e){if(this._suppressNextSave!==e.document){if(!this._hasUnresolvedPrompt&&e.reason===r.TextDocumentSaveReason.Manual){const t=e.document;if(this.isValidSpecFilename(t.fileName)&&this.getResource(t.uri)){const e=this.getSpecItemName(t.fileName),i="Apply now";this._hasUnresolvedPrompt=!0;const n="new"===e?"Create new "+this._type+" on the perforce server now?":"Apply your changes to the spec for "+this._type+" "+e+" on the perforce server now?",o=await r.window.showInformationMessage(n,i);this._hasUnresolvedPrompt=!1,o===i&&this.inputSpec(t)}}}else this._suppressNextSave=void 0}}class h extends u{constructor(e){super(e,"change")}getSpecText(e,t){const i="new"===t?void 0:t;return o.outputChange(e,{existingChangelist:i})}async inputSpecText(e,t,i){var n;const r=await o.inputRawChangeSpec(e,{input:i});return c.Display.showMessage(r.rawOutput),l.PerforceSCMProvider.RefreshAll(),null!==(n=r.chnum)&&void 0!==n?n:t}}class d extends u{constructor(e){super(e,"job")}getSpecText(e,t){const i="new"===t?void 0:t;return o.outputJob(e,{existingJob:i})}async inputSpecText(e,t,i){var n;const r=await o.inputRawJobSpec(e,{input:i});return c.Display.showMessage(r.rawOutput),null!==(n=r.job)&&void 0!==n?n:t}}t.createSpecEditor=function(e){t.changeSpecEditor=new h(e),t.jobSpecEditor=new d(e),e.subscriptions.push(t.changeSpecEditor),e.subscriptions.push(t.jobSpecEditor),t.changeSpecEditor.archiveOldItems(),t.jobSpecEditor.archiveOldItems()}},function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(i(118)),s=r(i(74)),a=r(i(0));o.default.addLocale(s),t.timeAgo=new o.default("en-US"),t.toReadableDateTime=function(e){return e?e.toLocaleString(a.env.language,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}):"???"},t.toReadableDate=function(e){return e?e.toLocaleString(a.env.language,{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"???"}},function(e,t){e.exports=require("util")},function(e,t,i){"use strict";const n=i(3),r="win32"===process.platform,{REGEX_BACKSLASH:o,REGEX_REMOVE_BACKSLASH:s,REGEX_SPECIAL_CHARS:a,REGEX_SPECIAL_CHARS_GLOBAL:c}=i(19);t.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),t.hasRegexChars=e=>a.test(e),t.isRegexChar=e=>1===e.length&&t.hasRegexChars(e),t.escapeRegex=e=>e.replace(c,"\\$1"),t.toPosixSlashes=e=>e.replace(o,"/"),t.removeBackslashes=e=>e.replace(s,e=>"\\"===e?"":e),t.supportsLookbehinds=()=>{const e=process.version.slice(1).split(".").map(Number);return 3===e.length&&e[0]>=9||8===e[0]&&e[1]>=10},t.isWindows=e=>e&&"boolean"==typeof e.windows?e.windows:!0===r||"\\"===n.sep,t.escapeLast=(e,i,n)=>{const r=e.lastIndexOf(i,n);return-1===r?e:"\\"===e[r-1]?t.escapeLast(e,i,r-1):`${e.slice(0,r)}\\${e.slice(r)}`},t.removePrefix=(e,t={})=>{let i=e;return i.startsWith("./")&&(i=i.slice(2),t.prefix="./"),i},t.wrapOutput=(e,t={},i={})=>{let n=`${i.contains?"":"^"}(?:${e})${i.contains?"":"$"}`;return!0===t.negated&&(n=`(?:^(?!${n}).*$)`),n}},function(e,t,i){"use strict";const n=i(3),r={DOT_LITERAL:"\\.",PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:"\\/",ONE_CHAR:"(?=.)",QMARK:"[^/]",END_ANCHOR:"(?:\\/|$)",DOTS_SLASH:"\\.{1,2}(?:\\/|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|\\/)\\.{1,2}(?:\\/|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:\\/|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:\\/|$))",QMARK_NO_DOT:"[^.\\/]",STAR:"[^/]*?",START_ANCHOR:"(?:^|\\/)"},o={...r,SLASH_LITERAL:"[\\\\/]",QMARK:"[^\\\\/]",STAR:"[^\\\\/]*?",DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)"};e.exports={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:n.sep,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?o:r}},,function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(0),s=n(i(2)),a=i(4),c=i(9),l=r(i(89)),u=i(103),h=n(i(3)),d=i(7);!function(e){var t,i;const n=new u.CommandLimiter(null!==(t=o.workspace.getConfiguration("perforce").get("bottleneck.maxConcurrent"))&&void 0!==t?t:10),r=null!==(i=o.workspace.getConfiguration("perforce").get("debugModeActive"))&&void 0!==i&&i;let p=!1;function f(e){let t=o.workspace.getConfiguration("perforce").get("command","none");if("none"===t||""===t){t=process.platform.startsWith("win")?"p4.exe":"p4"}else{t=(e=>{let t=e;if(!t.startsWith("\\\\")){const e=t.split("\\");t=e.join("\\\\")}return t})(function(e,t){var i,n,r;if(e.includes("${workspaceFolder}")){const s=null!==(i=o.workspace.getWorkspaceFolder(t))&&void 0!==i?i:null===(n=o.workspace.workspaceFolders)||void 0===n?void 0:n[0],a=null!==(r=null==s?void 0:s.uri.fsPath)&&void 0!==r?r:"";return e.replace("${workspaceFolder}",a)}return e}(t,e))}return t}e.getOverrideDir=function(e){const t=o.workspace.getConfiguration("perforce",e).get("dir");return"none"===t?void 0:t};let m=0;function g(e,t,i,c,u,g){r&&!p&&(n.debugMode=!0,p=!0),n.submit(n=>async function(e,t,i,n,r,c){var u;const p=null!==(u=s.getUsableWorkspace(e))&&void 0!==u?u:e,m=f(p),g=function(e){const t=o.workspace.getConfiguration("perforce",e),i=t.get("user","none"),n=t.get("client","none"),r=t.get("port","none"),s=t.get("password","none"),a=t.get("dir","none"),c=[],l=(e,t)=>e&&"none"!==e?[t,e.toString()]:[];return c.push(...l(i,"-u")),c.push(...l(n,"-c")),c.push(...l(r,"-p")),c.push(...l(s,"-P")),c.push(...l(a,"-d")),c}(p);g.push(t),n&&g.push(...n);const C=await async function(e){try{return(await o.workspace.fs.stat(e)).type===o.FileType.Directory}catch{}return!1}(p)?p.fsPath:h.dirname(p.fsPath),S={...process.env,PWD:C};!function(e,t,i,n,r,s){(function(e,t,i,n){const r=function(e){return e.map(e=>`'${e.replace(/'/g,"'\\''")}'`)}(t),o=[e].concat(r),s=t[0].includes("login")?"***":i,c=i?" < "+s:"";a.Display.channel.appendLine(n.cwd+": "+o.join(" ")+c)})(e,t,r,i),s?async function(e,t,i,n){const r=d.configAccessor.resolveP4EDITOR,s=r?{P4EDITOR:r}:void 0,a=t.map(e=>({value:e,quoting:o.ShellQuoting.Strong})),c=new o.ShellExecution(e,a,{cwd:i.cwd,env:s});try{const e=new o.Task({type:"perforce"},"Perforce #"+ ++w,"perforce",c);await o.tasks.executeTask(e);const t=o.tasks.onDidEndTask(i=>{i.execution.task.name===e.name&&(n(null,"",""),t.dispose())})}catch(e){n(e,"","")}}(e,t,i,n):function(e,t,i,n,r){const s=o.workspace.getConfiguration("perforce").get("debugP4Commands",!1),a=++v;s&&console.log("[P4 RUN]",a,e,t,i);const c=l.default(e,t,i);let u=!1;if(c.on("error",e=>{u||(u=!0,s&&console.log("[P4 ERR]",a,e),n(e,"",""))}),void 0!==r){if(!c.stdin)throw new Error("Child does not have standard input");c.stdin.end(r,"utf8")}(async function(e){return Promise.all([y(e),_(e)])})(c).then(e=>{var t,i;u||(s&&console.log("[P4 RES]",a,"Stdout:\n"+e[0],"\n============================","\nStderr:\n"+e[1]+"\n"),n(null,null!==(t=e[0])&&void 0!==t?t:"",null!==(i=e[1])&&void 0!==i?i:""))})}(e,t,i,n,r)}(m,g,{cwd:C,env:S},i,r,c)}(e,t,(...e)=>{n(),i(...e)},c,u,g),`<JOB_ID:${++m}:${t}>`).catch(e=>{console.error("Error while running perforce command:",e),i(e,"","")})}e.execute=g,e.executeAsPromise=function(e,t,i,n){return new Promise((r,o)=>{g(e,t,(e,t,i)=>{e?o(e.message):i?o(i):r(t.toString())},i,n)})};let v=0;let w=0;async function y(e){let t="";if(e.stdout)for await(const i of e.stdout)t+=i.toString();return t}async function _(e){let t="";if(e.stderr)for await(const i of e.stderr)t+=i.toString();return t}e.handleCommonServiceResponse=function(e,t,i){e||i?a.Display.showError(i.toString()):(a.Display.channel.append(t.toString()),a.Display.updateEditor(),c.PerforceSCMProvider.RefreshAll())},e.getClientRoot=function(t){return new Promise((i,n)=>{e.executeAsPromise(t,"info").then(e=>{let t=e.indexOf("Client root: ");if(-1===t)return void n("P4 Info didn't specify a valid Client Root path");t+="Client root: ".length;const r=e.indexOf("\n",t);-1!==r?i(e.substring(t,r).trimRight()):n("P4 Info Client Root path contains unexpected format")}).catch(e=>{n(e)})})},e.getConfigFilename=function(t){return new Promise((i,n)=>{e.executeAsPromise(t,"set",["-q"]).then(e=>{let t=e.indexOf("P4CONFIG=");if(-1===t)return void i(void 0);t+="P4CONFIG=".length;const n=e.indexOf("\n",t);i(-1!==n?e.substring(t,n).trimRight():void 0)}).catch(e=>{n(e)})})}}(t.PerforceService||(t.PerforceService={}))},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=n(i(12));t.mapEvent=function(e,t){return(i,n=null,r)=>e(e=>i.call(n,t(e)),null,r)},function(e){e.normalize=function(e){e=(e=e.replace(/\\\\/g,"/")).replace(/\\/g,"/");const t=/([A-Z]):(.*)/.exec(e);return t&&(e=`${t[1].toLowerCase()}:${t[2]}`),e},e.expansePath=function(e){return r.workspace.getConfiguration("perforce").get("realpath",!1)&&o.existsSync(e)&&(e=o.realpathSync(e)),e.replace(/%/g,"%25").replace(/\*/g,"%2A").replace(/#/g,"%23").replace(/@/g,"%40")}}(t.Utils||(t.Utils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(24);t.chain=n.default;const r=i(25);t.chainRight=r.default;const o=i(55);t.compose=o.default;const s=i(36);t.curry=s.default;const a=i(56);t.pipe=a.default;const c=i(58);t.rail=c.default;const l=i(37);t.railAsync=l.default;const u=i(59);t.railRight=u.default;const h=i(39);t.railRightAsync=h.default;const d=i(60);t.tap=d.default,t.default={chain:n.default,chainRight:r.default,compose:o.default,curry:s.default,pipe:a.default,rail:c.default,railAsync:l.default,railRight:u.default,railRightAsync:h.default,tap:d.default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e=>(...t)=>i=>t.reduce((i,n,r)=>e(n,i,r===t.length-1),i);t.chain=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e=>(...t)=>i=>t.reduceRight((i,n,r)=>e(n,i,r===t.length-1),i);t.chainRight=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=(e,t)=>{if(t instanceof Error)return t;let i;try{i=e(t)}catch(e){i=e}return void 0===i?t:i};t.wrap=n,t.default=n},function(e,t,i){"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.TEXT=1]="TEXT",e[e.BINARY=2]="BINARY",e[e.SYMLINK=3]="SYMLINK",e[e.APPLE=4]="APPLE",e[e.RESOURCE=5]="RESOURCE",e[e.UNICODE=6]="UNICODE",e[e.UTF8=7]="UTF8",e[e.UTF16=8]="UTF16"}(n=t.FileType||(t.FileType={})),function(e){e[e.NONE=0]="NONE",e[e.WRITABLE=1]="WRITABLE",e[e.EXECUTE=2]="EXECUTE",e[e.RCS_KEYWORD_EXPANSION=4]="RCS_KEYWORD_EXPANSION",e[e.EXCLUSIVE_OPEN=8]="EXCLUSIVE_OPEN",e[e.STOREREV_FULL_COMPRESSED=16]="STOREREV_FULL_COMPRESSED",e[e.STOREREV_RSC_DELTA=32]="STOREREV_RSC_DELTA",e[e.STOREREV_FULL_FILE=64]="STOREREV_FULL_FILE",e[e.STOREREV_ONLY_HEAD=128]="STOREREV_ONLY_HEAD",e[e.STOREREV_COUNT=256]="STOREREV_COUNT",e[e.ORIGINAL_MODTIME=512]="ORIGINAL_MODTIME",e[e.ARCHIVE_TRIGGER=1024]="ARCHIVE_TRIGGER"}(r=t.Modifiers||(t.Modifiers={})),t.GetFileType=function(e){const t={base:n.UNKNOWN,modifiers:r.NONE};if(!e||0===e.length)return t;const i=e.split("+");if(0===i.length)return t;switch(i[0].trim().toLowerCase()){case"text":t.base=n.TEXT;break;case"binary":t.base=n.BINARY;break;case"symlink":t.base=n.SYMLINK;break;case"apple":t.base=n.APPLE;break;case"resource":t.base=n.RESOURCE;break;case"unicode":t.base=n.UNICODE;break;case"utf8":t.base=n.UTF8;break;case"utf16":t.base=n.UTF16}if(1===i.length)return t;for(let e=0;e<i[1].length;++e){switch(i[1][e]){case"w":t.modifiers|=r.WRITABLE;break;case"x":t.modifiers|=r.EXECUTE;break;case"k":t.modifiers|=r.RCS_KEYWORD_EXPANSION;break;case"l":t.modifiers|=r.EXCLUSIVE_OPEN;break;case"C":t.modifiers|=r.STOREREV_FULL_COMPRESSED;break;case"D":t.modifiers|=r.STOREREV_RSC_DELTA;break;case"F":t.modifiers|=r.STOREREV_FULL_FILE;break;case"m":t.modifiers|=r.ORIGINAL_MODTIME;break;case"X":t.modifiers|=r.ARCHIVE_TRIGGER;break;case"S":if(t.storeRevCount=1,e+1<i[1].length){const n=i[1][e+1],r=Number(n);Number.isNaN(r)||(t.storeRevCount=r)}t.modifiers|=1===t.storeRevCount?r.STOREREV_ONLY_HEAD:r.STOREREV_COUNT}}return t}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(6)),s=i(1),a=n(i(2)),c=n(i(73)),l=n(i(85)),u=i(4),h=i(7),d=r.window.createTextEditorDecorationType({isWholeLine:!0,before:{margin:"0 1.75em 0 0"}}),p=r.window.createTextEditorDecorationType({isWholeLine:!0,backgroundColor:new r.ThemeColor("perforce.lineHighlightBackgroundColor"),overviewRulerColor:new r.ThemeColor("perforce.lineHighlightOverviewRulerColor"),overviewRulerLane:r.OverviewRulerLane.Left});class f{constructor(e,t,i){this._doc=e,this._annotations=t,this._decorations=i,this._p4Uri=a.fromUri(e),this._subscriptions=[],this._decorationsByChnum=this.mapToChnums(),this._subscriptions.push(r.window.onDidChangeActiveTextEditor(this.onEditorChanged.bind(this))),this._subscriptions.push(r.window.onDidChangeTextEditorSelection(this.onSelectionChanged.bind(this))),this._subscriptions.push(r.workspace.onDidCloseTextDocument(this.checkStillOpen.bind(this),this._subscriptions)),this.loadEditor()}static get onWillLoadEditor(){return this._onWillLoadEditor.event}mapToChnums(){return this._annotations.map((e,t)=>(null==e?void 0:e.revisionOrChnum)?{chnum:e.revisionOrChnum,decoration:this._decorations[t]}:void 0).filter(s.isTruthy)}async getOpenFileRangesIfSameFile(){var e;try{return await u.Display.isSameAsOpenFile(this._doc)?null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.visibleRanges:void 0}catch{}}async loadEditor(){f._onWillLoadEditor.fire(this._p4Uri);const e=await this.getOpenFileRangesIfSameFile();this._editor=await r.window.showTextDocument(this._p4Uri),e&&this._editor.revealRange(e[0]),this.applyBaseDecorations()}applyBaseDecorations(){this._editor&&this._editor.setDecorations(d,this._decorations)}applyHighlightDecorations(){if(!this._editor)return;const e=this._editor.selection.start.line,t=this._annotations[e],i=null==t?void 0:t.revisionOrChnum,n=this._decorationsByChnum.filter(e=>e.chnum===i).map(e=>e.decoration.range);this._editor.setDecorations(p,n)}clearDecorations(){var e,t;null===(e=this._editor)||void 0===e||e.setDecorations(d,[]),null===(t=this._editor)||void 0===t||t.setDecorations(p,[])}onSelectionChanged(e){this._editor&&e.textEditor===this._editor&&this.applyHighlightDecorations()}onEditorChanged(){var e,t,i;this.checkStillOpen(),(null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document)&&(null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document)===(null===(i=this._editor)||void 0===i?void 0:i.document)&&(this._editor=r.window.activeTextEditor,this.applyBaseDecorations(),this.applyHighlightDecorations())}checkStillOpen(){this._editor&&!r.workspace.textDocuments.includes(this._editor.document)&&(u.Display.channel.appendLine("Document closed: "+this._editor.document.uri),this.dispose())}dispose(){this.clearDecorations(),f._annotationsByUri.get(this._doc)===this&&f._annotationsByUri.delete(this._doc),this._decorationsByChnum=[],this._subscriptions.forEach(e=>e.dispose())}static getSecondaryIntegrations(e){return e.flatMap(e=>{const t=e.integrations.filter(e=>e.direction===o.Direction.FROM);return t.length>1?t.filter(e=>"copy"===e.operation):[]})}static async expandLogs(e,t,i){const n=f.getSecondaryIntegrations(t),r=s.addUniqueKeysToSet(i,n,"file");if(r.length>0){const t=r.map(t=>o.getFileHistory(e,{file:t.file,followBranches:!0})),n=await Promise.all(t),a=n.map(t=>this.expandLogs(e,t,i).catch(e=>u.Display.channel.appendLine(e))),c=(await Promise.all(a)).filter(s.isTruthy);return n.concat(...c)}return[]}static findLogInfoForChange(e,t,i,n){for(const r of t){const t=r.findIndex(t=>t.chnum===e);if(t>=0){const e=1/Math.min(Math.max(1,n),10),o=Math.max(1-e*i,0);return{log:r[t],prev:r[t+1],index:i,ageRating:o}}}}static toMapByChnum(e,t){const i=new Map,n=s.dedupe(e,"revisionOrChnum").map(e=>e.revisionOrChnum).sort((e,t)=>parseInt(t)-parseInt(e)),r=n.length,o=[];return n.forEach((e,n)=>{const s=this.findLogInfoForChange(e,t,n,r);s?i.set(e,s):o.push(e)}),o.length>0&&u.Display.showImportantError("Error during annotation - could not find change information for "+s.pluralise(o.length,"change")+": "+o.join(", ")),i}static async annotate(e){var t;const i=this._annotationsByUri.get(e);i&&i.dispose();const n=h.configAccessor.annotateFollowBranches,u=null!==(t=a.getUsableWorkspace(e))&&void 0!==t?t:e,d=o.annotate(u,{file:e,outputChangelist:!0,followBranches:n}),p=o.getFileHistory(u,{file:e,followBranches:n}),[g,v]=await Promise.all([d,p]),w=[v,...n?await this.expandLogs(u,v,new Set):[]],y=this.toMapByChnum(g.filter(s.isTruthy),w),_=function(e,t,i,n){const o=function(e,t,i){const n=new r.ThemeColor("perforce.gutterBackgroundColor"),o=new r.ThemeColor("perforce.gutterForegroundColor"),s=l.parseColumns(r.workspace.getConfiguration("perforce").get("annotate.gutterColumns",["{#}revision|3"])),a=l.calculateTotalWidth(s),u=new Map;return i.forEach(i=>{const h=i.log,d=i.prev,p=l.makeSummaryText(h,t,s),f=function(e,t,i,n){const o=c.makeAllLinks(e,t,i,n),s=new r.MarkdownString(c.makeUserAndDateSummary(e,t)+"\n\n"+o+"\n\n"+c.convertToMarkdown(t.description),!0);return s.isTrusted=!0,s}(e,h,t,d),g=m(i.ageRating,!0,p,f,o,n,a),v=m(i.ageRating,!1," ",f,o,n,a);u.set(h.chnum,{top:g,body:v})}),u}(e,i,n);return t.map((e,i)=>{var n;if(!e||!(null==e?void 0:e.revisionOrChnum))return;const s=o.get(e.revisionOrChnum);if(!s)return;const a=i>0&&e.revisionOrChnum===(null===(n=t[i-1])||void 0===n?void 0:n.revisionOrChnum)?s.body:s.top;return{range:new r.Range(i,0,i,0),...a}}).filter(s.isTruthy)}(u,g,v[0],y);a.getRevOrAtLabel(e)||a.isDepotUri(e)||!v[0]||(e=a.fromDepotPath(e,v[0].file,v[0].revision));const C=new f(e,g,_);return this._annotationsByUri.set(e,C),C}}function m(e,t,i,n,r,o,s){return{hoverMessage:n,renderOptions:{before:{contentText:" "+i,color:r,width:s+2+"ch",backgroundColor:o,border:"solid "+`rgba(246, 106, 10, ${e})`,textDecoration:t?"overline solid rgba(0, 0, 0, 0.2)":void 0,borderWidth:"0px 2px 0px 0px"}}}}t.AnnotationProvider=f,f._annotationsByUri=new Map,f._onWillLoadEditor=new r.EventEmitter,t.annotate=async function(e){return f.annotate(e)}},function(e,t,i){"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SEARCH_STATUS="changeSearch.statusFilter",e.SEARCH_USER="changeSearch.userFilter",e.SEARCH_CLIENT="changeSearch.clientFilter",e.SEARCH_FILES="changeSearch.fileFilters",e.SEARCH_AUTO_REFRESH="changeSearch.autoRefresh"}(n=t.MementoKeys||(t.MementoKeys={})),function(e){e.SPEC_CHANGELIST_MAP="changeMap",e.SPEC_JOB_MAP="jobMap"}(r=t.GlobalMementoKeys||(t.GlobalMementoKeys={}));t.MementoItem=class{constructor(e,t){this._key=e,this._memento=t}async save(e){await this._memento.update(this._key,e)}get value(){return this._memento.get(this._key)}},t.clearAllMementos=async function(e,t){await Promise.all(Object.values(n).map(t=>e.update(t,void 0))),await Promise.all(Object.values(r).map(e=>t.update(e,void 0)))}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(2)),s=n(i(6)),a=n(i(8)),c=i(11),l=i(4),u=i(15);t.jobQuickPickProvider={provideActions:async(e,t)=>{const i=a.asUri(e),n=await s.getJob(i,{existingJob:t});if("<enter description here>"===n.description)throw l.Display.showImportantError("Job "+t+" does not exist"),new Error("Job "+t+" does not exist");return{items:[...function(e){return[a.makeClipPick("job id",e.job),a.makeClipPick("description",e.description),a.makeClipPick("user",e.user)]}(n),{label:"$(file) Show job",description:"Open the full job spec in the editor",performAction:()=>{const e=o.forCommand(i,"job","-o "+t);r.window.showTextDocument(e)}},{label:"$(edit) Edit job",description:"Edit the full job spec in the editor",performAction:()=>u.jobSpecEditor.editSpec(i,t)},...await async function(e,t){const i=await s.fixes(e,{job:t}),n=i.length>0?await s.describe(e,{omitDiffs:!0,chnums:i.map(e=>e.chnum)}):[],r={label:"Fixed by changelists: "+i.length},o=i.map(t=>{const i=n.find(e=>e.chnum===t.chnum);return{label:" ".repeat(3)+((null==i?void 0:i.isPending)?"$(tools) ":"$(check) ")+t.chnum,description:"$(person) "+t.user+" $(calendar) "+t.date+" $(book) "+(null==i?void 0:i.description.join(" ")),performAction:()=>{c.showQuickPickForChangelist(e,t.chnum)}}});return[r,...o]}(i,t)],placeHolder:"Job "+n.job+" ("+n.status+") by "+n.user+" : "+n.description}}},t.showQuickPickForJob=async function(e,t){await a.showQuickPick("job",e,t)}},function(e,t,i){"use strict";const n=i(32);e.exports=(e,t={})=>{let i=(e,r={})=>{let o=t.escapeInvalid&&n.isInvalidBrace(r),s=!0===e.invalid&&!0===t.escapeInvalid,a="";if(e.value)return(o||s)&&n.isOpenOrClose(e)?"\\"+e.value:e.value;if(e.value)return e.value;if(e.nodes)for(let t of e.nodes)a+=i(t);return a};return i(e)}},function(e,t,i){"use strict";t.isInteger=e=>"number"==typeof e?Number.isInteger(e):"string"==typeof e&&""!==e.trim()&&Number.isInteger(Number(e)),t.find=(e,t)=>e.nodes.find(e=>e.type===t),t.exceedsLimit=(e,i,n=1,r)=>!1!==r&&(!(!t.isInteger(e)||!t.isInteger(i))&&(Number(i)-Number(e))/Number(n)>=r),t.escapeNode=(e,t=0,i)=>{let n=e.nodes[t];n&&(i&&n.type===i||"open"===n.type||"close"===n.type)&&!0!==n.escaped&&(n.value="\\"+n.value,n.escaped=!0)},t.encloseBrace=e=>"brace"===e.type&&(e.commas>>0+e.ranges>>0==0&&(e.invalid=!0,!0)),t.isInvalidBrace=e=>"brace"===e.type&&(!(!0!==e.invalid&&!e.dollar)||(e.commas>>0+e.ranges>>0==0||!0!==e.open||!0!==e.close)&&(e.invalid=!0,!0)),t.isOpenOrClose=e=>"open"===e.type||"close"===e.type||(!0===e.open||!0===e.close),t.reduce=e=>e.reduce((e,t)=>("text"===t.type&&e.push(t.value),"range"===t.type&&(t.type="text"),e),[]),t.flatten=(...e)=>{const t=[],i=e=>{for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?i(r,t):void 0!==r&&t.push(r)}return t};return i(e),t}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=n(i(3)),s=i(21),a=n(i(6)),c=i(4),l=n(i(2)),u=i(9),h=n(i(28)),d=n(i(13)),p=n(i(48)),f=i(8),m=i(1),g=i(49),v=i(14),w=i(15);!function(e){function t(){const e=r.window.activeTextEditor;return!!ue()&&(!(!e||!e.document)&&void i(e.document.uri))}async function i(e){try{await a.add(e,{files:[e]}),c.Display.showMessage("File opened for add"),c.Display.updateEditor()}catch{}u.PerforceSCMProvider.RefreshAll()}function n(){const e=r.window.activeTextEditor;return!!ue()&&(!(!e||!e.document)&&void _(e.document.uri))}async function y(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document;if(t){try{await r.window.withProgress({location:r.ProgressLocation.Notification,title:"Perforce: Opening file for edit"},()=>_(t.uri))}catch(e){c.Display.showError(e)}await t.save()}else await r.commands.executeCommand("workbench.action.files.save")}async function _(e){try{await a.edit(e,{files:[e]}),c.Display.showMessage("File opened for edit"),c.Display.updateEditor()}catch{}u.PerforceSCMProvider.RefreshAll()}async function C(){const e=r.window.activeTextEditor;if(!ue())return!1;if(!e||!e.document)return!1;const t=e.document.uri;await E(t)}async function S(){const e=r.window.activeTextEditor;if(!ue())return!1;if(!e||!e.document)return!1;const t=e.document.uri,i=l.basenameWithoutRev(t);await c.Display.requestConfirmation("Are you sure you want to revert "+i+"?","Revert "+i)&&await b(t)}async function b(e,t){const i={paths:[e]};try{await a.revert(null!=t?t:e,i),c.Display.showMessage(l.basenameWithoutRev(e)+" reverted."),c.Display.updateEditor(),u.PerforceSCMProvider.RefreshAll()}catch(e){}}async function E(t,i){await e.p4revert(t,i),await e.p4delete(t,i)}async function R(){var e,t;const i=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(!i||"file"!==i.scheme)return void c.Display.showError("No open file to submit");if(null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document.isDirty)return void c.Display.showModalMessage("The active document has unsaved changes. Save the file first!");const n=await r.window.showInputBox({prompt:"Enter a changelist description to submit '"+l.fsPathWithoutRev(i)+"'",validateInput:e=>{if(!e.trim())return"Description must not be empty"}});if(!n)return;const o=await a.submitChangelist(i,{description:n,file:i});D(i),u.PerforceSCMProvider.RefreshAll(),c.Display.showMessage("Changelist "+o.chnum+" submitted")}async function P(e,t){const i=(await a.getFileHistory(e,{file:e,followBranches:!1,omitNonContributoryIntegrations:!0})).filter((e,t,i)=>e.file===i[0].file).map(e=>({label:`#${e.revision} change: ${e.chnum}`,description:e.description,item:e})),n=await r.window.showQuickPick(i,{placeHolder:t});return null==n?void 0:n.item}function D(e){var t;null===(t=g.perforceFsProvider())||void 0===t||t.requestUpdatedDocument(l.fromUriWithRevision(e,"have"))}async function k(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(t&&"file"===t.scheme){try{await a.sync(t,{files:[t]}),c.Display.showMessage("File Synced"),D(t)}catch{}u.PerforceSCMProvider.RefreshAll()}else c.Display.showError("No open file to sync")}async function x(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(!t||"file"!==t.scheme)return void c.Display.showError("No open file to sync");const i=await P(t,"Choose a revision to sync");if(i){const e=l.fromDepotPath(t,i.file,i.revision);try{await a.sync(t,{files:[e]}),c.Display.showMessage("File Synced"),D(t)}catch{}u.PerforceSCMProvider.RefreshAll()}}function O(e){return r.window.withProgress({location:{viewId:"workbench.view.explorer"}},e)}async function A(e,t){return L(e,t,(e,t)=>a.sync(t,{files:e}),{message:"Sync complete",hideSubErrors:!0})}async function F(e){try{return(await r.workspace.fs.stat(e)).type===r.FileType.Directory}catch(e){return!1}}async function T(e,t){await F(e)?await async function(e,t){const i=o.join(e.fsPath,"..."),n=o.join(t,"...");try{await a.edit.ignoringAndHidingStdErr(e,{files:[i]}),await a.move(e,{fromToFile:[i,n]})}catch(e){c.Display.showImportantError(e.toString())}}(e,t):await async function(e,t){try{await a.edit.ignoringAndHidingStdErr(e,{files:[e]}),await a.move(e,{fromToFile:[e,t]})}catch(e){c.Display.showImportantError(e.toString())}}(e,t)}function I(e){return[o.dirname(e).length+1,e.length]}async function M(e,t){const i=await r.window.showInputBox({prompt:"Enter the new path for "+o.basename(e.fsPath),value:e.fsPath,placeHolder:e.fsPath,valueSelection:I(e.fsPath)});if(i){try{await O(()=>T(e,i)),!0===t&&await r.window.showTextDocument(r.Uri.file(i))}catch(e){c.Display.showImportantError(e.toString())}u.PerforceSCMProvider.RefreshAll()}}async function N(e,t){var i;t.length>1?await async function(e){const t=o.dirname(e[0].fsPath);if(e.find(e=>o.dirname(e.fsPath)!==t))return void c.Display.showModalMessage("To move multiple files, all moved files must be within the same folder");const i=await r.window.showInputBox({prompt:"Enter the new location for the "+e.length+" selected files",value:t,placeHolder:t,valueSelection:I(t)});if(i){const t=e.map(e=>T(e,o.join(i,o.basename(e.fsPath))));try{await O(()=>Promise.all(t))}catch(e){c.Display.showImportantError(e.toString())}u.PerforceSCMProvider.RefreshAll()}}(t):await M(e,(null===(i=r.window.activeTextEditor)||void 0===i?void 0:i.document.uri.fsPath)===e.fsPath)}function U(e,t){const i=null!=t?t:[],n="string"==typeof e?l.parse(e):e;return[n,...i.filter(e=>e.fsPath!==n.fsPath)]}async function L(e,t,i,n){var s;const a=U(e,t),l=await async function(e){return await Promise.all(e.map(async e=>{const t=await F(e);return{file:t?r.Uri.file(o.join(e.fsPath,"...")):e,isDir:t,dir:t?e:r.Uri.file(o.dirname(e.fsPath))}}))}(a),h=m.splitBy(l,e=>e.dir.fsPath).map(async e=>{try{await i(e.map(e=>e.file),e[0].dir)}catch(e){throw(null==n?void 0:n.hideSubErrors)||c.Display.showImportantError(e),e}finally{e.forEach(e=>{e.isDir||D(e.file)})}});try{await O(()=>Promise.all(h)),c.Display.showMessage(null!==(s=null==n?void 0:n.message)&&void 0!==s?s:"Operation complete")}catch(e){}u.PerforceSCMProvider.RefreshAll(),c.Display.updateEditor()}function H(e,t){return L(e,t,(e,t)=>a.add(t,{files:e}))}function W(e,t){return L(e,t,(e,t)=>a.edit(t,{files:e}))}async function $(e){const t=(await Promise.all(e.map(e=>F(e)))).filter(m.isTruthy).length,i=e.length-t;return[i>0?m.pluralise(i,"file"):void 0,t>0?"ALL FILES in "+m.pluralise(t,"folder"):void 0].filter(m.isTruthy).join(", and ")}async function j(e,t){const i=U(e,t),n=await $(i);await c.Display.requestConfirmation("Are you sure you want to revert "+n+"?","Revert "+n)&&await L(e,t,(e,t)=>a.revert(t,{paths:e}),{hideSubErrors:!0})}function B(e,t){return L(e,t,(e,t)=>a.revert(t,{paths:e,unchanged:!0}),{hideSubErrors:!0})}async function G(e,t){const i=U(e,t),n=await $(i);await c.Display.requestConfirmation("Are you sure you want to delete "+n+"?\nThis operation does not revert open files","Delete "+n)&&await L(e,t,(e,t)=>a.del(t,{paths:e}))}async function q(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;t&&"file"===t.scheme?await M(t,!0):c.Display.showError("No open file to sync")}async function Q(e){const t=r.window.activeTextEditor;if(!ue())return!1;if(!he())return!1;if(!t||!t.document)return!1;const i=t.document;if(!i.isUntitled){if(!e)return void await K(t.document.uri);const n=e&&!isNaN(e)?e.toString():"have",r=l.fromUriWithRevision(i.uri,n),o=i.uri;await d.diffFiles(r,o)}}async function V(){const e=r.window.activeTextEditor;if(!ue())return!1;if(!he())return!1;if(!e||!e.document)return!1;const t=e.document,i=await P(t.uri,"Choose a revision to diff against");i&&Q(parseInt(i.revision))}async function K(e){var t;if(e||(e=null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document.uri),!e)return c.Display.showError("No file to diff"),!1;await d.diffPrevious(e)}async function J(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(!t)return c.Display.showError("No file to diff"),!1;await d.diffPrevious(t,!0)}async function Y(e){var t;if(e||(e=null===(t=r.window.activeTextEditor)||void 0===t?void 0:t.document.uri),!e)return c.Display.showError("No file to diff"),!1;await d.diffNext(e)}async function X(e,t){await d.diffFiles(e,t)}async function z(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;t?await p.showQuickPickForFile(t):c.Display.showError("No document selected")}async function Z(e){const t=null!=e?e:function(){const e=r.window.activeTextEditor;if(!ue())return;if(!e||!e.document)return;return e.document.uri}();if(!t)return!1;await r.window.withProgress({location:r.ProgressLocation.Window,cancellable:!1,title:"Generating annotations"},()=>h.annotate(t))}function ee(){if(!he())return!1;if(!r.workspace.workspaceFolders)return!1;let e=r.workspace.workspaceFolders[0].uri;if(r.workspace.workspaceFolders.length>1&&r.window.activeTextEditor&&r.window.activeTextEditor.document){const t=r.workspace.getWorkspaceFolder(r.window.activeTextEditor.document.uri);t&&(e=t.uri)}s.PerforceService.execute(e,"opened",(t,i,n)=>{if(t)c.Display.showError(t.message);else if(n)c.Display.showError(n.toString());else{const t=i.toString().trim().split("\n");if(0===t.length)return!1;const n=t.map(e=>({description:e,label:o.basename(e)}));r.window.showQuickPick(n,{matchOnDescription:!0}).then(t=>{if(!t)return!1;const i=t.description,n=i.substring(0,i.indexOf("#"));(function(e,t){return new Promise((i,n)=>{if(!he())return void n();const r=[t];s.PerforceService.execute(e,"where",(e,t,r)=>{e?(c.Display.showError(e.message),n(e)):r?(c.Display.showError(r.toString()),n(r)):i(t.toString())},r)})})(e,n).then(e=>{const t=e.split(" ");if(t.length>=3){const e=t[2].trim();r.workspace.openTextDocument(r.Uri.file(e)).then(e=>{r.window.showTextDocument(e)},e=>{c.Display.showError(e)})}}).catch(e=>{c.Display.showError(e)})})}})}function te(){return r.window.activeTextEditor&&!r.window.activeTextEditor.document.isUntitled?r.window.activeTextEditor.document.uri:r.workspace.workspaceFolders?r.workspace.workspaceFolders[0].uri:r.Uri.parse("")}async function ie(){const e=te();await c.Display.doLogoutFlow(e)}async function ne(){const e=te();await c.Display.doLoginFlow(e)&&u.PerforceSCMProvider.RefreshAll()}async function re(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document;t&&await w.jobSpecEditor.inputSpec(t)}async function oe(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document;t&&await w.changeSpecEditor.inputSpec(t)}async function se(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document;t&&await w.jobSpecEditor.refreshSpec(t)}async function ae(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document;t&&await w.changeSpecEditor.refreshSpec(t)}function ce(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(t)return v.showRevChooserForFile(l.fromUriWithRevision(t,"have"))}function le(){const e=[];e.push({label:"add",description:"Open a new file to add it to the depot"}),e.push({label:"edit",description:"Open an existing file for edit"}),e.push({label:"revert",description:"Discard changes from an opened file"}),e.push({label:"submit single file",description:"Submit the open file, ONLY if it is in the default changelist"}),e.push({label:"move",description:"Move or rename the open file"}),e.push({label:"sync file",description:"Sync the file to the latest revision"}),e.push({label:"sync revision",description:"Choose a revision to sync"}),e.push({label:"diff",description:"Display diff of client file with depot file"}),e.push({label:"diffRevision",description:"Display diff of client file with depot file at a specific revision"}),e.push({label:"annotate",description:"Print file lines and their revisions"}),e.push({label:"history",description:"Show file history"}),e.push({label:"opened",description:"View 'open' files and open one in editor"}),e.push({label:"login",description:"Log in to Perforce"}),e.push({label:"logout",description:"Log out from Perforce"}),r.window.showQuickPick(e,{matchOnDescription:!0,placeHolder:"Choose a Perforce command:"}).then((function(e){if(void 0!==e)switch(e.label){case"add":t();break;case"edit":n();break;case"revert":S();break;case"move":q();break;case"submit single file":R();break;case"sync file":k();break;case"sync revision":x();break;case"diff":Q();break;case"diffRevision":V();break;case"annotate":Z();break;case"opened":ee();break;case"login":ne();break;case"logout":ie();break;case"history":ce()}}))}function ue(){return!!r.window.activeTextEditor||(c.Display.showMessage("No file selected"),!1)}function he(){return void 0!==r.workspace.workspaceFolders||(c.Display.showMessage("No folder selected"),!1)}e.registerCommands=function(){r.commands.registerCommand("perforce.add",t),r.commands.registerCommand("perforce.edit",n),r.commands.registerCommand("perforce.delete",C),r.commands.registerCommand("perforce.revert",S),r.commands.registerCommand("perforce.submitSingle",R),r.commands.registerCommand("perforce.syncOpenFile",k),r.commands.registerCommand("perforce.syncOpenFileRevision",x),r.commands.registerCommand("perforce.explorer.syncPath",A),r.commands.registerCommand("perforce.showOpenFileHistory",ce),r.commands.registerCommand("perforce.explorer.move",N),r.commands.registerCommand("perforce.explorer.add",H),r.commands.registerCommand("perforce.explorer.edit",W),r.commands.registerCommand("perforce.explorer.revert",j),r.commands.registerCommand("perforce.explorer.revertUnchanged",B),r.commands.registerCommand("perforce.explorer.delete",G),r.commands.registerCommand("perforce.move",q),r.commands.registerCommand("perforce.diff",Q),r.commands.registerCommand("perforce.diffRevision",V),r.commands.registerCommand("perforce.diffPrevious",K),r.commands.registerCommand("perforce.diffPreviousFromDiff",J),r.commands.registerCommand("perforce.diffNext",Y),r.commands.registerCommand("perforce.depotActions",z),r.commands.registerCommand("perforce.showQuickPick",f.showQuickPick),r.commands.registerCommand("perforce.showLastQuickPick",f.openLastQuickPick),r.commands.registerCommand("perforce.showRecentQuickPick",f.chooseRecentQuickPick),r.commands.registerCommand("perforce.annotate",Z),r.commands.registerCommand("perforce.opened",ee),r.commands.registerCommand("perforce.logout",ie),r.commands.registerCommand("perforce.login",ne),r.commands.registerCommand("perforce.diffFiles",X),r.commands.registerCommand("perforce.menuFunctions",le),r.commands.registerCommand("perforce.saveJobSpec",re),r.commands.registerCommand("perforce.saveChangeSpec",oe),r.commands.registerCommand("perforce.refreshJobSpec",se),r.commands.registerCommand("perforce.refreshChangeSpec",ae)},e.registerImportantCommands=function(e){e.push(r.commands.registerCommand("perforce.editAndSave",y))},e.p4add=i,e.p4edit=_,e.deleteOpenFile=C,e.p4delete=async function(e,t){const i={paths:[e]};try{await a.del(null!=t?t:e,i),c.Display.showMessage(l.fsPathWithoutRev(e)+" deleted."),c.Display.updateEditor(),u.PerforceSCMProvider.RefreshAll()}catch(e){}},e.revertOpenFile=S,e.p4revert=b,e.p4revertAndDelete=E,e.submitSingle=R,e.syncOpenFile=k,e.syncOpenFileRevision=x,e.syncExplorerPath=A,e.moveExplorerFiles=N,e.addExplorerFiles=H,e.editExplorerFiles=W,e.revertExplorerFiles=j,e.revertExplorerFilesUnchanged=B,e.deleteExplorerFiles=G,e.moveOpenFile=q,e.diff=Q,e.diffRevision=V,e.annotate=Z,e.opened=ee,e.logout=ie,e.login=ne,e.menuFunctions=le,e.checkFolderOpened=he}(t.PerforceCommands||(t.PerforceCommands={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t,i){this._func=e,this._time=i,this._expires=t+i,this._expired=!1}executeNow(...e){return this._timer=setTimeout(()=>{this._expired=!0},this._expires-Date.now()),Promise.resolve(this._func(...e))}get canExecute(){return!this._expired}executeAfterDebounce(e,...t){return this._expires=e+this._time,void 0===this._promise&&(this._promise=new Promise((e,t)=>{this.res=t=>e(t),this.rej=e=>t(e)})),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{var e,i;try{const i=this._func(...t);null===(e=this.res)||void 0===e||e.call(this,i)}catch(e){null===(i=this.rej)||void 0===i||i.call(this,e)}this._expired=!0},this._expires-Date.now()),this._promise}cancel(){this._timer&&!this._expired&&clearTimeout(this._timer),void 0!==this._promise&&this.rej&&this.rej("Debounced function cancelled")}}t.debounce=function(e,t,i){let r;const o=(...o)=>{const s=Date.now();return null==i||i(...o),r&&r.canExecute?r.executeAfterDebounce(s,...o):(r=new n(e,s,t),r.executeNow(...o))};return o.withoutLeadingCall=(...o)=>{const s=Date.now();return null==i||i(...o),r&&r.canExecute||(r=new n(e,s,t)),r.executeAfterDebounce(s,...o)},o.dispose=()=>{r&&r.cancel(),r=void 0},o}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUri=function(e){return e&&void 0!==e.fsPath&&void 0!==e.scheme}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=(e,t=[])=>e.length<2?e:(...i)=>{return(r=[...t,...i]).length>=e.length?e(...r):n(e,r);var r};t.curry=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(24),r=i(38),o=n.default(r.default);t.railAsync=o,t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(26),r=(e,t,i)=>t instanceof Promise?t.then(t=>n.default(e,t)):i?Promise.resolve(n.default(e,t)):n.default(e,t);t.wrapAsync=r,t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(25),r=i(38),o=n.default(r.default);t.railRightAsync=o,t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(23),o=r.pipe(n.removeLeadingNewline,n.splitIntoLines,n.removeIndent);t.getBasicField=(e,t)=>{var i;return null===(i=e.find(e=>e.name===t))||void 0===i?void 0:i.value};t.parseSpecOutput=r.pipe(n.splitIntoSections,e=>e.filter(e=>!e.startsWith("#")&&""!==e),(function(e){return e.map(e=>{const t=e.indexOf(":");return{name:e.slice(0,t),value:o(e.slice(t+2))}})}))},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(42),s=i(10),a=i(27),c=n(i(2)),l=i(1);t.Resource=class{constructor(e,t,i,n,r,o,l,u){var h,d,p;if(this.model=e,this._uri=t,this._underlyingUri=i,this._change=n,this._isShelved=r,this._statuses=s.GetStatuses(o),this._workingRevision=null!==(d=null!==(h=l.workRev)&&void 0!==h?h:l.haveRev)&&void 0!==d?d:"have",this._isShelved)this._resourceUri=c.fromUri(t),this._openUri=c.fromUriWithRevision(t,"@="+this.change),this._isUnresolved=!1,this._isReresolvable=!1;else{if(!i)throw new Error("Files in the local workspace must have an underlying URI");this._resourceUri=i,this._openUri=i,this._isUnresolved=!!l.unresolved,this._isReresolvable=!!l.reresolvable}this._fromEndRev=l.resolveEndFromRev0,l.resolveFromFile0&&(this._fromFile=c.fromDepotPath(null!==(p=this._underlyingUri)&&void 0!==p?p:e.workspaceUri,l.resolveFromFile0,this._fromEndRev)),this._headType=a.GetFileType(u)}get contextValue(){return[[this._isShelved,"shelved","opened"],[this._isUnresolved,"unres",void 0],[this._isReresolvable,"reres",void 0]].map(([e,t,i])=>e?t:i).filter(l.isTruthy).join("-")}get uri(){return this._uri}get openUri(){return this._openUri}get resourceUri(){return this._resourceUri}get actionUriNoRev(){return this._resourceUri}get basenameWithoutRev(){return c.basenameWithoutRev(this.uri)}get decorations(){return o.DecorationProvider.getDecorations(this._statuses,this._isShelved,this._isUnresolved)}get underlyingUri(){return this._underlyingUri}get depotPath(){return c.getDepotPathFromDepotUri(this._uri)}get fromFile(){return this._fromFile}get fromEndRev(){return this._fromEndRev}get status(){return this._statuses.length>0?this._statuses[0]:s.Status.UNKNOWN}get command(){return{title:"Open",command:r.workspace.getConfiguration("perforce").get("scmFileChanges")?"perforce.openResource":"perforce.openFile",arguments:[this]}}get change(){return this._change}get workingRevision(){return this._workingRevision}get isUnresolved(){return this._isUnresolved}get isReresolvable(){return this._isReresolvable}get isShelved(){return this._isShelved}get FileType(){return this._headType}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(10),s=n(i(3)),a=i(72),c=i(1);class l{static getDecorations(e,t,i){const n=this.getDominantStatus(e),r={iconPath:l.getIconPath(n,t,i,"light")},o={iconPath:l.getIconPath(n,t,i,"dark")};return{strikeThrough:l.useStrikeThrough(n),faded:t,light:r,dark:o,tooltip:this.getTooltipText(n,t,i)}}static getFileDecorations(e,t){const i=this.getDominantStatus(e),n=l.getStatusDecorations(i),o=t?n.tooltip+" - unresolved":n.tooltip,s=t?"unresolved":n.colorName;return{tooltip:o,badge:n.badge,color:s?new r.ThemeColor("perforceDecoration."+s+"Foreground"):void 0,propagate:!0}}static getDominantStatus(e){if(!e||0===e.length)return;if(1===e.length)return e[0];let t=e.findIndex(e=>e===o.Status.ADD||e===o.Status.EDIT||e===o.Status.DELETE);return t>=0?e[t]:(t=e.findIndex(e=>e===o.Status.MOVE_ADD||e===o.Status.MOVE_DELETE),t>=0?e[t]:e[0])}static getTooltipText(e,t,i){return[t?"Shelved":void 0,void 0!==e?a.getStatusText(e):void 0,i?"NEEDS RESOLVE":void 0].filter(c.isTruthy).join(" - ")}static getIconUri(e,t){return r.Uri.file(s.join(l._iconsRootPath,t,e+".svg"))}static getIconPath(e,t,i,n){const r="status-"+(t?"shelve-":"")+(i?"unresolved-":"");switch(e){case o.Status.ADD:return l.getIconUri(r+"add",n);case o.Status.ARCHIVE:return l.getIconUri(r+"archive",n);case o.Status.BRANCH:return l.getIconUri(r+"branch",n);case o.Status.DELETE:return l.getIconUri(r+"delete",n);case o.Status.EDIT:return l.getIconUri(r+"edit",n);case o.Status.IMPORT:case o.Status.INTEGRATE:return l.getIconUri(r+"integrate",n);case o.Status.LOCK:return l.getIconUri(r+"lock",n);case o.Status.MOVE_ADD:case o.Status.MOVE_DELETE:return l.getIconUri(r+"move",n);case o.Status.PURGE:return l.getIconUri(r+"delete",n);default:return}}static useStrikeThrough(e){return e===o.Status.DELETE||e===o.Status.MOVE_DELETE}static getStatusDecorations(e){switch(e){case o.Status.ADD:return{badge:"A",tooltip:"Add",colorName:"add"};case o.Status.ARCHIVE:return{badge:"a",tooltip:"Archive",colorName:"archive"};case o.Status.BRANCH:return{badge:"B",tooltip:"Branch",colorName:"branch"};case o.Status.DELETE:return{badge:"D",tooltip:"Delete",colorName:"delete"};case o.Status.EDIT:return{badge:"E",tooltip:"Edit",colorName:"edit"};case o.Status.IMPORT:return{badge:"i",tooltip:"Import",colorName:"import"};case o.Status.INTEGRATE:return{badge:"I",tooltip:"Integrate",colorName:"integrate"};case o.Status.LOCK:return{badge:"L",tooltip:"Lock",colorName:"lock"};case o.Status.MOVE_ADD:return{badge:"M",tooltip:"Move/Add",colorName:"moveAdd"};case o.Status.MOVE_DELETE:return{badge:"M",tooltip:"Move/Delete",colorName:"moveDelete"};case o.Status.PURGE:return{badge:"P",tooltip:"Purge",colorName:"purge"};default:return{}}}}t.DecorationProvider=l,l._iconsRootPath=s.join(s.dirname(__dirname),"resources","icons")},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(2)),o=n(i(6)),s=n(i(8)),a=i(14);t.integrationQuickPickProvider={provideActions:async e=>{const t=s.asUri(e);return{items:await async function(e){const t=parseInt(r.getRevOrAtLabel(e));return(await o.integrated(e,{file:e,intoOnly:!0,startingChnum:r.getRevOrAtLabel(e)})).filter(e=>function(e,t,i){if(!t)return parseInt(i)===e;return parseInt(t)<=e&&parseInt(i)>=e}(t,e.fromStartRev,e.fromEndRev)).map(t=>({label:"$(git-merge) "+t.toFile+"#"+t.toRev,description:t.operation+" from #"+s.toRevString(t.fromStartRev,t.fromEndRev),performAction:()=>{var i;const n=r.fromDepotPath(null!==(i=r.getUsableWorkspace(e))&&void 0!==i?i:e,t.toFile,t.toRev);a.showQuickPickForFile(n)}}))}(t),excludeFromHistory:!0,placeHolder:"Choose integration for "+r.getDepotPathFromDepotUri(t)+"#"+r.getRevOrAtLabel(t)}}},t.showIntegPickForFile=async function(e){await s.showQuickPick("integ",e)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=i(45),s=i(9),a=n(i(3)),c=i(86),l=i(11),u=i(4),h=n(i(6)),d=i(1),p=i(88),f=i(7),m=i(46),g=n(i(2)),v=i(10),w=n(i(13)),y=i(29);class _ extends o.SelfExpandingTreeItem{constructor(e){super("Context:",r.TreeItemCollapsibleState.None),this._providerSelection=e,this.tooltip="Choose a perforce instance to use as context for the search",this._subscriptions.push(s.PerforceSCMProvider.onDidChangeScmProviders(this.onDidChangeScmProviders.bind(this))),this._subscriptions.push(e.onDidChangeProvider(e=>{this.description=e?e.clientName+" / "+e.userName:"<choose a perforce instance>",this.didChange()})),this.setClient(s.PerforceSCMProvider.clientRoots[0])}get selectedClient(){return this._providerSelection.client}setClient(e){this._providerSelection.client=e}onDidChangeScmProviders(){this.selectedClient&&s.PerforceSCMProvider.GetInstanceByClient(this.selectedClient)||this.setClient(s.PerforceSCMProvider.clientRoots[0])}get iconPath(){return new r.ThemeIcon("account")}get command(){return{command:"perforce.changeSearch.chooseProvider",title:"Choose Provider",tooltip:"Choose a perforce instance for performing the search",arguments:[this]}}async chooseProvider(){const e=s.PerforceSCMProvider.clientRoots.map(e=>({label:a.basename(e.clientRoot.fsPath),description:e.clientName+" $(person) "+e.userName,client:e})),t=await r.window.showQuickPick(e,{matchOnDescription:!0,placeHolder:"Choose a perforce instance to use as context for the search"});t&&t.client!==this.selectedClient&&this.setClient(t.client)}}class C extends o.SelfExpandingTreeItem{constructor(e){super("Go to changelist..."),this._chooseProvider=e}async execute(){const e=this._chooseProvider.selectedClient;if(!e)throw u.Display.showImportantError("Please choose a context before entering a changelist number"),new Error("No context for changelist search");const t=await u.Display.requestChangelistNumber();void 0!==t&&l.showQuickPickForChangelist(e.configSource,t)}get command(){return{command:"perforce.changeSearch.goToChangelist",arguments:[this],title:"Go to changelist"}}get iconPath(){return new r.ThemeIcon("rocket")}}class S extends o.SelfExpandingTreeItem{constructor(e,t){super(S.makeLabel(!!t.value)),this._root=e,this._memento=t,this.tooltip="Apply current filters",this._autoRefresh=!!t.value}static makeLabel(e){return"Search Now\t(Auto: "+(e?"on":"off")+")"}get autoRefresh(){return this._autoRefresh}set autoRefresh(e){this._autoRefresh=e,this.label=S.makeLabel(this._autoRefresh),this.didChange(),this._memento.save(e)}get command(){return{command:"perforce.changeSearch.run",arguments:[this._root],title:"Run Search"}}get iconPath(){return new r.ThemeIcon("search")}get contextValue(){return this._autoRefresh?"searchNow-auto":"searchNow-manual"}}class b extends o.SelfExpandingTreeItem{constructor(e,t,i){super(t.depotPath+"#"+t.revision),this._resource=e,this._file=t,this._chnum=i,this.description=t.operation}get iconPath(){return new r.ThemeIcon(l.getOperationIcon(this._file.operation))}get command(){var e;return{command:"perforce.showQuickPick",arguments:["shelvedFile",(null!==(e=g.getUsableWorkspace(this._resource))&&void 0!==e?e:this._resource).toString(),JSON.stringify(this._file),this._chnum],title:"Show shelved file quick pick"}}get canDiff(){const e=v.GetStatus(this._file.operation);return!v.operationCreatesFile(e)}get canOpen(){const e=v.GetStatus(this._file.operation);return!v.operationDeletesFile(e)}get perforceUri(){return g.fromDepotPath(this._resource,this._file.depotPath,"@="+this._chnum)}get contextValue(){return"fileResult-shelved"+(this.canDiff?"-diffable":"")+(this.canOpen?"-openable":"")}}class E extends o.SelfExpandingTreeItem{constructor(e,t){super("Shelved Files ("+t.shelvedFiles.length+")",r.TreeItemCollapsibleState.Collapsed);t.shelvedFiles.map(i=>new b(e,i,t.chnum)).forEach(e=>this.addChild(e))}get iconPath(){return new r.ThemeIcon("files")}}class R extends o.SelfExpandingTreeItem{constructor(e,t,i){super(t.depotPath+"#"+t.revision),this._resource=e,this._file=t,this._change=i,this.description=t.operation}get iconPath(){return new r.ThemeIcon(l.getOperationIcon(this._file.operation))}get command(){var e;return{command:"perforce.showQuickPick",arguments:["file",g.fromDepotPath(null!==(e=g.getUsableWorkspace(this._resource))&&void 0!==e?e:this._resource,this._file.depotPath,this._file.revision).toString()],title:"Show file quick pick"}}get canDiff(){return!this._change.isPending}get canOpen(){if(this._change.isPending)return!1;const e=v.GetStatus(this._file.operation);return!v.operationDeletesFile(e)}get perforceUri(){return g.fromDepotPath(this._resource,this._file.depotPath,this._file.revision)}get contextValue(){return"fileResult"+(this.canDiff?"-diffable":"")+(this.canOpen?"-openable":"")}}class P extends o.SelfExpandingTreeItem{constructor(e,t){super(t.chnum+": "+t.description.join(" ").slice(0,32),r.TreeItemCollapsibleState.None),this._resource=e,this._change=t,this.description=t.user}get chnum(){return this._change.chnum}addDetails(e){this.clearChildren();e.affectedFiles.map(t=>new R(this._resource,t,e)).forEach(e=>this.addChild(e));const t=this.collapsibleState;this.collapsibleState=t===r.TreeItemCollapsibleState.Expanded?t:r.TreeItemCollapsibleState.Collapsed}addShelvedFiles(e){this.getChildren().filter(e=>{var t;return null===(t=e.labelText)||void 0===t?void 0:t.startsWith("Shelved Files")}).forEach(e=>e.dispose()),e.shelvedFiles.length>0&&this.insertChild(new E(this._resource,e))}get iconPath(){return new r.ThemeIcon(this._change.isPending?"tools":"check")}get command(){return{command:"perforce.showQuickPick",arguments:["change",this._resource.toString(),this._change.chnum],title:"Show changelist quick pick"}}get tooltip(){return this._change.description.join(" ")}}class D extends o.SelfExpandingTreeItem{constructor(e,t,i){super(i,r.TreeItemCollapsibleState.Expanded),this._resource=e,this._isPinned=!1,this._results=d.dedupe(t,"chnum");this._results.map(e=>new P(this.resource,e)).forEach(e=>this.addChild(e)),this.populateChangeDetails()}get results(){return this._results}get resource(){return this._resource}async populateChangeDetails(){if(this._results.length<1)return;const e=this._results.map(e=>e.chnum),t=await h.describe(this._resource,{omitDiffs:!0,chnums:e}),i=this.getChildren();t.forEach(e=>{const t=i.find(t=>t.chnum===e.chnum);null==t||t.addDetails(e)}),this.didChange(),this.populateShelvedFiles()}async populateShelvedFiles(){try{const e=this._results.filter(e=>e.isPending).map(e=>e.chnum);if(e.length<1)return;const t=await h.describe(this._resource,{omitDiffs:!0,chnums:e,shelved:!0}),i=this.getChildren();t.forEach(e=>{const t=i.find(t=>t.chnum===e.chnum);null==t||t.addShelvedFiles(e)}),this.didChange()}catch(e){}}async refresh(){this._results=d.dedupe(await this.getNewResults(),"chnum"),this.clearChildren();this._results.map(e=>new P(this._resource,e)).forEach(e=>this.addChild(e)),this.reveal(),this.populateChangeDetails()}pin(){this._isPinned=!0,this.didChange()}unpin(){this._isPinned=!1,this.didChange()}get pinned(){return this._isPinned}get contextValue(){return this._isPinned?"results-pinned":"results-unpinned"}showInQuickPick(){var e,t,i,n;t=this._resource,i=null!==(e=this.labelText)&&void 0!==e?e:"Search Results",n=this._results,m.showQuickPickForChangeSearch(t,i,n)}}class k extends D{constructor(e,t){super(e,[t],"Focused changelist "+t.chnum),this._result=t,this.pin()}async getNewResults(){return await h.describe(this.resource,{chnums:[this._result.chnum],omitDiffs:!0})}}class x extends D{constructor(e,t,i){super(e,i,x.makeLabelText(t,i)),this._filters=t}static makeLabelText(e,t){return c.makeFilterLabelText(e,t.length)}async getNewResults(){return await A(this.resource,this._filters)}}class O extends o.SelfExpandingTreeItem{constructor(){super("Results",r.TreeItemCollapsibleState.Expanded,{reverseChildren:!0})}addResults(e,t,i){this.removeUnpinned();const n=new x(e.configSource,t,i);this.addChild(n),this.didChange(),n.reveal({expand:!0})}addSingleResult(e,t){const i=new k(e,t);this.addChild(i),this.didChange(),i.reveal({expand:!0})}removeUnpinned(){this.getChildren().forEach(e=>{var t;(t=e)&&t.pin&&t.unpin&&!e.pinned&&e.dispose()})}}async function A(e,t){const i=f.configAccessor.changelistSearchMaxResults;return await r.window.withProgress({location:{viewId:"perforce.searchChangelists"}},()=>h.getChangelists(e,{...t,maxChangelists:i}))}class F extends o.SelfExpandingTreeRoot{constructor(e){super(),this._providerSelection=new p.ProviderSelection,this._subscriptions.push(this._providerSelection),this._chooseProvider=new _(this._providerSelection),this._filterRoot=new c.FilterRootItem(this._providerSelection,e),this._allResults=new O,this._runSearch=new S(this,new y.MementoItem(y.MementoKeys.SEARCH_AUTO_REFRESH,e)),this._subscriptions.push(this._filterRoot.onDidChangeFilters(()=>{this._runSearch.autoRefresh&&this.executeSearch()})),this._subscriptions.push(this._runSearch.onChanged(()=>{this._runSearch.autoRefresh&&this.executeSearch()})),this.addChild(this._chooseProvider),this.addChild(new C(this._chooseProvider)),this.addChild(this._filterRoot),this.addChild(this._runSearch),this.addChild(this._allResults)}async executeSearch(){const e=this._chooseProvider.selectedClient;if(!e)throw u.Display.showImportantError("Please choose a context before searching"),new Error("No context for changelist search");const t=this._filterRoot.currentFilters,i=await A(e.configSource,t);this._allResults.addResults(e,t,i),this.didChange()}focusChangelist(e,t){this._allResults.addSingleResult(e,t),this.didChange(),r.commands.executeCommand("perforce.searchChangelists.focus")}}let T;t.focusChangelist=function(e,t){T.focusChangelist(e,t)},t.registerChangelistSearch=function(e){r.commands.registerCommand("perforce.changeSearch.chooseProvider",e=>e.chooseProvider()),r.commands.registerCommand("perforce.changeSearch.resetFilters",e=>e.resetAllFilters()),r.commands.registerCommand("perforce.changeSearch.resetFilter",e=>e.reset()),r.commands.registerCommand("perforce.changeSearch.setFilter",e=>e.requestNewValue()),r.commands.registerCommand("perforce.changeSearch.addFileFilter",e=>e.addNewFilter()),r.commands.registerCommand("perforce.changeSearch.editFileFilter",e=>e.edit()),r.commands.registerCommand("perforce.changeSearch.removeFileFilter",e=>e.dispose()),r.commands.registerCommand("perforce.changeSearch.goToChangelist",e=>e.execute()),r.commands.registerCommand("perforce.changeSearch.run",e=>e.executeSearch()),r.commands.registerCommand("perforce.changeSearch.refresh",e=>e.refresh()),r.commands.registerCommand("perforce.changeSearch.pin",e=>e.pin()),r.commands.registerCommand("perforce.changeSearch.unpin",e=>e.unpin()),r.commands.registerCommand("perforce.changeSearch.delete",e=>e.dispose()),r.commands.registerCommand("perforce.changeSearch.showInQuickPick",e=>e.showInQuickPick()),r.commands.registerCommand("perforce.changeSearch.enableAutoRefresh",e=>e.autoRefresh=!0),r.commands.registerCommand("perforce.changeSearch.disableAutoRefresh",e=>e.autoRefresh=!1),r.commands.registerCommand("perforce.changeSearch.diffResult",e=>w.diffPrevious(e.perforceUri)),r.commands.registerCommand("perforce.changeSearch.openResultDoc",e=>r.window.showTextDocument(e.perforceUri)),T=new F(e.workspaceState);const t=new o.SelfExpandingTreeView(T),i=r.window.createTreeView("perforce.searchChangelists",{treeDataProvider:t,canSelectMany:!1,showCollapseAll:!0});t.treeView=i}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0));class o extends r.TreeItem{constructor(e,t,i){super(e,t),this._options=i,this._isDisposed=!1,this._onDisposed=new r.EventEmitter,this._onChanged=new r.EventEmitter,this._onRevealRequested=new r.EventEmitter,this._subscriptions=[],this._subscriptions.push(this._onChanged,this._onDisposed,this._onRevealRequested),this._children=new Set}get labelText(){var e;return"string"==typeof this.label?this.label:null===(e=this.label)||void 0===e?void 0:e.label}get onDisposed(){return this._onDisposed.event}get onChanged(){return this._onChanged.event}get onRevealRequested(){return this._onRevealRequested.event}didChange(){this._onChanged.fire(void 0)}setParent(e){this._parent=e}get parent(){return this._parent}addChild(e){this._children.add(e)&&this.subscribeToChild(e)}subscribeToChild(e){e.setParent(this),this._subscriptions.push(e.onChanged(e=>this._onChanged.fire(e))),this._subscriptions.push(e.onDisposed(()=>{this._children.delete(e),this._onChanged.fire(this)})),this._subscriptions.push(e.onRevealRequested(e=>{this._onRevealRequested.fire(e)}))}insertChild(e,t){const i=this.getChildren(),n=this._children.has(e);n&&i.splice(i.findIndex(t=>t===e),1),this._children.clear();const r=t||0;i.splice(r,0,e),i.forEach(e=>this._children.add(e)),n||this.subscribeToChild(e)}clearChildren(){this._children.forEach(e=>{e.dispose()})}reveal(e){this._onRevealRequested.fire([this,e])}getChildren(){var e;const t=[];for(const e of this._children.values())t.push(e);return(null===(e=this._options)||void 0===e?void 0:e.reverseChildren)?t.reverse():t}dispose(){this._isDisposed||(this._isDisposed=!0,this._onDisposed.fire(),this._subscriptions.forEach(e=>e.dispose()),this._children.forEach(e=>e.dispose()),this._parent=void 0)}}t.SelfExpandingTreeItem=o;t.SelfExpandingTreeRoot=class extends o{constructor(){super("n/a")}};t.SelfExpandingTreeView=class{constructor(e){this._root=e,this._subscriptions=[],this._changeEmitter=new r.EventEmitter,this._subscriptions.push(this._root.onChanged(e=>this._changeEmitter.fire(e))),this._subscriptions.push(this._root.onRevealRequested(e=>{var t;return null===(t=this._treeView)||void 0===t?void 0:t.reveal(e[0],e[1])})),this._subscriptions.push(this._changeEmitter,this._root)}get onDidChangeTreeData(){return this._changeEmitter.event}set treeView(e){this._treeView=e}dispose(){this._subscriptions.forEach(e=>e.dispose())}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.getRootElements()}getParent(e){return e.parent}getRootElements(){return this._root.getChildren()}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(8)),o=i(11);t.changeSearchQuickPickProvider={provideActions:(e,t,i)=>{const n=i.map(t=>{const i=t.isPending?"$(tools)":"$(check)";return{label:t.chnum,description:"$(person) "+t.user+" "+i+" "+t.description.join(" "),performAction:()=>{o.showQuickPickForChangelist(e,t.chnum)}}});return Promise.resolve({items:n,placeHolder:"Search Results: "+t})}},t.showQuickPickForChangeSearch=async function(e,t,i){await r.showQuickPick("changeResults",e,t,i)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=n(i(2)),s=n(i(6)),a=n(i(8)),c=n(i(13)),l=i(1),u=i(10),h=n(i(11)),d=i(14);t.shelvedFileQuickPickProvider={provideActions:async(e,t,i)=>{const n=a.asUri(e),p=await async function(e,t){return"string"==typeof t?(await s.describe(e,{chnums:[t],shelved:!0,omitDiffs:!0}))[0]:t}(n,i);if(!p)throw new Error("Could not find change details for changelist "+p);const f="string"==typeof t?JSON.parse(t):t,m=o.fromDepotPath(n,f.depotPath,f.revision),g=await s.have(n,{file:m}),v=await async function(e,t,i,n,a){const h=o.fromUriWithRevision(t,"@="+a.chnum),p=u.GetStatus(i.operation),f=p===u.Status.MOVE_ADD?await async function(e,t,i){const n=await s.getFstatInfoMapped(e,{depotPaths:[t.depotPath],limitToShelved:!0,outputPendingRecord:!0,chnum:i.chnum});if(null==n?void 0:n[0]){const t=n[0].resolveFromFile0,i=n[0].resolveEndFromRev0;if(t&&i)return o.fromDepotPath(e,t,i)}}(e,i,a):void 0;return[{label:"$(file) Show shelved file",description:"Open the shelved file in the editor",performAction:()=>{r.window.showTextDocument(h)}},n?{label:"$(file) Open workspace file",description:"Open the local file in the editor",performAction:()=>{r.window.showTextDocument(n.localUri)}}:void 0,u.operationCreatesFile(p)?void 0:{label:"$(diff) Diff against source revision",description:c.diffTitleForDepotPaths(i.depotPath,i.revision,i.depotPath,"@="+a.chnum),performAction:()=>c.diffFiles(t,h)},f?{label:"$(diff) Diff against moved-from revision",description:c.diffTitleForDepotPaths(o.getDepotPathFromDepotUri(f),o.getRevOrAtLabel(f),i.depotPath,"@="+a.chnum),performAction:()=>c.diffFiles(f,h)}:void 0,{label:"$(diff) Diff against workspace file",description:n?"":"No matching workspace file found",performAction:n?()=>{c.diffFiles(h,n.localUri)}:void 0},u.operationCreatesFile(p)?void 0:{label:"$(list-flat) Go to source revision",description:o.fsPathWithoutRev(t),performAction:()=>d.showQuickPickForFile(t)},f?{label:"$(list-flat) Go to moved-from revision",description:o.basenameWithoutRev(f)+"#"+o.getRevOrAtLabel(f),performAction:()=>d.showQuickPickForFile(f)}:void 0].filter(l.isTruthy)}(n,m,f,g,p);return v.push({label:"$(list-flat) Go to changelist details",description:"Change "+p.chnum+"  $(book)  "+p.description.join(" "),performAction:()=>h.showQuickPickForChangelist(m,p.chnum)}),{items:v,placeHolder:(w=f.depotPath,y=p,"Shelved File "+w+"@="+y.chnum+" - "+y.description.join(" "))};var w,y}},t.showQuickPickForShelvedFile=async function(e,t,i){await a.showQuickPick("shelvedFile",e,t,i)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(8)),o=n(i(14)),s=n(i(47)),a=n(i(11)),c=n(i(30)),l=n(i(43)),u=n(i(46));t.showQuickPickForFile=o.showQuickPickForFile,t.registerQuickPicks=function(){r.registerQuickPickProvider("file",o.fileQuickPickProvider),r.registerQuickPickProvider("filerev",o.fileRevisionQuickPickProvider),r.registerQuickPickProvider("filediff",o.fileDiffQuickPickProvider),r.registerQuickPickProvider("change",a.changeQuickPickProvider),r.registerQuickPickProvider("unshelveChange",a.unshelveChangeQuickPickProvider),r.registerQuickPickProvider("changeResults",u.changeSearchQuickPickProvider),r.registerQuickPickProvider("job",c.jobQuickPickProvider),r.registerQuickPickProvider("integ",l.integrationQuickPickProvider),r.registerQuickPickProvider("shelvedFile",s.shelvedFileQuickPickProvider)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(4),s=n(i(2)),a=i(5),c=i(1),l=i(17);class u{constructor(){this._onDidChangeFileEmitter=new r.EventEmitter,this.disposables=[],this.disposables.push(r.workspace.registerFileSystemProvider("perforce",this,{isReadonly:!0,isCaseSensitive:!0}))}dispose(){this.disposables.forEach(e=>e.dispose())}get onDidChangeFile(){return this._onDidChangeFileEmitter.event}watch(e,t){return{dispose:()=>{}}}stat(e){const t=(new Date).getTime();return{type:r.FileType.File,ctime:t,mtime:t,size:0}}readDirectory(e){throw r.FileSystemError.NoPermissions()}createDirectory(e){throw r.FileSystemError.NoPermissions()}async readFile(e){const t=await this.provideTextDocumentContent(e);return(new l.TextEncoder).encode(t)}writeFile(e,t,i){throw r.FileSystemError.NoPermissions()}delete(e,t){throw r.FileSystemError.NoPermissions()}rename(e,t,i){throw r.FileSystemError.NoPermissions()}requestUpdatedDocument(e){this._onDidChangeFileEmitter.fire([{type:r.FileChangeType.Changed,uri:e}])}getResourceForUri(e){var t;return s.isUsableForWorkspace(e)?e:r.window.activeTextEditor&&!r.window.activeTextEditor.document.isUntitled?r.window.activeTextEditor.document.uri:null===(t=r.workspace.workspaceFolders)||void 0===t?void 0:t[0].uri}async provideTextDocumentContent(e){var t,i,n;if("/EMPTY"===e.path)return"";const r=s.decodeUriQuery(null!==(t=e.query)&&void 0!==t?t:""),l=(null!==(i=r.p4Args)&&void 0!==i?i:"-q").split(" "),h=null!==(n=r.command)&&void 0!==n?n:"print";if(!u.cmdWhitelist.includes(h))throw new Error("Illegal command "+h);const d=this.getResourceForUri(e);if(!d)throw o.Display.channel.appendLine("Can't find proper workspace to provide content for "+e),new Error(`Can't find proper workspace for command ${h} `);const p=e.fsPath&&"/Command_Output"!==e.path?a.pathsToArgs([e]).filter(c.isTruthy):[],f=l.concat(p);return a.runPerforceCommand(d,h,f,{hideStdErr:!0})}}let h;t.PerforceFileSystemProvider=u,u.cmdWhitelist=["print","describe","job","change","fstat"],t.perforceFsProvider=function(){return h||(h=new u),h},t.initPerforceFsProvider=function(){return h||(h=new u),h}},function(e,t,i){"use strict";
/*!
 * fill-range <https://github.com/jonschlinkert/fill-range>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Licensed under the MIT License.
 */const n=i(17),r=i(108),o=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>"number"==typeof e||"string"==typeof e&&""!==e,a=e=>Number.isInteger(+e),c=e=>{let t=""+e,i=-1;if("-"===t[0]&&(t=t.slice(1)),"0"===t)return!1;for(;"0"===t[++i];);return i>0},l=(e,t,i)=>{if(t>0){let i="-"===e[0]?"-":"";i&&(e=e.slice(1)),e=i+e.padStart(i?t-1:t,"0")}return!1===i?String(e):e},u=(e,t)=>{let i="-"===e[0]?"-":"";for(i&&(e=e.slice(1),t--);e.length<t;)e="0"+e;return i?"-"+e:e},h=(e,t,i,n)=>{if(i)return r(e,t,{wrap:!1,...n});let o=String.fromCharCode(e);return e===t?o:`[${o}-${String.fromCharCode(t)}]`},d=(e,t,i)=>{if(Array.isArray(e)){let t=!0===i.wrap,n=i.capture?"":"?:";return t?`(${n}${e.join("|")})`:e.join("|")}return r(e,t,i)},p=(...e)=>new RangeError("Invalid range arguments: "+n.inspect(...e)),f=(e,t,i)=>{if(!0===i.strictRanges)throw p([e,t]);return[]},m=(e,t,i=1,n={})=>{let r=Number(e),o=Number(t);if(!Number.isInteger(r)||!Number.isInteger(o)){if(!0===n.strictRanges)throw p([e,t]);return[]}0===r&&(r=0),0===o&&(o=0);let s=r>o,a=String(e),f=String(t),m=String(i);i=Math.max(Math.abs(i),1);let g=c(a)||c(f)||c(m),v=g?Math.max(a.length,f.length,m.length):0,w=!1===g&&!1===((e,t,i)=>"string"==typeof e||"string"==typeof t||!0===i.stringify)(e,t,n),y=n.transform||(e=>t=>!0===e?Number(t):String(t))(w);if(n.toRegex&&1===i)return h(u(e,v),u(t,v),!0,n);let _={negatives:[],positives:[]},C=[],S=0;for(;s?r>=o:r<=o;)!0===n.toRegex&&i>1?_[(b=r)<0?"negatives":"positives"].push(Math.abs(b)):C.push(l(y(r,S),v,w)),r=s?r-i:r+i,S++;var b;return!0===n.toRegex?i>1?((e,t)=>{e.negatives.sort((e,t)=>e<t?-1:e>t?1:0),e.positives.sort((e,t)=>e<t?-1:e>t?1:0);let i,n=t.capture?"":"?:",r="",o="";return e.positives.length&&(r=e.positives.join("|")),e.negatives.length&&(o=`-(${n}${e.negatives.join("|")})`),i=r&&o?`${r}|${o}`:r||o,t.wrap?`(${n}${i})`:i})(_,n):d(C,null,{wrap:!1,...n}):C},g=(e,t,i,n={})=>{if(null==t&&s(e))return[e];if(!s(e)||!s(t))return f(e,t,n);if("function"==typeof i)return g(e,t,1,{transform:i});if(o(i))return g(e,t,0,i);let r={...n};return!0===r.capture&&(r.wrap=!0),i=i||r.step||1,a(i)?a(e)&&a(t)?m(e,t,i,r):((e,t,i=1,n={})=>{if(!a(e)&&e.length>1||!a(t)&&t.length>1)return f(e,t,n);let r=n.transform||(e=>String.fromCharCode(e)),o=(""+e).charCodeAt(0),s=(""+t).charCodeAt(0),c=o>s,l=Math.min(o,s),u=Math.max(o,s);if(n.toRegex&&1===i)return h(l,u,!1,n);let p=[],m=0;for(;c?o>=s:o<=s;)p.push(r(o,m)),o=c?o-i:o+i,m++;return!0===n.toRegex?d(p,null,{wrap:!1,options:n}):p})(e,t,Math.max(Math.abs(i),1),r):null==i||o(i)?g(e,t,1,i):((e,t)=>{if(!0===t.strictRanges)throw new TypeError(`Expected step "${e}" to be a number`);return[]})(i,r)};e.exports=g},function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(33),s=i(49),a=n(i(104)),c=i(9),l=i(21),u=i(4),h=i(22),d=r(i(0)),p=r(i(3)),f=i(0),m=i(28),g=r(i(117)),v=r(i(48)),w=r(i(6)),y=i(1),_=i(44),C=i(15),S=i(29);let b=!1;const E=[];let R;const P=new Set;function D(e,t){u.Display.channel.appendLine("> "+e+": "+t)}async function k(e){var t,i,n;try{const r=await w.getInfo(e,{}),o=r.get("Client root");if(o){const s=null!==(t=r.get("Client name"))&&void 0!==t?t:"unknown",a=null!==(i=r.get("Server address"))&&void 0!==i?i:"",c=null!==(n=r.get("User name"))&&void 0!==n?n:"",l="insensitive"===r.get("Case Handling"),u=function(e,t,i){return O(h.Utils.normalize(e.fsPath),t,i)}(e,h.Utils.normalize(o),l),p=function(e,t,i){const n=h.Utils.normalize(e.fsPath);return O(t,n,i)}(e,h.Utils.normalize(o),l);return{configSource:e,clientRoot:d.Uri.file(o),clientName:s,userName:c,serverAddress:a,isInRoot:u,isAboveRoot:p}}}catch(e){}}function x(e,t){d.commands.executeCommand("setContext","perforce.activation."+e,t)}function O(e,t,i){return i?e.toUpperCase().startsWith(t.toUpperCase()):e.startsWith(t)}async function A(e){const t=e.uri,i=await l.PerforceService.getConfigFilename(t),n=!i,r=new d.RelativePattern(e,n?"**/.p4config":"**/"+i);n?(x("noP4Config",!0),D(t,"Did NOT find a valid P4CONFIG setting.\n!!! IMPORTANT !!!\nPreviously, if no P4CONFIG setting was found, the extension would look for files name .p4config and parse them.\nThis is no longer the case. If you use p4config files, Please set your P4CONFIG setting and restart,\nEither via environment variables or p4 set, e.g.:\n\t\tp4 set P4CONFIG=.p4config\n!!! IMPORTANT !!!\n")):D(t,"Using pattern "+r.pattern);const o=await d.workspace.findFiles(r,"**/node_modules/**");return o.length>0&&n&&(D(t,"Found "+o.length+" .p4config files that are VERY UNLIKELY to work"),async function(e){if(!d.workspace.getConfiguration("perforce").get("warnOnMissingP4CONFIG"))return;const t="Don't show again in this workspace",i=await d.window.showWarningMessage("Perforce WARNING: Your workspace contains "+e+" .p4config file(s), but your P4CONFIG setting is undefined. Please set P4CONFIG in your environment and restart VS Code to detect these perforce clients",t,"More Details...");i===t?await d.workspace.getConfiguration("perforce").update("warnOnMissingP4CONFIG",!1):"More Details..."===i&&await d.env.openExternal(d.Uri.parse("https://github.com/mjcrouch/vscode-perforce/blob/master/MIGRATION.md"))}(o.length)),o}function F(e,t,i,n){if(!t)return"  * "+e+" : NO CLIENT ROOT FOUND";const r=i?"USING ANYWAY because working dir override is set":n?"USING ANYWAY because activation mode is set to ALWAYS":"IGNORING THIS CLIENT";return"  * "+e+" :\n\tClient name: "+t.clientName+"\n\tClient root: "+t.clientRoot.fsPath+"\n\tUser name: "+t.userName+"\n\tServer address: "+t.serverAddress+"\n"+(t.isInRoot||t.isAboveRoot?"\tFolder IS in or above client root":"!!\tFolder IS NOT in client root - "+r)}function T(){var e;return null!==(e=d.workspace.getConfiguration("perforce").get("activationMode"))&&void 0!==e?e:"autodetect"}function I(e){const t=new c.PerforceSCMProvider(e);return t.Initialize(),E.push(t),E.push(new a.default(d.workspace)),L(),u.Display.activateStatusBar(),t}function M(e,...t){let i=0,n=0;t.forEach(t=>{!function(e,t){x("hasScmProvider",!0);const i=c.PerforceSCMProvider.GetInstanceByClient(t);return i?(D(e,"SCM provider already exists for "+t.clientName+" @ "+t.clientRoot.fsPath+" - not creating another for source : "+t.configSource.fsPath),i.addContributingDir(t.configSource),!1):(D(e,"Creating SCM provider for "+t.clientName+" @ "+t.clientRoot.fsPath+" because of source : "+t.configSource.fsPath),I(t).addContributingDir(t.configSource),!0)}(e,t)?++n:++i}),D(e,`Initialisation done for this workspace. Created ${i} provider(s), ignored ${n} duplicate(s)\n\n`)}async function N(e){const t=e.uri,i=l.PerforceService.getOverrideDir(t),n="always"===T();D(t,"Trying to initialise SCM Providers in this workspace.\n\tNote: the following overrides apply in this workspace:\n"+function(e){const t=d.workspace.getConfiguration("perforce",e);return[["perforce.port",t.get("port")],["perforce.user",t.get("user")],["perforce.client",t.get("client")],["perforce.dir",t.get("dir")]].map(e=>{const t=e[1]&&"none"!==e[1]?"\t(!OVERRIDE!)":"\t(will not override)";return"\t\t"+e[0]+": "+e[1]+t}).join("\n")}(t)+"\n\tExplicit overrides may prevent auto-detection of other perforce client workspaces\nLooking for a client root using the workspace root directory");const r=await k(t);D(t,r?"Found workspace using root directory\n"+F("VS Code workspace root directory",r,!!i,n):"NO CLIENT ROOT FOUND in workspace root directory");const o=[];if(i)D(t,"NOT scanning for P4CONFIG files due to working directory override");else{if(d.workspace.getConfiguration("perforce",t).get("enableP4ConfigScanOnStartup")){const t=await async function(e){const t=e.uri;D(t,"Looking for perforce config files");const i=await A(e);D(t,"Found "+i.length+" config file(s)"),D(t,"Finding client roots using each file's directory");const n=i.map(async e=>k(d.Uri.file(p.dirname(e.fsPath)))),r=await Promise.all(n),o=i.map((e,t)=>F(e.fsPath,r[t])).join("\n");return D(t,"Found the following roots from the location of "+i.length+" P4CONFIG file(s):\n"+o),r}(e);o.push(...t.filter(y.isTruthy))}else D(t,"NOT scanning for P4CONFIG files because perforce.enableP4ConfigScanOnStartup is set to false")}o.push(r);const s=o.filter(y.isTruthy).filter(e=>e.isInRoot||e.isAboveRoot),a="If you were expecting a valid client to be found:\n  * Check if you can run perforce commands in this directory from the command line.\n  * Look at the perforce commands above, see if they match your expectations and can be run in the directory shown.\n  * Review your override settings in vscode, perforce.port, perforce.user, perforce.client, perforce.dir\n    * you may need to set or unset them appropriately";s.length<1?(o.length>0&&x("foundOutOfRoot",!0),n?r?(D(t,"NO valid perforce clients found in this directory, but activation mode is set to ALWAYS and a perforce client was found with a different client root\n"+a+"\nCreating SCM Provider using the workspace found in the root directory."),M(t,r)):D(t,"NO valid perforce clients found in this directory.Activation mode is set to ALWAYS, but cannot create an scm provider without any client found.\nNote: It should still be possible to use perforce commands on individual files in the editor.\n"+a):(D(t,"NO valid perforce clients found in this directory.\n"+a),r&&D(t,"To FORCE activation for the client '"+r.clientName+"':\n\tset perforce.activationMode to always.\nThis should allow you to view and manage changelists in that client, but is unlikely to be useful for files in this workspace"))):M(t,...s),x("status","complete")}let U;function L(){const e=d.workspace.getConfiguration("perforce").get("testModeNoActivate");b||e||(b=!0,v.registerQuickPicks(),u.Display.channel.appendLine("Performing one-time registration of perforce commands"),u.Display.initialize(E),g.initialize(E),R=s.initPerforceFsProvider(),E.push(R),E.push(m.AnnotationProvider.onWillLoadEditor(e=>null==R?void 0:R.requestUpdatedDocument(e))),E.push(d.workspace.onDidOpenTextDocument(Q)),E.push(d.workspace.onDidCloseTextDocument(V)),o.PerforceCommands.registerCommands(),c.PerforceSCMProvider.registerCommands(),_.registerChangelistSearch(U))}t.activate=async function(e){U=e,E.push(d.commands.registerCommand("perforce.clearMementos",()=>async function(){const e="Clear workspace state";await d.window.showWarningMessage("This will clear persisted cache data. This only applies to a small number of items such as search filters and change specifications.\nThis option is only here in case of unexpected bugs.\nYou will probably need to restart VS Code to see any effect. Continue?",{modal:!0},e)===e&&await S.clearAllMementos(U.workspaceState,U.globalState)}())),o.PerforceCommands.registerImportantCommands(E),C.createSpecEditor(e),e.subscriptions.push(new d.Disposable(()=>f.Disposable.from(...E).dispose())),async function(e){if(e.globalState.get("ignoreSlevesque"))return;if(d.extensions.getExtension("slevesque.perforce")){const t="Don't show again",i="Show installed extensions",n=await d.window.showWarningMessage("You have both slevesque.perforce and mjcrouch.perforce installed. These extensions *cannot* be used together. Please uninstall or disable slevesque.perforce in order to use the fork",i,t);n===t?e.globalState.update("ignoreSlevesque",!0):n===i&&d.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",["slevesque.perforce","mjcrouch.perforce"])}}(e);const t=d.workspace.getConfiguration("perforce").get("activationMode");"off"!==t&&(L(),"always"===t&&u.Display.activateStatusBar(),d.workspace.onDidChangeWorkspaceFolders(G,null,e.subscriptions),d.workspace.onDidChangeConfiguration(B,null,e.subscriptions),await G({added:d.workspace.workspaceFolders||[],removed:[]}),d.workspace.textDocuments.map(Q))};const H=["perforce.activationMode","perforce.editOnFileSave","perforce.editOnFileModified","perforce.addOnFileCreate","perforce.deleteOnFileDelete","perforce.client","perforce.port","perforce.user","perforce.password","perforce.dir","perforce.command","perforce.bottleneck.maxConcurrent"],W=["perforce.hideEmptyChangelists","perforce.hideNonWorkspaceFiles","perforce.hideShelvedFiles","perforce.ignoredChangelistPrefix"];let $=!1;function j(e,t,i,n){for(const r of t)if(e.affectsConfiguration(r)&&(i(r),n))break}function B(e){$||j(e,H,async()=>{$=!0;"Restart Now"===await d.window.showWarningMessage("You have changed a perforce setting that may require a restart to take effect. When you are done, please restart VS Code","Restart Now")&&d.commands.executeCommand("workbench.action.reloadWindow")},!0),j(e,W,()=>c.PerforceSCMProvider.RefreshAll(),!0),e.affectsConfiguration("perforce.scm.activateOnFileOpen")&&d.workspace.getConfiguration("perforce").get("scm.activateOnFileOpen")&&"off"!==T()&&d.workspace.textDocuments.map(Q)}async function G(e){const t=e.added,i=e.removed;u.Display.channel.appendLine("==============================\nWorkspace folders changed. Starting initialisation.\n");try{t.length>0?u.Display.channel.appendLine("Workspaces were added"):(u.Display.channel.appendLine("No new workspaces were added - nothing to initialise"),x("status","noworkspace"));for(const e of t)await N(e)}catch(e){u.Display.channel.appendLine("Error: "+e)}try{if(i.length>0){u.Display.channel.appendLine("Workspaces were removed");for(const e of i)D((n=e).uri,"This workspace was removed. Checking for SCM providers that used it"),c.PerforceSCMProvider.removeContributingDirsUnder(n.uri);const e=function(){const e=c.PerforceSCMProvider.disposeInstancesWithoutContributors();return c.PerforceSCMProvider.instanceCount<1&&x("hasScmProvider",!1),e}();u.Display.channel.appendLine("\t>>> Removed "+e.length+" SCM provider(s) with no remaining contributing workspaces")}}catch(e){u.Display.channel.appendLine("Error: "+e)}var n;u.Display.channel.appendLine("\nInitialisation finished\n==============================\n")}function q(e,t,i){i&&!d.workspace.getConfiguration("perforce").get("debugModeActive")||u.Display.channel.appendLine("\t>>> "+p.basename(e.fsPath)+" : "+t)}async function Q(e){const t=e.uri;"file"===t.scheme&&d.workspace.getConfiguration("perforce").get("scm.activateOnFileOpen")&&(q(t,"Editor opened "+e.uri.fsPath,!0),c.PerforceSCMProvider.checkAndAddContributingDoc(e)?q(t,"Already have an SCM provider for this doc or a parent directory",!0):await async function(e){const t=e.uri,i=d.Uri.file(p.dirname(t.fsPath));if(P.has(i.fsPath))return void q(t,"Already determined no client here",!0);const n=await k(i);if(q(t,F(t.fsPath,n),!0),n&&(n.isInRoot||(null==n?void 0:n.isAboveRoot))){const i=c.PerforceSCMProvider.GetInstanceByClient(n);if(i)q(t,"Already have an SCM provider for client "+n.clientName,!0),i.addContributingDoc(e);else{q(t,"Creating SCM provider for "+n.clientName+" @ "+n.clientRoot.fsPath+" because of source "+t.fsPath);I(n).addContributingDoc(e)}}else P.add(i.fsPath),q(t,"NOT creating an SCM provider",!0)}(e))}function V(e){if("file"!==e.uri.scheme)return;const t=c.PerforceSCMProvider.removeContributingDoc(e);if(d.workspace.getConfiguration("perforce").get("scm.deactivateOnFileClose")&&t.length>0){q(e.uri,"Closed document "+e.uri.fsPath+" WAS contributing to an SCM provider. Checking if it can be removed");const t=c.PerforceSCMProvider.disposeInstancesWithoutContributors();q(e.uri,"Removed "+t.length+" SCM providers")}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["S","shelved"],["s","omitDiffs"]],"chnums",[],{lastArgIsFormattedArray:!0}),s=n.makeSimpleCommand("describe",o);function a(e,t,i){const n=e.find(e=>e[0].startsWith(t));if(n)return i(n)}function c(e){return e.map(e=>{const t=/\.+\ (.*)#(.*) (.*)/.exec(e);if(t){const[,e,i,n]=t;return{depotPath:e,revision:i,operation:n}}}).filter(r.isTruthy)}function l(e){var t,i,o;const s=n.sectionArrayBy(e,e=>e.endsWith("...")&&!e.startsWith("\t")),l=e.slice(2),h=l.findIndex(e=>!e.startsWith("\t")),d=n.removeIndent(l.slice(0,h>=0?h:void 0)),p=/^Change (\d+) by (\S+?)@(\S+) on (.*?)( \*pending\*)?$/.exec(e[0]);if(p){const[,e,n,l,h,f]=p,m=!!f,g=null!==(t=a(s,"Affected files",c))&&void 0!==t?t:[],v=null!==(i=a(s,"Shelved files",c))&&void 0!==i?i:[],w=null!==(o=a(s,"Jobs fixed",u))&&void 0!==o?o:[];return{chnum:e,user:n,description:d,client:l,isPending:m,date:r.parseDate(h),affectedFiles:g,shelvedFiles:v,fixedJobs:w}}}function u(e){return n.sectionArrayBy(e,e=>/^\S*? on/.test(e)).map(e=>({id:e[0].split(" ")[0],description:e.slice(1).filter(e=>e.startsWith("\t")).map(e=>e.slice(1))}))}t.describe=n.asyncOuputHandler(s,(function(e){const t=n.splitIntoLines(e.trim());return n.sectionArrayBy(t,e=>/^Change \d+ by/.test(e)).map(l).filter(r.isTruthy)})),t.getShelvedFiles=async function(e,t){return 0===t.chnums.length?[]:function(e){const t=n.splitIntoLines(e.trim());return n.sectionArrayBy(t,e=>/^Change \d+ by/.test(e)).map(e=>{const t=e.slice(1).map(e=>{var t;return null===(t=/(\.+)\ (.*)#(.*) (.*)/.exec(e))||void 0===t?void 0:t[2]}).filter(r.isTruthy);return{chnum:parseInt(e[0].split(" ")[1]),paths:t}}).filter(r.isTruthy).filter(e=>e.paths.length>0)}(await s(e,{chnums:t.chnums,omitDiffs:!0,shelved:!0}))},t.getFixedJobs=async function(e,i){var n;return null===(n=(await t.describe(e,{chnums:[i.chnum],omitDiffs:!0}))[0])||void 0===n?void 0:n.fixedJobs}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=n.flagMapper([["c","outputChangelist"],["u","outputUser"],["i","followBranches"]],"file",["-q"]),o=n.makeSimpleCommand("annotate",r);t.annotate=async function(e,t){return function(e,t){const i=n.splitIntoLines(e),r=t?/^(\d+): (\S+) (\S+) (.*?)$/:/^(\d+): (.*?)$/,o=t?4:2;return i.map(e=>{const i=r.exec(e);if(i){const e=i[1],n=t?i[2]:void 0,r=t?i[3]:void 0;return{line:i[o],revisionOrChnum:e,user:n,date:r}}})}(await o(e,t),t.outputUser)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(23),r=i(5),o=i(40);const s=n.pipe(o.parseSpecOutput,(function(e){var t,i,n;return{change:null===(t=o.getBasicField(e,"Change"))||void 0===t?void 0:t[0].trim(),description:null===(i=o.getBasicField(e,"Description"))||void 0===i?void 0:i.join("\n"),files:null===(n=o.getBasicField(e,"Files"))||void 0===n?void 0:n.map(e=>{const t=e.indexOf("#");return{depotPath:e.slice(0,t).trim(),action:e.slice(t+2)}}),rawFields:e}})),a=r.flagMapper([],"existingChangelist",["-o"],{lastArgIsFormattedArray:!0});t.outputChange=r.makeSimpleCommand("change",a),t.getChangeSpec=r.asyncOuputHandler(t.outputChange,s);const c=e=>e.change?{name:"Change",value:[e.change]}:void 0,l=e=>e.description?{name:"Description",value:r.splitIntoLines(e.description)}:void 0,u=e=>e.files?{name:"Files",value:e.files.map(e=>e.depotPath+"\t# "+e.action)}:void 0;function h(e){const t=/Change\s(\d+)\s/.exec(e);return{rawOutput:e,chnum:null==t?void 0:t[1]}}const d=r.makeSimpleCommand("change",()=>["-i"],e=>({input:e.input})),p=r.makeSimpleCommand("change",()=>["-i"],e=>{return{input:(t=e.spec,r.concatIfOutputIsDefined(c,l,u)(t)).concat(e.spec.rawFields.filter(t=>!e.spec[t.name.toLowerCase()])).map(e=>e.name+":\t"+e.value.join("\n\t")).join("\n\n")+"\n\n"};var t});t.inputChangeSpec=r.asyncOuputHandler(p,h),t.inputRawChangeSpec=r.asyncOuputHandler(d,h)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=(...e)=>t=>e.reduceRight((e,t)=>t(e),t);t.compose=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(57),r=Object.assign((...e)=>t=>e.reduce((e,t)=>t(e),t),{now:n.default});t.pipe=r,t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=(e,...t)=>t.reduce((e,t)=>t(e),e);t.pipeNow=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(24),r=i(26),o=i(37),s=Object.assign(n.default(r.default),{async:o.default});t.rail=s,t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(25),r=i(26),o=i(39),s=Object.assign(n.default(r.default),{async:o.default});t.railRight=s,t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(36).default((e,t)=>(t instanceof Promise?t.then(t=>e(t)):e(t),t));t.tap=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=i(5);function s(e){const t=/[.]{3} (\w+)[ ]*(.+)?/.exec(e);if(t)return{[t[1]]:t[2]?t[2]:"true"}}function a(e){return n.mergeAll({depotFile:""},...(t=e,o.splitIntoLines(t).map(s).filter(r.isTruthy)));var t}const c=n.flagMapper([["e","chnum"],["Or","outputPendingRecord"],["Rs","limitToShelved"]],"depotPaths"),l=n.makeSimpleCommand("fstat",c).ignoringStdErr;async function u(e,t){const i=n.splitIntoChunks(t.depotPaths).map(i=>l(e,{...t,depotPaths:i}));return(await Promise.all(i)).flatMap(e=>{return t=e,n.splitIntoSections(t.trim()).map(e=>a(e));var t})}t.getFstatInfo=u,t.getFstatInfoMapped=async function(e,t){const i=await u(e,t);return t.depotPaths.map(e=>i.find(t=>t.depotFile===e))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1);var o;function s(e){const t=/(.+)#(\d+)\s-\s([\w\/]+)\s(default\schange|change\s\d+)\s\(([\w\+]+)\)/.exec(e);if(t){const[e,i,n,r,o,s]=t;return{depotPath:i,revision:n,operation:r,chnum:o.startsWith("change")?o.split(" ")[1]:"default",filetype:s,message:e}}}function a(e){return n.splitIntoLines(e.trim()).map(s).filter(r.isTruthy)}function c(e){const t=/(?:((.+)\s-\sfile\(s\)\snot\sopened.*)|(Path\s'(.+)'\sis\snot\sunder.*))/.exec(e);if(t){const[,e,i,n,r]=t;return{message:e||n,filePath:e?i:r,reason:e?o.NOT_OPENED:o.NOT_IN_ROOT}}}!function(e){e[e.NOT_OPENED=0]="NOT_OPENED",e[e.NOT_IN_ROOT=1]="NOT_IN_ROOT"}(o=t.UnopenedFileReason||(t.UnopenedFileReason={}));const l=n.flagMapper([["c","chnum"]],"files",[],{ignoreRevisionFragments:!0}),u=n.makeSimpleCommand("opened",l);t.getOpenedFiles=async function(e,t){return a(await u.ignoringAndHidingStdErr(e,t))},t.getOpenedFileDetails=async function(e,t){const[i,o]=await u.raw(e,t);var s;return{open:a(i),unopen:(s=o,n.splitIntoLines(s.trim()).map(c).filter(r.isTruthy))}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5),o=n(i(0)),s=n(i(2)),a=i(1),c=r.flagMapper([["d","chnum"]]);t.deleteChangelist=r.makeSimpleCommand("change",c,()=>({logStdOut:!0}));const l=r.flagMapper([["c","chnum"],["d","description"]],"file"),u=r.makeSimpleCommand("submit",l,()=>({logStdOut:!0}));t.submitChangelist=r.asyncOuputHandler(u,(function(e){const t=/Change (\d+) submitted/.exec(e);return{rawOutput:e,chnum:null==t?void 0:t[1]}}));const h=r.flagMapper([["a","unchanged"],["c","chnum"]],"paths",void 0,{ignoreRevisionFragments:!0});t.revert=r.makeSimpleCommand("revert",h,()=>({logStdOut:!0}));const d=r.flagMapper([["c","chnum"]],"paths");t.del=r.makeSimpleCommand("delete",d,()=>({logStdOut:!0}));const p=r.flagMapper([["f","force"],["d","delete"],["c","chnum"]],"paths");t.shelve=r.makeSimpleCommand("shelve",p,()=>({logStdOut:!0}));const f=r.flagMapper([["f","force"],["s","shelvedChnum"],["c","toChnum"],["b","branchMapping"]],"paths");function m(e){return e&&void 0!==e.depotPath&&void 0!==e.operation}function g(e){return e&&void 0!==e.depotPath&&void 0!==e.resolvePath}const v=r.makeSimpleCommand("unshelve",f,()=>({logStdOut:!0}));t.unshelve=r.asyncOuputHandler(v,(function(e){const t=r.splitIntoLines(e).map(e=>function(e){return e.startsWith("...")?function(e){const t=/\.{3} (.*?) - must resolve (.*?) before submitting/.exec(e);if(t){const[,e,i]=t;return{depotPath:e,resolvePath:i}}}(e):function(e){const t=/(.*?) - unshelved, opened for (.*)/.exec(e);if(t){const[,e,i]=t;return{depotPath:e,operation:i}}}(e)}(e)).filter(a.isTruthy);return{files:t.filter(m),warnings:t.filter(g)}}));const w=r.flagMapper([["c","chnum"],["d","removeFix"]],"jobId");t.fixJob=r.makeSimpleCommand("fix",w);const y=r.flagMapper([["c","chnum"]],"files");t.reopenFiles=r.makeSimpleCommand("reopen",y);const _=r.flagMapper([],"files");t.sync=r.makeSimpleCommand("sync",_,e=>{if(e.files)return{logStdOut:!0}}),t.info=r.makeSimpleCommand("info",()=>[]),t.getInfo=r.asyncOuputHandler(t.info,(function(e){const t=new Map,i=e.trim().split(/\r?\n/);for(let e=0,n=i.length;e<n;++e){const n=/([^:]+): (.+)/.exec(i[e]);n&&t.set(n[1],n[2])}return t}));const C=r.flagMapper([],"file",[],{ignoreRevisionFragments:!0});const S=r.makeSimpleCommand("have",C);t.have=async function(e,t){return function(e,t){const i=/^(.+)#(\d+) - (.+)/.exec(t);if(i){const[,t,n,r]=i;return{depotPath:t,revision:n,depotUri:s.fromDepotPath(e,i[1],i[2]),localUri:o.Uri.file(r)}}}(e,await S.ignoringStdErr(e,t))},t.haveFile=r.asyncOuputHandler(S.ignoringAndHidingStdErr,a.isTruthy),t.login=r.makeSimpleCommand("login",()=>[],e=>({input:e.password}));const b=r.makeSimpleCommand("login",()=>["-s"]);t.isLoggedIn=async function(e){try{return await b(e,{}),!0}catch{return!1}},t.logout=r.makeSimpleCommand("logout",()=>[]);const E=r.flagMapper([["c","chnum"],["f","reresolve"]],"files",[],{ignoreRevisionFragments:!0});t.resolve=r.makeSimpleCommand("resolve",E,()=>({useTerminal:!0}));const R=r.flagMapper([["c","chnum"]],"files",void 0,{ignoreRevisionFragments:!0});t.add=r.makeSimpleCommand("add",R,()=>({logStdOut:!0}));const P=r.flagMapper([["c","chnum"]],"files",void 0,{ignoreRevisionFragments:!0});t.edit=r.makeSimpleCommand("edit",P,()=>({logStdOut:!0}));const D=r.flagMapper([["c","chnum"]],"fromToFile");t.move=r.makeSimpleCommand("move",D,()=>({logStdOut:!0}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["i","followBranches"],["s","omitNonContributoryIntegrations"]],"file",["-l","-t"]),s=n.makeSimpleCommand("filelog",o);var a;function c(e,t){const[i,...n]=e,o=/^\.{3} #(\d+) change (\d+) (\S+) on (.*?) by (.*?)@(.*?) (.*?)$/.exec(i);if(o){const[,e,i,s,c,l,u]=o,h=n.filter(e=>e.startsWith("\t")).map(e=>e.slice(1)).join("\n"),d=n.filter(e=>e.startsWith("... ...")),p=d.map(e=>{const t=/^.{3} .{3} (\S+) (into|from) (.*?)#(\d+)(?:,#(\d+))?$/.exec(e);if(t){const[,e,i,n,r,o]=t;return{operation:e,direction:"into"===i?a.TO:a.FROM,file:n,startRev:o?r:void 0,endRev:o||r}}}).filter(r.isTruthy);return{file:t,description:h,revision:e,chnum:i,operation:s,date:r.parseDate(c),user:l,client:u,integrations:p}}}function l(e){const t=n.sectionArrayBy(e.slice(1),e=>e.startsWith("... #")),i=e[0];return t.map(e=>c(e,i)).filter(r.isTruthy)}function u(e){return function(e){return n.sectionArrayBy(e,e=>e.startsWith("//")).flatMap(l)}(n.splitIntoLines(e))}!function(e){e[e.TO=0]="TO",e[e.FROM=1]="FROM"}(a=t.Direction||(t.Direction={})),t.getFileHistory=async function(e,t){return u(await s(e,t))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1);!function(e){e.PENDING="pending",e.SHELVED="shelved",e.SUBMITTED="submitted"}(t.ChangelistStatus||(t.ChangelistStatus={}));const o=n.makeSimpleCommand("changes",n.flagMapper([["c","client"],["s","status"],["u","user"],["m","maxChangelists"]],"files",["-l"]));function s(e){const[t,...i]=e,o=function(e){const t=/Change\s(\d+)\son\s(.+)\sby\s(.+)@(\S+)(?:\s\*(.+)\*)?/.exec(e);if(t){const[,e,i,n,o,s]=t,a="pending"===s;return{chnum:e,date:r.parseDate(i),user:n,client:o,isPending:a}}}(t);if(!o)return;const s=n.removeIndent(i.filter(e=>e.startsWith("\t")));return{...o,description:s}}t.getChangelists=n.asyncOuputHandler(o,(function(e){const t=n.splitIntoLines(e);return n.sectionArrayBy(t,e=>e.startsWith("Change")).map(s).filter(r.isTruthy)}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["s","startingChnum"],["-into-only","intoOnly"]],"file",void 0,{ignoreRevisionFragments:!0}),s=n.makeSimpleCommand("integrated",o).ignoringAndHidingStdErr;function a(e){const t=/^(.*?)#(\d+)(?:,#(\d+))? - (\S+) (into|from) (.*?)#(\d+)(?:,#(\d+))?$/.exec(e);if(t){const[,e,i,n,r,o,s,a,c]=t;return"from"===o?{fromFile:s,fromStartRev:c?a:void 0,fromEndRev:c||a,operation:r,toFile:e,toRev:i,displayDirection:o}:{fromFile:e,fromStartRev:n?i:void 0,fromEndRev:n||i,operation:r,toFile:s,toRev:a,displayDirection:o}}}t.integrated=n.asyncOuputHandler(s,(function(e){return n.splitIntoLines(e).map(a).filter(r.isTruthy)}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(23),r=i(5),o=i(40),s=i(1);const a=n.pipe(o.parseSpecOutput,(function(e){var t,i,n,r;return{job:null===(t=o.getBasicField(e,"Job"))||void 0===t?void 0:t[0].trim(),status:null===(i=o.getBasicField(e,"Status"))||void 0===i?void 0:i[0].trim(),user:null===(n=o.getBasicField(e,"User"))||void 0===n?void 0:n[0].trim(),description:null===(r=o.getBasicField(e,"Description"))||void 0===r?void 0:r.join("\n"),rawFields:e}})),c=r.flagMapper([],"existingJob",["-o"],{lastArgIsFormattedArray:!0});function l(e){const t=/^(\S*) fixed by change (\d+) on (\S*) by (\S*?)@(\S*) \((.*?)\)$/.exec(e);if(t){const[,e,i,n,r,o,s]=t;return{job:e,chnum:i,date:n,user:r,client:o,status:s}}}t.outputJob=r.makeSimpleCommand("job",c),t.getJob=r.asyncOuputHandler(t.outputJob,a);const u=r.flagMapper([["j","job"]]),h=r.makeSimpleCommand("fixes",u);t.fixes=r.asyncOuputHandler(h,(function(e){return r.splitIntoLines(e).map(l).filter(s.isTruthy)}));const d=r.makeSimpleCommand("job",()=>["-i"],e=>({input:e.input}));t.inputRawJobSpec=r.asyncOuputHandler(d,(function(e){const t=/Job (\S*) (saved|not changed)/.exec(e);return{rawOutput:e,job:null==t?void 0:t[1]}}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["E","nameFilter"],["m","max"]]),s=n.makeSimpleCommand("clients",o);function a(e){const t=/^Client (\S*) (\S*) root (.*) '(.*)'$/.exec(e);if(t){const[,e,i,n,r]=t;return{client:e,date:i,root:n,description:r}}}t.clients=n.asyncOuputHandler(s,(function(e){return n.splitIntoLines(e).map(a).filter(r.isTruthy)}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["m","max"]],"userFilters",void 0,{lastArgIsFormattedArray:!0}),s=n.makeSimpleCommand("users",o);function a(e){const t=/^(.*) <(.*)> \((.*)\) \S* (.*)$/.exec(e);if(t){const[,e,i,n,r]=t;return{user:e,email:i,fullName:n,accessDate:r}}}t.users=n.asyncOuputHandler(s,(function(e){return n.splitIntoLines(e).map(a).filter(r.isTruthy)}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5),r=i(1),o=n.flagMapper([["E","nameFilter"],["m","max"]]),s=n.makeSimpleCommand("branches",o);function a(e){const t=/^Branch (\S*) (.*?) '(.*)'$/.exec(e);if(t){const[,e,i,n]=t;return{branch:e,date:i,description:n}}}t.branches=n.asyncOuputHandler(s,(function(e){return n.splitIntoLines(e).map(a).filter(r.isTruthy)}))},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(7),s=n(i(2)),a=i(4),c=i(41),l=n(i(0)),u=i(34),h=n(i(6)),d=i(1),p=i(11),f=i(30),m=i(15),g=i(42);function v(e){return e&&void 0!==e.id}class w{constructor(e){this._type=e,this._val={}}updateContext(){l.commands.executeCommand("setContext","perforce.changes."+this._type,this._val)}removeChangelists(e){e.forEach(e=>delete this._val["pending:"+e]),this.updateContext()}addChangelists(e){e.forEach(e=>this._val["pending:"+e]=!0),this.updateContext()}}class y{constructor(e,t,i){this._workspaceUri=e,this._clientName=t,this._sourceControl=i,this._disposables=[],this._onDidChange=new r.EventEmitter,this._refreshInProgress=!1,this._pendingGroups=new Map,this._openResourcesByPath=new Map,this._knownHaveListByPath=new Map,this._conflictsByPath=new Set,this._onDidChangeFileDecorationsEmitter=new r.EventEmitter,this._disposables.push(l.window.registerFileDecorationProvider(this)),this._disposables.push(this._onDidChangeFileDecorationsEmitter),this._fullCleanOnNextRefresh=!1,this._config=o.configAccessor,this._refresh=u.debounce(this.RefreshImpl.bind(this),this._config.refreshDebounceTime,()=>this._refreshInProgress=!0),this._disposables.push(this._refresh),this._disposables.push(a.Display.onActiveFileStatusKnown(this.checkForConflicts.bind(this)))}get onDidChange(){return this._onDidChange.event}dispose(){this.clean(),this._disposables&&(this._disposables.forEach(e=>e.dispose()),this._disposables=[])}get onDidChangeFileDecorations(){return this._onDidChangeFileDecorationsEmitter.event}get workspaceUri(){return this._workspaceUri}get ResourceGroups(){const e=[];return this._defaultGroup&&e.push(this._defaultGroup),e.concat([...this._pendingGroups.values()].map(e=>e.group))}get hideDefaultNonWorkspace(){return this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_CHANGELISTS_AND_DEFAULT_FILES||this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_FILES}provideFileDecoration(e,t){const i=this._openResourcesByPath.get(e.fsPath);return i?g.DecorationProvider.getFileDecorations([i.status],i.isUnresolved):null}assertIsNotDefault(e){if(e.isDefault)throw new Error("The default changelist is not valid for this operation")}assertIsDefault(e){if(!e.isDefault)throw new Error("The non-default changelist '"+e.chnum+"' is not valid for this operation")}mayHaveConflictForFile(e){return this._conflictsByPath.has(e.fsPath)||this._refreshInProgress&&this._openResourcesByPath.has(e.fsPath)}checkForConflicts(e){if(!this._refreshInProgress&&!this._conflictsByPath.has(e.file.fsPath)&&e.status===a.ActiveEditorStatus.NOT_OPEN){this.getOpenResource(e.file)&&(a.Display.channel.appendLine("Detected conflicting status for file "+e.file+"\nSCM provider believes the file is open, but latest 'opened' call does not.\nThis is probably caused by an external change such as submitting or reverting the file from another application."),this._conflictsByPath.add(e.file.fsPath))}}async Login(){await a.Display.doLoginFlow(this._workspaceUri)&&await this.Refresh()}Logout(){return a.Display.doLogoutFlow(this._workspaceUri)}async GoToChangelist(){const e=await a.Display.requestChangelistNumber();e&&p.showQuickPickForChangelist(this._workspaceUri,e)}async GoToJob(){const e=await a.Display.requestJobId();e&&f.showQuickPickForJob(this._workspaceUri,e)}async Sync(e){await h.isLoggedIn(this._workspaceUri)&&r.window.withProgress({location:r.ProgressLocation.SourceControl,title:"Syncing..."},()=>this.syncUpdate(e))}async Refresh(){await this._refresh.withoutLeadingCall()}async RefreshPolitely(e=!1){e&&(this._fullCleanOnNextRefresh=!0),await this._refresh()}async RefreshImmediately(){await this.RefreshImpl()}getOpenResource(e){return this._openResourcesByPath.get(e.fsPath)}async haveFile(e){const t=this._knownHaveListByPath.get(e.fsPath);if(void 0!==t)return t;const i=await h.haveFile(e,{file:e});return this._knownHaveListByPath.set(e.fsPath,i),i}async RefreshImpl(){this._refreshInProgress=!0;await h.isLoggedIn(this._workspaceUri)&&await r.window.withProgress({location:r.ProgressLocation.SourceControl,title:"Updating status..."},()=>this.updateStatus())}async Info(){const e=this._sourceControl.rootUri;if(e){a.Display.channel.show();const t=await h.info(e,{});a.Display.channel.append(t)}}isInWorkspace(e){return!!e&&!!r.workspace.getWorkspaceFolder(r.Uri.file(e))}isUriInWorkspace(e){return!!e&&!!r.workspace.getWorkspaceFolder(e)}async SaveToChangelist(e,t){e||(e="<saved by VSCode>");const i=await h.getChangeSpec(this._workspaceUri,{existingChangelist:t});if(this.hideDefaultNonWorkspace&&i.files){const e=await h.getFstatInfoMapped(this._workspaceUri,{depotPaths:i.files.map(e=>e.depotPath)});i.files=i.files.filter((t,i)=>{var n;return this.isInWorkspace(null===(n=e[i])||void 0===n?void 0:n.clientFile)})}let n;i.description=e;try{const e=await h.inputChangeSpec(this._workspaceUri,{spec:i});n=e.chnum,a.Display.channel.append(e.rawOutput),this.Refresh()}catch(e){a.Display.showError(e.toString())}return n}async createEmptyChangelist(e){try{const t=await h.getChangeSpec(this._workspaceUri,{});t.files=[],t.description=e;return(await h.inputChangeSpec(this._workspaceUri,{spec:t})).chnum}catch(e){a.Display.showImportantError(e.toString())}}async ProcessChangelist(){let e=this._sourceControl.inputBox.value;this._sourceControl.inputBox.value="";let t="";const i=new RegExp(/^#(\d+)\r?\n([^]+)/).exec(e);i&&(t=i[1],e=i[2]),await this.SaveToChangelist(e,t)}async EditChangelist(e){var t;const i=e.chnum,n=await h.getChangeSpec(this._workspaceUri,{existingChangelist:i});this._sourceControl.inputBox.value=null!==(t="#"+i+"\n"+n.description)&&void 0!==t?t:""}async EditChangeSpec(e){this.assertIsNotDefault(e),await m.changeSpecEditor.editSpec(this._workspaceUri,e.chnum)}async NewChangeSpec(){await m.changeSpecEditor.editSpec(this._workspaceUri,"new")}async NewJobSpec(){await m.jobSpecEditor.editSpec(this._workspaceUri,"new")}async Describe(e){if(e.isDefault){const t=s.forCommand(e.model.workspaceUri,"change","-o");await r.commands.executeCommand("vscode.open",t)}else{const t=s.forCommand(e.model.workspaceUri,"describe",e.chnum);await r.commands.executeCommand("vscode.open",t)}}async SubmitDefault(){if(!await h.isLoggedIn(this._workspaceUri))return;try{if(0===(await h.getOpenedFiles(this._workspaceUri,{chnum:"default"})).length)throw new Error("The default changelist is empty")}catch(e){return void a.Display.showError(e.toString())}const e=await this.requestChangelistDescription();if(void 0===e)return;const t=await l.window.showQuickPick(["Submit","Save Changelist","Cancel"],{ignoreFocusOut:!0});if(t&&"Cancel"!==t){if("Submit"===t)if(this.hideDefaultNonWorkspace){const t=await this.SaveToChangelist(e);void 0!==t&&await h.submitChangelist(this._workspaceUri,{chnum:t})}else await h.submitChangelist(this._workspaceUri,{description:e});else await this.SaveToChangelist(e);this.Refresh()}}async Submit(e){this.assertIsNotDefault(e),this._config.promptBeforeSubmit&&!await this.requestConfirmation("Are you sure you want to submit changelist "+e.chnum+"?","Submit changelist")||(await h.submitChangelist(this._workspaceUri,{chnum:e.chnum}),a.Display.showMessage("Changelist Submitted"),this.Refresh())}async createAndSubmitFromSpec(e){const t=await h.inputChangeSpec(this.workspaceUri,{spec:e});if(!t.chnum)throw new Error("Couldn't find the new changelist number");const i=await h.submitChangelist(this.workspaceUri,{chnum:t.chnum});a.Display.showMessage("Change "+i.chnum+" submitted"),this.Refresh()}async SubmitSelectedFile(e){var t,i;if(e.some(e=>"default"!==e.change))return void a.Display.showModalMessage("Only files from the default changelist can be submitted selectively");const n=await h.getChangeSpec(this.workspaceUri,{});if(n.files=null===(t=n.files)||void 0===t?void 0:t.filter(t=>e.some(e=>e.depotPath===t.depotPath)),(null===(i=n.files)||void 0===i?void 0:i.length)!==e.length)return void a.Display.showModalMessage("Unable to submit. The selection is inconsistent with the actual default changelist. Perhaps the perforce view needs refreshing?");const r=await this.requestChangelistDescription();r&&(n.description=r,this.createAndSubmitFromSpec(n))}hasShelvedFiles(e){return e.resourceStates.some(e=>e.isShelved)}async Revert(e,t){let i=!1;const n={paths:[],unchanged:t};let r="Are you sure you want to revert the changes ";if(e instanceof c.Resource){if(e.isShelved)return void a.Display.showImportantError("Revert cannot be used on shelved file: "+e.basenameWithoutRev);n.paths=[e.actionUriNoRev],r+="to file "+e.basenameWithoutRev+"?"}else{if(!v(e))return;n.paths=["//..."],n.chnum=e.chnum,e.isDefault?r+="in the default changelist?":r+="in the changelist "+e.chnum+"?"}if(t||await this.requestConfirmation(r,"Revert Changes")){try{const e=await h.revert(this._workspaceUri,n);a.Display.updateEditor(),a.Display.channel.append(e),i=!0}catch{}if(v(e)&&!this.hasShelvedFiles(e)&&!e.isDefault)try{const t=await h.deleteChangelist(this._workspaceUri,{chnum:e.chnum});a.Display.updateEditor(),a.Display.channel.append(t),i=!0}catch{}i&&this.Refresh()}}async QuietlyRevertChangelist(e){const t=await h.revert(this._workspaceUri,{chnum:e,paths:["//..."]});a.Display.updateEditor(),a.Display.channel.append(t)}async ResolveChangelist(e){this.assertIsNotDefault(e),await h.resolve(this._workspaceUri,{chnum:e.chnum}),this.Refresh()}async ReResolveChangelist(e){this.assertIsNotDefault(e),await h.resolve(this._workspaceUri,{chnum:e.chnum,reresolve:!0}),this.Refresh()}async ResolveFiles(e){await h.resolve(this._workspaceUri,{files:e.map(e=>e.actionUriNoRev)}),this.Refresh()}async ReResolveFiles(e){await h.resolve(this._workspaceUri,{files:e.map(e=>e.actionUriNoRev),reresolve:!0}),this.Refresh()}async ShelveChangelist(e,t){if(e.isDefault)throw new Error("Cannot shelve the default changelist");try{await h.shelve(this._workspaceUri,{chnum:e.chnum,force:!0}),t&&await this.QuietlyRevertChangelist(e.chnum),a.Display.showMessage("Changelist shelved")}catch(e){a.Display.showImportantError(e.toString())}this.Refresh()}async UnshelveChangelist(e){if(e.isDefault)throw new Error("Cannot unshelve the default changelist");try{const t=await h.unshelve(this._workspaceUri,{shelvedChnum:e.chnum,toChnum:e.chnum,force:!0});if(this.Refresh(),t.warnings.length>0){const i="Resolve changelist";await l.window.showWarningMessage("Changelist "+e.chnum+" was unshelved, but "+d.pluralise(t.warnings.length,"file needs",0,"files need")+" resolving",i)===i&&(await h.resolve(this._workspaceUri,{chnum:e.chnum}),this.Refresh())}a.Display.showMessage("Changelist unshelved")}catch(e){a.Display.showImportantError(e.toString())}}async DeleteShelvedChangelist(e){if(e.isDefault)throw new Error("Cannot delete shelved files from the default changelist");const t="Are you sure you want to delete the shelved files from changelist "+e.chnum+"?";if(await this.requestConfirmation(t,"Delete Shelved Files"))try{await h.shelve(this._workspaceUri,{chnum:e.chnum,delete:!0}),this.Refresh(),a.Display.showMessage("Shelved files deleted")}catch(e){a.Display.showImportantError(e.toString())}}async showResolveWarningForFile(e){"Resolve file"===await l.window.showWarningMessage(e.basenameWithoutRev+" was unshelved, but needs resolving","Resolve file")&&(await h.resolve(this._workspaceUri,{files:[e.actionUriNoRev]}),this.Refresh())}async deleteFileAfterUnshelve(e){const t=o.configAccessor.fileShelveMode;if(t===o.FileShelveMode.KEEP_BOTH)return;if(t===o.FileShelveMode.PROMPT){const t=e.basenameWithoutRev,i=t+" was unshelved. Delete the shelved file?",n="Delete "+t+"@="+e.change,r="Always",s="Never",a=await l.window.showWarningMessage(i,{modal:!0},n,r,s);if(a===r)o.configAccessor.fileShelveMode=o.FileShelveMode.SWAP;else{if(a===s)return void(o.configAccessor.fileShelveMode=o.FileShelveMode.KEEP_BOTH);if(a!==n)return}}const i=await h.shelve(this._workspaceUri,{chnum:e.change,delete:!0,paths:[e.depotPath]});a.Display.channel.append(i),this.Refresh()}async revertFileAfterUnshelve(e){const t=o.configAccessor.fileShelveMode;if(t!==o.FileShelveMode.KEEP_BOTH){if(t===o.FileShelveMode.PROMPT){const t=e.basenameWithoutRev,i=t+" was shelved. Revert the open file?",n="Revert "+t,r="Always",s="Never",a=await l.window.showWarningMessage(i,{modal:!0},n,r,s);if(a===r)o.configAccessor.fileShelveMode=o.FileShelveMode.SWAP;else{if(a===s)return void(o.configAccessor.fileShelveMode=o.FileShelveMode.KEEP_BOTH);if(a!==n)return}}await h.revert(this._workspaceUri,{paths:[e.actionUriNoRev]}),this.Refresh()}}async unshelveShelvedFile(e){const t=await h.unshelve(this._workspaceUri,{toChnum:e.change,shelvedChnum:e.change,paths:[e.depotPath]});this.Refresh(),t.warnings.length>0?await this.showResolveWarningForFile(e):await this.deleteFileAfterUnshelve(e),a.Display.updateEditor()}async shelveOpenFile(e){await h.shelve(this._workspaceUri,{chnum:e.change,force:!0,paths:[e.actionUriNoRev]}),this.Refresh(),await this.revertFileAfterUnshelve(e)}async ShelveMultiple(e){if(e.some(e=>e.isShelved))return void a.Display.showModalMessage("Some selected files are already shelved. Please select only unshelved files");const t=e.map(e=>this.shelveOpenFile(e));try{await Promise.all(t)}catch(e){a.Display.showImportantError(e.toString()),this.Refresh()}}async UnshelveMultiple(e){if(e.some(e=>!e.isShelved))return void a.Display.showModalMessage("Some selected files are not shelved. Please select only shelved files");const t=e.map(e=>this.unshelveShelvedFile(e));try{await Promise.all(t)}catch(e){a.Display.showImportantError(e.toString()),this.Refresh()}}async DeleteShelvedFile(e){if(!e.isShelved)return void a.Display.showImportantError("Shelve cannot be used on normal file: "+e.basenameWithoutRev);const t="Are you sure you want to delete the shelved file "+e.depotPath;if(await this.requestConfirmation(t,"Delete Shelved File"))try{const t=await h.shelve(this._workspaceUri,{delete:!0,chnum:e.change,paths:[e.depotPath]});this.Refresh(),a.Display.showMessage(t)}catch(e){a.Display.showImportantError(e.toString())}}async requestJobId(e){return await r.window.showInputBox({prompt:"Enter the job to be fixed by changelist "+e,placeHolder:"jobNNNNNN",validateInput:e=>{if(""===e.trim())return"Enter a job name"}})}async FixJob(e){if(e.isDefault)throw new Error("The default changelist cannot fix a job");const t=await this.requestJobId(e.chnum);if(void 0!==t)try{await h.fixJob(this._workspaceUri,{chnum:e.chnum,jobId:t}),this.Refresh(),a.Display.showMessage("Job "+t+" added")}catch(e){a.Display.showImportantError(e.toString())}}async pickJobFromChangelist(e){const t=(await h.getFixedJobs(this._workspaceUri,{chnum:e})).map(e=>({description:e.description[0],label:e.id,detail:e.description.slice(1).join(" ")}));if(0===t.length)return void a.Display.showModalMessage("Changelist "+e+" does not have any jobs attached");return await r.window.showQuickPick(t,{placeHolder:"Select a job to remove",matchOnDescription:!0,matchOnDetail:!0})}async UnfixJob(e){if(e.isDefault)throw new Error("The default changelist cannot fix a job");const t=await this.pickJobFromChangelist(e.chnum);if(void 0===t)return;const i=t.label;try{await h.fixJob(this._workspaceUri,{chnum:e.chnum,jobId:i,removeFix:!0}),this.Refresh(),a.Display.showMessage("Job "+i+" removed")}catch(e){a.Display.showImportantError(e.toString())}}async requestConfirmation(e,t){return await r.window.showWarningMessage(e,{modal:!0},t)===t}async requestChangelistDescription(){return await r.window.showInputBox({prompt:"Enter the new changelist's description",validateInput:e=>{if(""===e.trim())return"Description must not be empty"}})}async createEmptyChangelistInteractively(){const e=await this.requestChangelistDescription();return e?await this.createEmptyChangelist(e):void 0}async ReopenFile(e){var t,i;if(e.some(e=>e.isShelved))throw a.Display.showImportantError("Cannot reopen a shelved file"),new Error("Cannot reopen shelved file");if(!await h.isLoggedIn(this._workspaceUri))return;const n=[];n.push({id:"default",label:null!==(i=null===(t=this._defaultGroup)||void 0===t?void 0:t.label)&&void 0!==i?i:"Default Changelist",description:""}),n.push({id:"new",label:"New Changelist...",description:""}),this._pendingGroups.forEach((e,t)=>{n.push({id:t,label:"#"+t,description:e.description})});const o=await r.window.showQuickPick(n,{matchOnDescription:!0,placeHolder:"Choose a changelist:"});if(void 0===o)return;const s="new"===o.id?await this.createEmptyChangelistInteractively():o.id;if(void 0!==s){try{const t=await h.reopenFiles(this._workspaceUri,{chnum:s,files:e.map(e=>e.actionUriNoRev)});a.Display.channel.append(t)}catch(e){a.Display.showImportantError(e.toString())}this.Refresh()}}cleanState(){this._openResourcesByPath.clear(),this._conflictsByPath.clear(),this._knownHaveListByPath.clear(),y._resolvable.removeChangelists([...this._pendingGroups.keys()]),y._reResolvable.removeChangelists([...this._pendingGroups.keys()]),this._onDidChangeFileDecorationsEmitter.fire(void 0)}cleanPendingGroups(){this._pendingGroups.forEach(e=>e.group.dispose()),this._pendingGroups.clear(),this._onDidChange.fire()}clean(){this.cleanState(),this._defaultGroup&&(this._defaultGroup.dispose(),this._defaultGroup=void 0),this.cleanPendingGroups()}async syncUpdate(e){try{const t=await h.sync(this._workspaceUri,{files:e});a.Display.channel.append(t),this.Refresh()}catch(e){a.Display.showImportantError(e.toString())}}async updateStatus(){if(!await h.isLoggedIn(this._workspaceUri))return;const e=await this.getChanges(),t=this.getAllShelvedResources(e),i=this.getDepotOpenedResources(),[n,r]=await Promise.all([t,i]);this.createResourceGroups(e,n.concat(r)),this._refreshInProgress=!1,this._onDidChange.fire()}makeResourceForOpenFile(e){const t=e.clientFile,i=e.change,n=e.action,s=e.headType,a=r.Uri.file(e.depotFile),l=r.Uri.file(t);if((this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_FILES||this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_CHANGELISTS_AND_DEFAULT_FILES&&"default"===i)&&!this.isUriInWorkspace(l))return;return new c.Resource(this,a,l,i,!1,n,e,s)}static getChangelistsWhereSome(e,t){return e.filter(e=>e.resourceStates.some(e=>t(e))).map(e=>e.chnum)}static updateContextVars(e){this._resolvable.addChangelists(this.getChangelistsWhereSome(e,e=>e.isUnresolved)),this._reResolvable.addChangelists(this.getChangelistsWhereSome(e,e=>e.isReresolvable))}updateDecorations(){const e=[...this._openResourcesByPath.values()].map(e=>e.underlyingUri).filter(d.isTruthy);this._onDidChangeFileDecorationsEmitter.fire(e)}shouldDisplayChangelist(e){if(this._config.hideEmptyChangelists&&e.length<1)return!1;if(this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_CHANGELISTS){if(e.length>0&&e.every(e=>!this.isUriInWorkspace(e.underlyingUri)))return!1}return!0}getOrCreateResourceGroup(e){var t;let i=null===(t=this._pendingGroups.get(e.chnum))||void 0===t?void 0:t.group;return i?i.label="#"+e.chnum+": "+e.description.join(" "):(i=this._sourceControl.createResourceGroup("pending:"+e.chnum,"#"+e.chnum+": "+e.description.join(" ")),i.model=this,i.isDefault=!1,i.chnum=e.chnum.toString()),i}arrangeResourcesByChangelist(e,t){const i=e.map(e=>{const i=t.filter(t=>t.change===e.chnum);if(this.shouldDisplayChangelist(i))return{change:e,resources:i}}).filter(d.isTruthy);return{haveNewChangelists:i.some(e=>!this._pendingGroups.has(e.change.chnum)),changesWithResources:i}}disposeUnusedGroups(e){this._pendingGroups.forEach(t=>{e.includes(t.group)||(t.group.dispose(),this._pendingGroups.delete(t.group.chnum))})}createResourceGroups(e,t){if(!this._sourceControl)throw new Error("Source control not initialised");this._fullCleanOnNextRefresh?this.clean():this.cleanState(),this._defaultGroup||(this._defaultGroup=this._sourceControl.createResourceGroup("default","Default Changelist"),this._defaultGroup.isDefault=!0,this._defaultGroup.model=this,this._defaultGroup.chnum="default"),this._defaultGroup.resourceStates=t.filter(e=>!!e&&"default"===e.change);const i=this.arrangeResourcesByChangelist(e,t);i.haveNewChangelists&&this.cleanPendingGroups();const n=i.changesWithResources.map(({change:e,resources:t})=>{const i=this.getOrCreateResourceGroup(e);return i.resourceStates=t,i});this.disposeUnusedGroups(n),t.forEach(e=>{!e.isShelved&&e.underlyingUri&&this._openResourcesByPath.set(e.underlyingUri.fsPath,e)}),n.forEach((t,i)=>{this._pendingGroups.set(e[i].chnum,{description:e[i].description.join(" "),group:t})}),y.updateContextVars(n),this.updateDecorations(),this._fullCleanOnNextRefresh=!1}async getChanges(){const e=this.filterIgnoredChangelists(await h.getChangelists(this._workspaceUri,{client:this._clientName,status:h.ChangelistStatus.PENDING}));return"ascending"===this._config.changelistOrder?e.reverse():e}filterIgnoredChangelists(e){const t=this._config.ignoredChangelistPrefix;return t&&(e=e.filter(e=>!e.description[0].startsWith(t))),e}async getAllShelvedResources(e){if(this._config.hideShelvedFiles||0===e.length)return[];const t=await h.getShelvedFiles(this._workspaceUri,{chnums:e.map(e=>e.chnum)});return this.getShelvedResources(t)}makeResourceForShelvedFile(e,t){const i=t.clientFile?r.Uri.file(t.clientFile):void 0;if(this._config.hideNonWorkspaceFiles===o.HideNonWorkspace.HIDE_FILES&&!this.isUriInWorkspace(i))return;return new c.Resource(this,s.fromDepotPath(null!=i?i:this.workspaceUri,t.depotFile,void 0),i,e,!0,t.action,t)}async getShelvedResources(e){const t=e.map(e=>h.getFstatInfoMapped(this._workspaceUri,{depotPaths:e.paths,limitToShelved:!0,outputPendingRecord:!0,chnum:e.chnum.toString()}));return(await Promise.all(t)).flatMap((t,i)=>t.filter(d.isTruthy).map(t=>this.makeResourceForShelvedFile(e[i].chnum.toString(),t)).filter(d.isTruthy))}async getDepotOpenedResources(){const e=await this.getDepotOpenedFilePaths();return(await h.getFstatInfoMapped(this._workspaceUri,{depotPaths:e,outputPendingRecord:!0})).filter(d.isTruthy).map(e=>this.makeResourceForOpenFile(e)).filter(d.isTruthy)}async getDepotOpenedFilePaths(){return(await h.getOpenedFiles(this._workspaceUri,{})).map(e=>e.depotPath)}}t.Model=y,y._resolvable=new w("resolvable"),y._reResolvable=new w("reresolvable")},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(3)),o=n(i(0)),s=n(i(2)),a=i(10);t.returnStdOut=function(e){return()=>function(e){return[e,""]}(e)},t.returnStdErr=function(e){return()=>function(e){return["",e]}(e)},t.getStatusText=function(e){switch(e){case a.Status.ADD:return"add";case a.Status.ARCHIVE:return"archive";case a.Status.BRANCH:return"branch";case a.Status.DELETE:return"delete";case a.Status.EDIT:return"edit";case a.Status.IMPORT:return"import";case a.Status.INTEGRATE:return"integrate";case a.Status.LOCK:return"lock";case a.Status.MOVE_ADD:return"move/add";case a.Status.MOVE_DELETE:return"move/delete";case a.Status.PURGE:return"purge";case a.Status.UNKNOWN:return"???"}},t.getWorkspaceUri=function(){if(!o.workspace.workspaceFolders)throw new Error("No workspace folders open");return o.workspace.workspaceFolders[0].uri},t.getLocalFile=function(e,...t){return o.Uri.file(r.resolve(e.fsPath,...t))},t.perforceLocalUriMatcher=function(e){if(!e.localFile)throw new Error("Can't make a local file matcher without a local file");return s.fromUriWithRevision(e.localFile,e.depotRevision.toString())},t.perforceDepotUriMatcher=function(e){return s.fromDepotPath(e.localFile,e.depotPath,e.depotRevision.toString())},t.perforceFromFileUriMatcher=function(e){var t;if(!e.resolveFromDepotPath)throw new Error("Must have a depot path to resolve from!");return s.fromDepotPath(e.localFile,e.resolveFromDepotPath,null===(t=e.resolveEndFromRev)||void 0===t?void 0:t.toString())},t.perforceLocalShelvedUriMatcher=function(e,t){if(!e.localFile)throw new Error("Can't make a local file matcher without a local file");return s.fromUriWithRevision(e.localFile,"@="+t)}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(2)),o=n(i(13)),s=i(1),a=i(16),c=i(7).configAccessor;function l(e){return"$("+e+")"}function u(e){return c.getSwarmLink(e.chnum)+' "Open in review tool"'}function h(e,...t){return"command:"+e+"?"+encodeURIComponent(JSON.stringify(t))}function d(e,t,i){return h("perforce.diffFiles",...[p(e,t),p(e,i)])+' "'+o.diffTitleForDepotPaths(t.file,t.revision,i.file,i.revision)+'"'}function p(e,t){return r.fromDepotPath(e,t.file,t.revision)}function f(e,t){return h("perforce.annotate",p(e,t))+' "Show annotations for '+t.file+"#"+t.revision+'"'}function m(e,t,i){return i?"["+e+"]("+t+")":"\\[["+e+"]("+t+")\\]"}t.codicon=l,t.makeSwarmHostURL=u,t.makeDiffURI=d,t.makeAnnotateURI=f,t.makeMarkdownLink=m,t.makeAllLinks=function(e,t,i,n){return[n?m("Diff Previous",d(e,n,t)):void 0,t!==i?m("Diff this Revision",d(e,t,i)):void 0,n?m("Annotate Previous",f(e,n)):void 0,c.swarmHost?m(l("eye"),u(t),!0):void 0,m("…",function(e,t){return h("perforce.showQuickPick","file",p(e,t))+' "Show more actions for this file"'}(e,t),!0)].filter(s.isTruthy).join(" ")},t.makeUserAndDateSummary=function(e,t){return t.file+"#"+t.revision+"\n\n"+m("Change "+t.chnum,function(e,t){return h("perforce.showQuickPick","change",e,t.chnum)+' "Show actions for changelist '+t.chnum+'"'}(e,t),!0)+" by **`"+t.user+"`** on `"+a.toReadableDateTime(t.date)+"`"},t.convertToMarkdown=function(e){return e.replace(/\n+/g,"\n\n")}},function(e,t,i){var n=i(75);e.exports={locale:n.locale,long:n.long,short:n.short,narrow:n.narrow,"short-time":i(80),"short-convenient":i(81),"long-time":i(82),"long-convenient":i(83),tiny:i(84),quantify:n.quantify}},function(e,t,i){e.exports={locale:"en",long:i(76),short:i(77),narrow:i(78),quantify:i(79)}},function(e){e.exports=JSON.parse('{"year":{"previous":"last year","current":"this year","next":"next year","past":{"one":"{0} year ago","other":"{0} years ago"},"future":{"one":"in {0} year","other":"in {0} years"}},"quarter":{"previous":"last quarter","current":"this quarter","next":"next quarter","past":{"one":"{0} quarter ago","other":"{0} quarters ago"},"future":{"one":"in {0} quarter","other":"in {0} quarters"}},"month":{"previous":"last month","current":"this month","next":"next month","past":{"one":"{0} month ago","other":"{0} months ago"},"future":{"one":"in {0} month","other":"in {0} months"}},"week":{"previous":"last week","current":"this week","next":"next week","past":{"one":"{0} week ago","other":"{0} weeks ago"},"future":{"one":"in {0} week","other":"in {0} weeks"}},"day":{"previous":"yesterday","current":"today","next":"tomorrow","past":{"one":"{0} day ago","other":"{0} days ago"},"future":{"one":"in {0} day","other":"in {0} days"}},"hour":{"current":"this hour","past":{"one":"{0} hour ago","other":"{0} hours ago"},"future":{"one":"in {0} hour","other":"in {0} hours"}},"minute":{"current":"this minute","past":{"one":"{0} minute ago","other":"{0} minutes ago"},"future":{"one":"in {0} minute","other":"in {0} minutes"}},"second":{"current":"now","past":{"one":"{0} second ago","other":"{0} seconds ago"},"future":{"one":"in {0} second","other":"in {0} seconds"}}}')},function(e){e.exports=JSON.parse('{"year":{"previous":"last yr.","current":"this yr.","next":"next yr.","past":"{0} yr. ago","future":"in {0} yr."},"quarter":{"previous":"last qtr.","current":"this qtr.","next":"next qtr.","past":{"one":"{0} qtr. ago","other":"{0} qtrs. ago"},"future":{"one":"in {0} qtr.","other":"in {0} qtrs."}},"month":{"previous":"last mo.","current":"this mo.","next":"next mo.","past":"{0} mo. ago","future":"in {0} mo."},"week":{"previous":"last wk.","current":"this wk.","next":"next wk.","past":"{0} wk. ago","future":"in {0} wk."},"day":{"previous":"yesterday","current":"today","next":"tomorrow","past":{"one":"{0} day ago","other":"{0} days ago"},"future":{"one":"in {0} day","other":"in {0} days"}},"hour":{"current":"this hour","past":"{0} hr. ago","future":"in {0} hr."},"minute":{"current":"this minute","past":"{0} min. ago","future":"in {0} min."},"second":{"current":"now","past":"{0} sec. ago","future":"in {0} sec."}}')},function(e){e.exports=JSON.parse('{"year":{"previous":"last yr.","current":"this yr.","next":"next yr.","past":"{0} yr. ago","future":"in {0} yr."},"quarter":{"previous":"last qtr.","current":"this qtr.","next":"next qtr.","past":{"one":"{0} qtr. ago","other":"{0} qtrs. ago"},"future":{"one":"in {0} qtr.","other":"in {0} qtrs."}},"month":{"previous":"last mo.","current":"this mo.","next":"next mo.","past":"{0} mo. ago","future":"in {0} mo."},"week":{"previous":"last wk.","current":"this wk.","next":"next wk.","past":"{0} wk. ago","future":"in {0} wk."},"day":{"previous":"yesterday","current":"today","next":"tomorrow","past":{"one":"{0} day ago","other":"{0} days ago"},"future":{"one":"in {0} day","other":"in {0} days"}},"hour":{"current":"this hour","past":"{0} hr. ago","future":"in {0} hr."},"minute":{"current":"this minute","past":"{0} min. ago","future":"in {0} min."},"second":{"current":"now","past":"{0} sec. ago","future":"in {0} sec."}}')},function(e,t){e.exports=function(e){var t=!String(e).split(".")[1];return 1==e&&t?"one":"other"}},function(e){e.exports=JSON.parse('{"year":"{0} yr.","month":"{0} mo.","week":"{0} wk.","day":{"one":"{0} day","other":"{0} days"},"hour":"{0} hr.","minute":"{0} min.","second":"{0} sec.","now":"now"}')},function(e){e.exports=JSON.parse('{"year":{"previous":"last yr.","current":"this yr.","next":"next yr.","past":"{0} yr. ago","future":"in {0} yr."},"quarter":{"previous":"last qtr.","current":"this qtr.","next":"next qtr.","past":{"one":"{0} qtr. ago","other":"{0} qtrs. ago"},"future":{"one":"in {0} qtr.","other":"in {0} qtrs."}},"month":{"previous":"last mo.","current":"this mo.","next":"next mo.","past":"{0} mo. ago","future":"in {0} mo."},"week":{"previous":"last wk.","current":"this wk.","next":"next wk.","past":"{0} wk. ago","future":"in {0} wk."},"day":{"previous":"yesterday","current":"today","next":"tomorrow","past":{"one":"{0} day ago","other":"{0} days ago"},"future":{"one":"in {0} day","other":"in {0} days"}},"hour":{"current":"this hour","past":"{0} hr. ago","future":"in {0} hr."},"minute":{"current":"this minute","past":"{0} min. ago","future":"in {0} min."},"second":{"current":"now","past":"{0} sec. ago","future":"in {0} sec."},"now":{"future":"in a moment","past":"just now"}}')},function(e){e.exports=JSON.parse('{"year":{"one":"{0} year","other":"{0} years"},"month":{"one":"{0} month","other":"{0} months"},"week":{"one":"{0} week","other":"{0} weeks"},"day":{"one":"{0} day","other":"{0} days"},"hour":{"one":"{0} hour","other":"{0} hours"},"minute":{"one":"{0} minute","other":"{0} minutes"},"second":{"one":"{0} second","other":"{0} seconds"},"now":{"future":"in a moment","past":"just now"}}')},function(e){e.exports=JSON.parse('{"year":{"previous":"last year","current":"this year","next":"next year","past":{"one":"a year ago","other":"{0} years ago"},"future":{"one":"in a year","other":"in {0} years"}},"quarter":{"previous":"last quarter","current":"this quarter","next":"next quarter","past":{"one":"a quarter ago","other":"{0} quarters ago"},"future":{"one":"in a quarter","other":"in {0} quarters"}},"month":{"previous":"last month","current":"this month","next":"next month","past":{"one":"a month ago","other":"{0} months ago"},"future":{"one":"in a month","other":"in {0} months"}},"week":{"previous":"last week","current":"this week","next":"next week","past":{"one":"a week ago","other":"{0} weeks ago"},"future":{"one":"in a week","other":"in {0} weeks"}},"day":{"previous":"yesterday","current":"today","next":"tomorrow","past":{"one":"a day ago","other":"{0} days ago"},"future":{"one":"in a day","other":"in {0} days"}},"hour":{"current":"this hour","past":{"one":"an hour ago","other":"{0} hours ago"},"future":{"one":"in an hour","other":"in {0} hours"}},"minute":{"current":"this minute","past":{"one":"a minute ago","other":"{0} minutes ago"},"future":{"one":"in a minute","other":"in {0} minutes"}},"second":{"current":"now","past":{"one":"a second ago","other":"{0} seconds ago"},"future":{"one":"in a second","other":"in {0} seconds"}},"now":{"future":"in a moment","past":"just now"}}')},function(e){e.exports=JSON.parse('{"year":"{0}yr","month":"{0}mo","week":"{0}wk","day":"{0}d","hour":"{0}h","minute":"{0}m","second":"{0}s","now":"now"}')},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(16),r=i(4),o=i(1);function s(e){const t=/^(->)?(?:\{(.*?)\})?(\.{3})?(revision|chnum|user|client|description|timeAgo)\|(\d+)$/.exec(e);if(t){const[,e,i,n,r,o]=t;return{name:r,length:parseInt(o),padLeft:!!e,truncateRight:!!n,prefix:i}}r.Display.showImportantError(e+" is not a valid column format. Skipping this column")}t.parseColumns=function(e){return e.map(s).filter(o.isTruthy).filter(e=>e.length&&e.length>=0)},t.parseColumn=s;const a={revision:{value:(e,t)=>e.file===t.file?e.revision:"ᛦ"+e.revision},chnum:{value:e=>e.chnum},user:{value:e=>e.user},client:{value:e=>e.client},description:{value:e=>c(e.description)},timeAgo:{value:e=>e.date?n.timeAgo.format(e.date):"Unknown"}};function c(e){return e.replace(/\s/g," ")}t.calculateTotalWidth=function(e){const t=e.reduce((e,t)=>{var i,n;return e+t.length+(null!==(n=null===(i=t.prefix)||void 0===i?void 0:i.length)&&void 0!==n?n:0)+1},-1);return Math.max(0,t)},t.makeSummaryText=function(e,t,i){return i.reduceRight((i,n)=>{var r;const o=c(a[n.name].value(e,t)),s=/^([\s\xa0]*)/.exec(i),l=(null==s?void 0:s[1])?s[1].length:0;return function(e,t,i,n,r){const o=function(e,t,i,n){return e.length>i?n?t+"…"+e.slice(-(i-1)):t+e.slice(0,i-1)+"…":t+e}(e,t,i,r),s=" ".repeat(Math.max(0,i-(o.length-t.length)));return n?s+o:o+s}(o,null!==(r=n.prefix)&&void 0!==r?r:"",n.length+l,n.padLeft,n.truncateRight)+" "+i.slice(l)},"")}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0)),o=i(45),s=i(1),a=i(6),c=n(i(2)),l=n(i(3)),u=i(7),h=i(87),d=n(i(6)),p=i(4),f=i(29);class m extends o.SelfExpandingTreeItem{constructor(e,t){super(e.name+":",r.TreeItemCollapsibleState.None),this._filter=e,this._mementoItem=t,this._didChangeFilter=new r.EventEmitter,this._subscriptions.push(this._didChangeFilter),this.setValueWithoutEvent(t.value)}get onDidChangeFilter(){return this._didChangeFilter.event}get command(){return{command:"perforce.changeSearch.setFilter",title:"Set "+this._filter.name,arguments:[this]}}setValueWithoutEvent(e){var t;this._selected=e,e&&void 0!==e.value?this.description=null===(t=this._selected)||void 0===t?void 0:t.label:this.description="<"+this._filter.defaultText+">",this._mementoItem.save(e)}setValue(e){const t=this._selected!==e;this.setValueWithoutEvent(e),t&&this._didChangeFilter.fire()}async requestNewValue(){const e=await this.chooseValue();e&&(this.setValue(e),this.didChange())}get value(){var e;return null===(e=this._selected)||void 0===e?void 0:e.value}get tooltip(){return this._filter.placeHolder}get contextValue(){var e;return void 0!==(null===(e=this._selected)||void 0===e?void 0:e.value)?"filterItem-val":"filterItem-empty"}reset(e=!0){this.setValue(void 0),this.didChange(),e&&this._didChangeFilter.fire()}}t.FilterItem=m;class g extends m{constructor(e){super({name:"Status",placeHolder:"Filter by changelist status",defaultText:"all"},e)}async chooseValue(){const e=[{label:"$(tools) Pending",description:"Search for pending changelists",value:{label:"pending",value:a.ChangelistStatus.PENDING}},{label:"$(check) Submitted",description:"Search for submitted changelists",value:{label:"submitted",value:a.ChangelistStatus.SUBMITTED}},{label:"$(files) Shelved",description:"Search for shelved changelists",value:{label:"shelved",value:a.ChangelistStatus.SHELVED}},{label:"$(chrome-close) Reset",description:"Don't filter by changelist status",value:{label:"all",value:void 0}}],t=await r.window.showQuickPick(e,{placeHolder:this._filter.placeHolder});return null==t?void 0:t.value}}async function v(e,t,i){const n=await i(e);if(n.length<1)return void p.Display.showImportantError("No results found for filter "+e);const o=n.map(e=>({label:e,value:{label:e,value:e},alwaysShow:!0})),s=await r.window.showQuickPick(o,{placeHolder:t});return null==s?void 0:s.value}async function w(e,t,i,n,o,a){var c,l,u;const d=[i&&void 0!==n?{label:"$(person) Current "+o,description:n,value:{label:null!=n?n:"",value:n}}:void 0,{label:"$(chrome-close) Reset",description:"Don't filter by "+o,value:{label:"any",value:void 0}}].filter(s.isTruthy),p="Type a "+o+" filter",f=await h.showComboBoxInput(d,{placeHolder:e,matchOnDescription:!0,insertBeforeIndex:1},e=>{const t=e.includes("*");return[{label:e?(t?"$(search) Search for ":"$(edit) Entered ")+o+": "+e:"$(edit) Enter a "+o,description:e?"":p,detail:e?" ".repeat(4)+"Use * as a wildcard to perform a search":"",alwaysShow:!0,value:{label:e,value:e}}]});return(null==f?void 0:f.description)!==p||(null===(c=f.value)||void 0===c?void 0:c.value)?(null==f?void 0:f.label.startsWith("$(search)"))?v(null!==(u=null===(l=f.value)||void 0===l?void 0:l.value)&&void 0!==u?u:"*",e,a):null==f?void 0:f.value:async function(e,t,i){const n=await r.window.showInputBox({prompt:e+" (use * for wildcards)",value:t,placeHolder:e});if(void 0!==n)return n.includes("*")?v(n,e,i):{label:n,value:n||void 0}}("Enter a "+o,null!=t?t:"",a)}class y extends m{constructor(e,t){super({name:"User",placeHolder:"Filter by username",defaultText:"any"},t),this._provider=e}async chooseValue(){const e=this._provider.client;if(!e)throw new Error("No client selected");return w(this._filter.placeHolder,this.value,e,e.userName,"user",async t=>(await d.users(e.configSource,{max:200,userFilters:[t.replace("*","...")]})).map(e=>e.user))}}class _ extends m{constructor(e,t){super({name:"Client",placeHolder:"Filter by perforce client",defaultText:"any"},t),this._provider=e}async chooseValue(){var e;const t=this._provider.client;if(!t)throw new Error("No client selected");return w(this._filter.placeHolder,this.value,this._provider.client,null===(e=this._provider.client)||void 0===e?void 0:e.clientName,"perforce client",async e=>(await d.clients(t.configSource,{max:200,nameFilter:e.replace("*","...")})).map(e=>e.client))}}class C extends o.SelfExpandingTreeItem{constructor(e){super(e)}get contextValue(){return"fileFilter"}get iconPath(){return new r.ThemeIcon("file")}async edit(){const e=await r.window.showInputBox({prompt:"Enter a local file or depot path. Use '...' for wildcards",validateInput:e=>{if(""===e.trim())return"Please enter a value"},value:this.labelText});e&&(this.label=e,this.didChange())}}t.FileFilterValue=C;class S extends o.SelfExpandingTreeItem{constructor(e){super("Add path..."),this._command=e}get command(){return this._command}}class b extends o.SelfExpandingTreeItem{constructor(e,t){super("Files",r.TreeItemCollapsibleState.Expanded,{reverseChildren:!0}),this._provider=e,this._memento=t,this.description="Any of the following paths:",this.addChild(new S({command:"perforce.changeSearch.addFileFilter",arguments:[this],title:"Add file filter"})),this._didChangeFilter=new r.EventEmitter,this._subscriptions.push(this._didChangeFilter),this.loadFromMemento()}get onDidChangeFilter(){return this._didChangeFilter.event}loadFromMemento(){var e;null===(e=this._memento.value)||void 0===e||e.forEach(e=>this.addSelectedFilterWithoutEvent(new C(e)))}get contextValue(){return"fileFilters"}async getFilePathFromClipboard(){var e;const t=null===(e=await r.env.clipboard.readText())||void 0===e?void 0:e.split("\n")[0];return(null==t?void 0:t.includes("/"))||(null==t?void 0:t.includes("\\"))||(null==t?void 0:t.includes("..."))?t:void 0}getOpenFilePath(){var e;const t=null===(e=r.window.activeTextEditor)||void 0===e?void 0:e.document.uri;if(!t||"perforce"!==t.scheme&&"file"!==t.scheme)return;return c.isDepotUri(t)?c.getDepotPathFromDepotUri(t):c.fsPathWithoutRev(t)}getClientRootPath(){var e;return(null===(e=this._provider.client)||void 0===e?void 0:e.clientRoot.fsPath)?l.join(this._provider.client.clientRoot.fsPath,"..."):void 0}getClientConfigSourcePath(){var e;return(null===(e=this._provider.client)||void 0===e?void 0:e.configSource.fsPath)?l.join(this._provider.client.configSource.fsPath,"..."):void 0}async enterCustomValue(){var e;const t=await this.getFilePathFromClipboard();return await r.window.showInputBox({prompt:"Enter a local file or depot path. Use '...' for wildcards",validateInput:e=>{if(""===e.trim())return"Please enter a value"},value:null!==(e=null!=t?t:this.getOpenFilePath())&&void 0!==e?e:this.getClientConfigSourcePath()})}makeOpenFilePicks(){const e=this.getOpenFilePath();if(!e)return[];const t=l.dirname(e)+(e.startsWith("/")?"/":l.sep)+"...";return[{label:"Current Editor File",description:e,value:e},{label:"Current File's Folder",description:t,value:t}]}async pickNewFilter(){const e=this.getClientRootPath(),t=e?{label:"Client Root",description:e,value:e}:void 0,i=this.getClientConfigSourcePath(),n=i&&e!==i?{label:"Workspace location",description:i,value:i}:void 0,r=this.getChildren(),o=[t,n,...this.makeOpenFilePicks()].filter(s.isTruthy).filter(e=>!r.some(t=>t.label===e.value)),a=await h.showComboBoxInput(o,{matchOnDescription:!0,placeHolder:"Filter by a depot or file path"},e=>[{label:e?"Entered path: "+e:"Enter a path",description:e?"":"Type a path",detail:e?" ".repeat(4)+"Use ... for wildcards":void 0,alwaysShow:!0,value:e}]);if(a)return"Type a path"!==a.description||a.value?a.value:await this.enterCustomValue()}async addNewFilter(){const e=await this.pickNewFilter();e&&(this.addSelectedFilter(e),this.saveDefault())}addSelectedFilterWithoutEvent(e){this.addChild(e),this._subscriptions.push(e.onDisposed(()=>{this._didChangeFilter.fire(),this.saveDefault()}),e.onChanged(()=>{this._didChangeFilter.fire(),this.saveDefault()}))}addSelectedFilter(e){const t=new C(e);this.addSelectedFilterWithoutEvent(t),this.didChange(),this._didChangeFilter.fire(),t.reveal()}get value(){return this.getChildren().filter(e=>"fileFilter"===e.contextValue).map(e=>e.labelText).filter(s.isTruthy)}reset(e=!0){this.getChildren().filter(e=>"fileFilter"===e.contextValue).forEach(e=>e.dispose()),e&&this._didChangeFilter.fire(),this.didChange(),this.saveDefault()}saveDefault(){this._memento.save(this.value)}}t.FileFilterRoot=b;class E extends o.SelfExpandingTreeItem{constructor(e,t){super("Filters",r.TreeItemCollapsibleState.Expanded),this.contextValue="filterRoot",this._statusFilter=new g(new f.MementoItem(f.MementoKeys.SEARCH_STATUS,t)),this.addChild(this._statusFilter),this._userFilter=new y(e,new f.MementoItem(f.MementoKeys.SEARCH_USER,t)),this.addChild(this._userFilter),this._clientFilter=new _(e,new f.MementoItem(f.MementoKeys.SEARCH_CLIENT,t)),this.addChild(this._clientFilter),this._fileFilter=new b(e,new f.MementoItem(f.MementoKeys.SEARCH_FILES,t)),this.addChild(this._fileFilter),this._didChangeFilters=new r.EventEmitter,this.subscribeToChanges([this._statusFilter,this._userFilter,this._clientFilter,this._fileFilter]),this._subscriptions.push(this._didChangeFilters)}get onDidChangeFilters(){return this._didChangeFilters.event}subscribeToChanges(e){e.forEach(e=>this._subscriptions.push(e.onDidChangeFilter(()=>this._didChangeFilters.fire())))}get currentFilters(){return{status:this._statusFilter.value,client:this._clientFilter.value,user:this._userFilter.value,files:this._fileFilter.value}}resetAllFilters(){this._userFilter.reset(!1),this._clientFilter.reset(!1),this._statusFilter.reset(!1),this._fileFilter.reset(!1),this._didChangeFilters.fire()}}t.FilterRootItem=E,t.makeFilterLabelText=function(e,t){const i=[e.status?e.status:void 0,e.user?"User: "+e.user:void 0,e.client?"Client: "+e.client:void 0,e.files&&e.files.length>0?s.pluralise(e.files.length,"path"):void 0].filter(s.isTruthy),n=i.length>0?i.join("] ["):"no filters";return"("+s.pluralise(t,"result",u.configAccessor.changelistSearchMaxResults)+") ["+n+"]"}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0));t.showComboBoxInput=async function(e,t,i){var n,o,s;const a=r.window.createQuickPick(),c=[a],l=()=>c.forEach(e=>e.dispose());a.matchOnDescription=null!==(n=t.matchOnDescription)&&void 0!==n&&n,a.matchOnDetail=null!==(o=t.matchOnDetail)&&void 0!==o&&o,a.ignoreFocusOut=null!==(s=t.ignoreFocusOut)&&void 0!==s&&s,a.placeholder=t.placeHolder;const u=i("");a.items=function(e,t,i){return void 0===i?[...e,...t]:[...e.slice(0,i),...t,...e.slice(i)]}(e,u,t.insertBeforeIndex);let h=new Set(u);c.push(a.onDidChangeValue(e=>{const t=i(e);a.items=a.items.filter(e=>!h.has(e)).concat(t),h=new Set(t),a.activeItems=t.slice(-1)}));const d=new Promise(e=>{c.push(a.onDidAccept(()=>{e(a.selectedItems[0]),a.hide(),l()})),c.push(a.onDidHide(()=>{e(void 0),l()}))});return a.show(),d}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=n(i(0));t.ProviderSelection=class{constructor(){this._onDidChangeProvider=new r.EventEmitter}get client(){return this._selectedProvider}set client(e){this._selectedProvider=e,this._onDidChangeProvider.fire(e)}get onDidChangeProvider(){return this._onDidChangeProvider.event}dispose(){this._onDidChangeProvider.dispose()}}},function(e,t,i){"use strict";const n=i(90),r=i(91),o=i(102);function s(e,t,i){const s=r(e,t,i),a=n.spawn(s.command,s.args,s.options);return o.hookChildProcess(a,s),a}e.exports=s,e.exports.spawn=s,e.exports.sync=function(e,t,i){const s=r(e,t,i),a=n.spawnSync(s.command,s.args,s.options);return a.error=a.error||o.verifyENOENTSync(a.status,s),a},e.exports._parse=r,e.exports._enoent=o},function(e,t){e.exports=require("child_process")},function(e,t,i){"use strict";const n=i(3),r=i(92),o=i(98),s=i(99),a="win32"===process.platform,c=/\.(?:com|exe)$/i,l=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function u(e){if(!a)return e;const t=function(e){e.file=r(e);const t=e.file&&s(e.file);return t?(e.args.unshift(e.file),e.command=t,r(e)):e.file}(e),i=!c.test(t);if(e.options.forceShell||i){const i=l.test(t);e.command=n.normalize(e.command),e.command=o.command(e.command),e.args=e.args.map(e=>o.argument(e,i));const r=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${r}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}e.exports=function(e,t,i){t&&!Array.isArray(t)&&(i=t,t=null);const n={command:e,args:t=t?t.slice(0):[],options:i=Object.assign({},i),file:void 0,original:{command:e,args:t}};return i.shell?n:u(n)}},function(e,t,i){"use strict";const n=i(3),r=i(93),o=i(97)();function s(e,t){const i=process.cwd(),s=null!=e.options.cwd,a=s&&void 0!==process.chdir;if(a)try{process.chdir(e.options.cwd)}catch(e){}let c;try{c=r.sync(e.command,{path:(e.options.env||process.env)[o],pathExt:t?n.delimiter:void 0})}catch(e){}finally{a&&process.chdir(i)}return c&&(c=n.resolve(s?e.options.cwd:"",c)),c}e.exports=function(e){return s(e)||s(e,!0)}},function(e,t,i){const n="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,r=i(3),o=n?";":":",s=i(94),a=e=>Object.assign(new Error("not found: "+e),{code:"ENOENT"}),c=(e,t)=>{const i=t.colon||o,r=e.match(/\//)||n&&e.match(/\\/)?[""]:[...n?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(i)],s=n?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",a=n?s.split(i):[""];return n&&-1!==e.indexOf(".")&&""!==a[0]&&a.unshift(""),{pathEnv:r,pathExt:a,pathExtExe:s}},l=(e,t,i)=>{"function"==typeof t&&(i=t,t={}),t||(t={});const{pathEnv:n,pathExt:o,pathExtExe:l}=c(e,t),u=[],h=i=>new Promise((o,s)=>{if(i===n.length)return t.all&&u.length?o(u):s(a(e));const c=n[i],l=/^".*"$/.test(c)?c.slice(1,-1):c,h=r.join(l,e),p=!l&&/^\.[\\\/]/.test(e)?e.slice(0,2)+h:h;o(d(p,i,0))}),d=(e,i,n)=>new Promise((r,a)=>{if(n===o.length)return r(h(i+1));const c=o[n];s(e+c,{pathExt:l},(o,s)=>{if(!o&&s){if(!t.all)return r(e+c);u.push(e+c)}return r(d(e,i,n+1))})});return i?h(0).then(e=>i(null,e),i):h(0)};e.exports=l,l.sync=(e,t)=>{t=t||{};const{pathEnv:i,pathExt:n,pathExtExe:o}=c(e,t),l=[];for(let a=0;a<i.length;a++){const c=i[a],u=/^".*"$/.test(c)?c.slice(1,-1):c,h=r.join(u,e),d=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+h:h;for(let e=0;e<n.length;e++){const i=d+n[e];try{if(s.sync(i,{pathExt:o})){if(!t.all)return i;l.push(i)}}catch(e){}}}if(t.all&&l.length)return l;if(t.nothrow)return null;throw a(e)}},function(e,t,i){var n;i(12);function r(e,t,i){if("function"==typeof t&&(i=t,t={}),!i){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(i,n){r(e,t||{},(function(e,t){e?n(e):i(t)}))}))}n(e,t||{},(function(e,n){e&&("EACCES"===e.code||t&&t.ignoreErrors)&&(e=null,n=!1),i(e,n)}))}n="win32"===process.platform||global.TESTING_WINDOWS?i(95):i(96),e.exports=r,r.sync=function(e,t){try{return n.sync(e,t||{})}catch(e){if(t&&t.ignoreErrors||"EACCES"===e.code)return!1;throw e}}},function(e,t,i){e.exports=o,o.sync=function(e,t){return r(n.statSync(e),e,t)};var n=i(12);function r(e,t,i){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,t){var i=void 0!==t.pathExt?t.pathExt:process.env.PATHEXT;if(!i)return!0;if(-1!==(i=i.split(";")).indexOf(""))return!0;for(var n=0;n<i.length;n++){var r=i[n].toLowerCase();if(r&&e.substr(-r.length).toLowerCase()===r)return!0}return!1}(t,i)}function o(e,t,i){n.stat(e,(function(n,o){i(n,!n&&r(o,e,t))}))}},function(e,t,i){e.exports=r,r.sync=function(e,t){return o(n.statSync(e),t)};var n=i(12);function r(e,t,i){n.stat(e,(function(e,n){i(e,!e&&o(n,t))}))}function o(e,t){return e.isFile()&&function(e,t){var i=e.mode,n=e.uid,r=e.gid,o=void 0!==t.uid?t.uid:process.getuid&&process.getuid(),s=void 0!==t.gid?t.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),l=parseInt("001",8),u=a|c;return i&l||i&c&&r===s||i&a&&n===o||i&u&&0===o}(e,t)}},function(e,t,i){"use strict";const n=(e={})=>{const t=e.env||process.env;return"win32"!==(e.platform||process.platform)?"PATH":Object.keys(t).reverse().find(e=>"PATH"===e.toUpperCase())||"Path"};e.exports=n,e.exports.default=n},function(e,t,i){"use strict";const n=/([()\][%!^"`<>&|;, *?])/g;e.exports.command=function(e){return e=e.replace(n,"^$1")},e.exports.argument=function(e,t){return e=(e=`"${e=(e=(e=""+e).replace(/(\\*)"/g,'$1$1\\"')).replace(/(\\*)$/,"$1$1")}"`).replace(n,"^$1"),t&&(e=e.replace(n,"^$1")),e}},function(e,t,i){"use strict";const n=i(12),r=i(100);e.exports=function(e){const t=Buffer.alloc(150);let i;try{i=n.openSync(e,"r"),n.readSync(i,t,0,150,0),n.closeSync(i)}catch(e){}return r(t.toString())}},function(e,t,i){"use strict";const n=i(101);e.exports=(e="")=>{const t=e.match(n);if(!t)return null;const[i,r]=t[0].replace(/#! ?/,"").split(" "),o=i.split("/").pop();return"env"===o?r:r?`${o} ${r}`:o}},function(e,t,i){"use strict";e.exports=/^#!(.*)/},function(e,t,i){"use strict";const n="win32"===process.platform;function r(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function o(e,t){return n&&1===e&&!t.file?r(t.original,"spawn"):null}e.exports={hookChildProcess:function(e,t){if(!n)return;const i=e.emit;e.emit=function(n,r){if("exit"===n){const n=o(r,t);if(n)return i.call(e,"error",n)}return i.apply(e,arguments)}},verifyENOENT:o,verifyENOENTSync:function(e,t){return n&&1===e&&!t.file?r(t.original,"spawnSync"):null},notFoundError:r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this._item=e}set next(e){this._next=e}get next(){return this._next}get item(){return this._item}}class r{constructor(){this._length=0}get length(){return this._length}enqueue(e){const t=new n(e);this._tail?this._tail.next=t:this._head=t,this._tail=t,++this._length}dequeue(){if(this._head){const e=this._head;return this._head=this._head.next,this._head||(this._tail=void 0),--this._length,e.item}}}t.Queue=r;t.CommandLimiter=class{constructor(e){this._maxConcurrent=e,this._queue=new r,this._running=new Map,this._inDebugMode=!1}get queueLength(){return this._queue.length}get runningCount(){return this._running.size}set debugMode(e){this._inDebugMode=e}get logPrefix(){return"Command Limiter: R: "+this.runningCount+" Q: "+this.queueLength+" : "}submit(e,t){let i;return new Promise((n,r)=>{const o=()=>{this.completed(t),n()};i={id:t,command:()=>{try{e(o).catch(e=>{this.completed(t),r(e)})}catch(e){this.completed(t),r(e)}},callback:o},this._maxConcurrent>0&&this._running.size>=this._maxConcurrent?(this._inDebugMode&&console.log(this.logPrefix+" ENQUEUE "+i.id),this._queue.enqueue(i)):this.execute(i)})}completed(e){this._inDebugMode&&console.log(this.logPrefix+" COMPLETED "+e),this._running.has(e)&&(this._running.delete(e),this.executeNext())}execute(e){this._inDebugMode&&console.log(this.logPrefix+" EXECUTING "+e.id),this._running.set(e.id,e),setImmediate(()=>e.command(e.callback))}executeNext(){if(this._maxConcurrent<=0||this._running.size<this._maxConcurrent){const e=this._queue.dequeue();e&&this.execute(e)}}}},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=n(i(105)),s=i(4),a=i(33),c=i(9),l=i(7),u=n(i(3));class h{constructor(e){a.PerforceCommands.checkFolderOpened()&&h.registerEvents(e),this._disposable=r.Disposable.from.apply(this,[])}static registerEvents(e){var t;const i=l.configAccessor;if(!h._eventRegistered){null===(t=h._eventsDisposable)||void 0===t||t.dispose();const n=[];i.editOnFileSave&&e.onWillSaveTextDocument(e=>{e.waitUntil(h.onWillSaveFile(e.document,e.reason))},n),i.editOnFileModified&&e.onDidChangeTextDocument(h.onFileModified.bind(this),n),i.addOnFileCreate&&e.onDidCreateFiles(h.onFilesAdded.bind(this),n),i.deleteOnFileDelete&&e.onWillDeleteFiles(h.onFilesDeleted.bind(this),n),h._eventRegistered=!0,h._eventsDisposable=r.Disposable.from.apply(this,n)}}dispose(){this._disposable.dispose()}static disposeEvents(){this._eventRegistered=!1,this._eventsDisposable.dispose()}static onWillSaveFile(e,t){var i;return(null===(i=h._lastSavedFileUri)||void 0===i?void 0:i.fsPath)===e.uri.fsPath&&t!==r.TextDocumentSaveReason.Manual?Promise.resolve(!0):(h._lastSavedFileUri=e.uri,h.tryEditFile(e.uri))}static onFileModified(e){const t=e.document.uri;if("file"!==t.scheme)return;if(h._lastCheckedFileUri&&t.toString()===h._lastCheckedFileUri.toString())return;const i=r.window.activeTextEditor;i&&i.document&&i.document.uri.toString()===t.toString()&&(h._lastCheckedFileUri=t,h.tryEditFile(t))}static tryEditFile(e){return c.PerforceSCMProvider.hasOpenFile(e)&&!c.PerforceSCMProvider.mayHaveConflictForFile(e)?Promise.resolve(!0):a.PerforceCommands.p4edit(e)}static async isDirectory(e){try{return(await r.workspace.fs.stat(e)).type===r.FileType.Directory}catch(e){s.Display.channel.appendLine(e)}return!1}static async deleteFileOrDirectory(e){const t=await h.isDirectory(e)?e.with({path:e.path+"/..."}):e,i=r.Uri.file(u.dirname(e.fsPath));a.PerforceCommands.p4revertAndDelete(t,i)}static shouldExclude(e){const t=Object.keys(r.workspace.getConfiguration("files").exclude);return o.isMatch(e.fsPath,t,{dot:!0})}static onFilesDeleted(e){const t=e.files.filter(e=>!h.shouldExclude(e)).map(e=>h.deleteFileOrDirectory(e));e.waitUntil(Promise.all(t))}static onFilesAdded(e){for(const t of e.files)a.PerforceCommands.p4add(t)}}t.default=h,h._eventRegistered=!1,h._lastCheckedFileUri=void 0,h._lastSavedFileUri=void 0},function(e,t,i){"use strict";const n=i(17),r=i(106),o=i(113),s=i(18),a=e=>"string"==typeof e&&(""===e||"./"===e),c=(e,t,i)=>{t=[].concat(t),e=[].concat(e);let n=new Set,r=new Set,s=new Set,a=0,c=e=>{s.add(e.output),i&&i.onResult&&i.onResult(e)};for(let s=0;s<t.length;s++){let l=o(String(t[s]),{...i,onResult:c},!0),u=l.state.negated||l.state.negatedExtglob;u&&a++;for(let t of e){let e=l(t,!0);(u?!e.isMatch:e.isMatch)&&(u?n.add(e.output):(n.delete(e.output),r.add(e.output)))}}let l=(a===t.length?[...s]:[...r]).filter(e=>!n.has(e));if(i&&0===l.length){if(!0===i.failglob)throw new Error(`No matches found for "${t.join(", ")}"`);if(!0===i.nonull||!0===i.nullglob)return i.unescape?t.map(e=>e.replace(/\\/g,"")):t}return l};c.match=c,c.matcher=(e,t)=>o(e,t),c.any=c.isMatch=(e,t,i)=>o(t,i)(e),c.not=(e,t,i={})=>{t=[].concat(t).map(String);let n=new Set,r=[],o=c(e,t,{...i,onResult:e=>{i.onResult&&i.onResult(e),r.push(e.output)}});for(let e of r)o.includes(e)||n.add(e);return[...n]},c.contains=(e,t,i)=>{if("string"!=typeof e)throw new TypeError(`Expected a string: "${n.inspect(e)}"`);if(Array.isArray(t))return t.some(t=>c.contains(e,t,i));if("string"==typeof t){if(a(e)||a(t))return!1;if(e.includes(t)||e.startsWith("./")&&e.slice(2).includes(t))return!0}return c.isMatch(e,t,{...i,contains:!0})},c.matchKeys=(e,t,i)=>{if(!s.isObject(e))throw new TypeError("Expected the first argument to be an object");let n=c(Object.keys(e),t,i),r={};for(let t of n)r[t]=e[t];return r},c.some=(e,t,i)=>{let n=[].concat(e);for(let e of[].concat(t)){let t=o(String(e),i);if(n.some(e=>t(e)))return!0}return!1},c.every=(e,t,i)=>{let n=[].concat(e);for(let e of[].concat(t)){let t=o(String(e),i);if(!n.every(e=>t(e)))return!1}return!0},c.all=(e,t,i)=>{if("string"!=typeof e)throw new TypeError(`Expected a string: "${n.inspect(e)}"`);return[].concat(t).every(t=>o(t,i)(e))},c.capture=(e,t,i)=>{let n=s.isWindows(i),r=o.makeRe(String(e),{...i,capture:!0}).exec(n?s.toPosixSlashes(t):t);if(r)return r.slice(1).map(e=>void 0===e?"":e)},c.makeRe=(...e)=>o.makeRe(...e),c.scan=(...e)=>o.scan(...e),c.parse=(e,t)=>{let i=[];for(let n of[].concat(e||[]))for(let e of r(String(n),t))i.push(o.parse(e,t));return i},c.braces=(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a string");return t&&!0===t.nobrace||!/\{.*\}/.test(e)?[e]:r(e,t)},c.braceExpand=(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a string");return c.braces(e,{...t,expand:!0})},e.exports=c},function(e,t,i){"use strict";const n=i(31),r=i(107),o=i(110),s=i(111),a=(e,t={})=>{let i=[];if(Array.isArray(e))for(let n of e){let e=a.create(n,t);Array.isArray(e)?i.push(...e):i.push(e)}else i=[].concat(a.create(e,t));return t&&!0===t.expand&&!0===t.nodupes&&(i=[...new Set(i)]),i};a.parse=(e,t={})=>s(e,t),a.stringify=(e,t={})=>n("string"==typeof e?a.parse(e,t):e,t),a.compile=(e,t={})=>("string"==typeof e&&(e=a.parse(e,t)),r(e,t)),a.expand=(e,t={})=>{"string"==typeof e&&(e=a.parse(e,t));let i=o(e,t);return!0===t.noempty&&(i=i.filter(Boolean)),!0===t.nodupes&&(i=[...new Set(i)]),i},a.create=(e,t={})=>""===e||e.length<3?[e]:!0!==t.expand?a.compile(e,t):a.expand(e,t),e.exports=a},function(e,t,i){"use strict";const n=i(50),r=i(32);e.exports=(e,t={})=>{let i=(e,o={})=>{let s=r.isInvalidBrace(o),a=!0===e.invalid&&!0===t.escapeInvalid,c=!0===s||!0===a,l=!0===t.escapeInvalid?"\\":"",u="";if(!0===e.isOpen)return l+e.value;if(!0===e.isClose)return l+e.value;if("open"===e.type)return c?l+e.value:"(";if("close"===e.type)return c?l+e.value:")";if("comma"===e.type)return"comma"===e.prev.type?"":c?e.value:"|";if(e.value)return e.value;if(e.nodes&&e.ranges>0){let i=r.reduce(e.nodes),o=n(...i,{...t,wrap:!1,toRegex:!0});if(0!==o.length)return i.length>1&&o.length>1?`(${o})`:o}if(e.nodes)for(let t of e.nodes)u+=i(t,e);return u};return i(e)}},function(e,t,i){"use strict";
/*!
 * to-regex-range <https://github.com/micromatch/to-regex-range>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */const n=i(109),r=(e,t,i)=>{if(!1===n(e))throw new TypeError("toRegexRange: expected the first argument to be a number");if(void 0===t||e===t)return String(e);if(!1===n(t))throw new TypeError("toRegexRange: expected the second argument to be a number.");let o={relaxZeros:!0,...i};"boolean"==typeof o.strictZeros&&(o.relaxZeros=!1===o.strictZeros);let c=e+":"+t+"="+String(o.relaxZeros)+String(o.shorthand)+String(o.capture)+String(o.wrap);if(r.cache.hasOwnProperty(c))return r.cache[c].result;let l=Math.min(e,t),u=Math.max(e,t);if(1===Math.abs(l-u)){let i=e+"|"+t;return o.capture?`(${i})`:!1===o.wrap?i:`(?:${i})`}let h=f(e)||f(t),d={min:e,max:t,a:l,b:u},p=[],m=[];if(h&&(d.isPadded=h,d.maxLen=String(d.max).length),l<0){m=s(u<0?Math.abs(u):1,Math.abs(l),d,o),l=d.a=0}return u>=0&&(p=s(l,u,d,o)),d.negatives=m,d.positives=p,d.result=function(e,t,i){let n=a(e,t,"-",!1,i)||[],r=a(t,e,"",!1,i)||[],o=a(e,t,"-?",!0,i)||[];return n.concat(o).concat(r).join("|")}(m,p,o),!0===o.capture?d.result=`(${d.result})`:!1!==o.wrap&&p.length+m.length>1&&(d.result=`(?:${d.result})`),r.cache[c]=d,d.result};function o(e,t,i){if(e===t)return{pattern:e,count:[],digits:0};let n=function(e,t){let i=[];for(let n=0;n<e.length;n++)i.push([e[n],t[n]]);return i}(e,t),r=n.length,o="",s=0;for(let e=0;e<r;e++){let[t,r]=n[e];t===r?o+=t:"0"!==t||"9"!==r?o+=p(t,r,i):s++}return s&&(o+=!0===i.shorthand?"\\d":"[0-9]"),{pattern:o,count:[s],digits:r}}function s(e,t,i,n){let r,s=function(e,t){let i=1,n=1,r=u(e,i),o=new Set([t]);for(;e<=r&&r<=t;)o.add(r),i+=1,r=u(e,i);for(r=h(t+1,n)-1;e<r&&r<=t;)o.add(r),n+=1,r=h(t+1,n)-1;return o=[...o],o.sort(c),o}(e,t),a=[],l=e;for(let e=0;e<s.length;e++){let t=s[e],c=o(String(l),String(t),n),u="";i.isPadded||!r||r.pattern!==c.pattern?(i.isPadded&&(u=m(t,i,n)),c.string=u+c.pattern+d(c.count),a.push(c),l=t+1,r=c):(r.count.length>1&&r.count.pop(),r.count.push(c.count[0]),r.string=r.pattern+d(r.count),l=t+1)}return a}function a(e,t,i,n,r){let o=[];for(let r of e){let{string:e}=r;n||l(t,"string",e)||o.push(i+e),n&&l(t,"string",e)&&o.push(i+e)}return o}function c(e,t){return e>t?1:t>e?-1:0}function l(e,t,i){return e.some(e=>e[t]===i)}function u(e,t){return Number(String(e).slice(0,-t)+"9".repeat(t))}function h(e,t){return e-e%Math.pow(10,t)}function d(e){let[t=0,i=""]=e;return i||t>1?`{${t+(i?","+i:"")}}`:""}function p(e,t,i){return`[${e}${t-e==1?"":"-"}${t}]`}function f(e){return/^-?(0+)\d/.test(e)}function m(e,t,i){if(!t.isPadded)return e;let n=Math.abs(t.maxLen-String(e).length),r=!1!==i.relaxZeros;switch(n){case 0:return"";case 1:return r?"0?":"0";case 2:return r?"0{0,2}":"00";default:return r?`0{0,${n}}`:`0{${n}}`}}r.cache={},r.clearCache=()=>r.cache={},e.exports=r},function(e,t,i){"use strict";
/*!
 * is-number <https://github.com/jonschlinkert/is-number>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */e.exports=function(e){return"number"==typeof e?e-e==0:"string"==typeof e&&""!==e.trim()&&(Number.isFinite?Number.isFinite(+e):isFinite(+e))}},function(e,t,i){"use strict";const n=i(50),r=i(31),o=i(32),s=(e="",t="",i=!1)=>{let n=[];if(e=[].concat(e),!(t=[].concat(t)).length)return e;if(!e.length)return i?o.flatten(t).map(e=>`{${e}}`):t;for(let r of e)if(Array.isArray(r))for(let e of r)n.push(s(e,t,i));else for(let e of t)!0===i&&"string"==typeof e&&(e=`{${e}}`),n.push(Array.isArray(e)?s(r,e,i):r+e);return o.flatten(n)};e.exports=(e,t={})=>{let i=void 0===t.rangeLimit?1e3:t.rangeLimit,a=(e,c={})=>{e.queue=[];let l=c,u=c.queue;for(;"brace"!==l.type&&"root"!==l.type&&l.parent;)l=l.parent,u=l.queue;if(e.invalid||e.dollar)return void u.push(s(u.pop(),r(e,t)));if("brace"===e.type&&!0!==e.invalid&&2===e.nodes.length)return void u.push(s(u.pop(),["{}"]));if(e.nodes&&e.ranges>0){let a=o.reduce(e.nodes);if(o.exceedsLimit(...a,t.step,i))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let c=n(...a,t);return 0===c.length&&(c=r(e,t)),u.push(s(u.pop(),c)),void(e.nodes=[])}let h=o.encloseBrace(e),d=e.queue,p=e;for(;"brace"!==p.type&&"root"!==p.type&&p.parent;)p=p.parent,d=p.queue;for(let t=0;t<e.nodes.length;t++){let i=e.nodes[t];"comma"!==i.type||"brace"!==e.type?"close"!==i.type?i.value&&"open"!==i.type?d.push(s(d.pop(),i.value)):i.nodes&&a(i,e):u.push(s(u.pop(),d,h)):(1===t&&d.push(""),d.push(""))}return d};return o.flatten(a(e))}},function(e,t,i){"use strict";const n=i(31),{MAX_LENGTH:r,CHAR_BACKSLASH:o,CHAR_BACKTICK:s,CHAR_COMMA:a,CHAR_DOT:c,CHAR_LEFT_PARENTHESES:l,CHAR_RIGHT_PARENTHESES:u,CHAR_LEFT_CURLY_BRACE:h,CHAR_RIGHT_CURLY_BRACE:d,CHAR_LEFT_SQUARE_BRACKET:p,CHAR_RIGHT_SQUARE_BRACKET:f,CHAR_DOUBLE_QUOTE:m,CHAR_SINGLE_QUOTE:g,CHAR_NO_BREAK_SPACE:v,CHAR_ZERO_WIDTH_NOBREAK_SPACE:w}=i(112);e.exports=(e,t={})=>{if("string"!=typeof e)throw new TypeError("Expected a string");let i=t||{},y="number"==typeof i.maxLength?Math.min(r,i.maxLength):r;if(e.length>y)throw new SyntaxError(`Input length (${e.length}), exceeds max characters (${y})`);let _,C={type:"root",input:e,nodes:[]},S=[C],b=C,E=C,R=0,P=e.length,D=0,k=0;const x=()=>e[D++],O=e=>{if("text"===e.type&&"dot"===E.type&&(E.type="text"),!E||"text"!==E.type||"text"!==e.type)return b.nodes.push(e),e.parent=b,e.prev=E,E=e,e;E.value+=e.value};for(O({type:"bos"});D<P;)if(b=S[S.length-1],_=x(),_!==w&&_!==v)if(_!==o)if(_!==f)if(_!==p)if(_!==l)if(_!==u)if(_!==m&&_!==g&&_!==s)if(_!==h)if(_!==d)if(_===a&&k>0){if(b.ranges>0){b.ranges=0;let e=b.nodes.shift();b.nodes=[e,{type:"text",value:n(b)}]}O({type:"comma",value:_}),b.commas++}else if(_===c&&k>0&&0===b.commas){let e=b.nodes;if(0===k||0===e.length){O({type:"text",value:_});continue}if("dot"===E.type){if(b.range=[],E.value+=_,E.type="range",3!==b.nodes.length&&5!==b.nodes.length){b.invalid=!0,b.ranges=0,E.type="text";continue}b.ranges++,b.args=[];continue}if("range"===E.type){e.pop();let t=e[e.length-1];t.value+=E.value+_,E=t,b.ranges--;continue}O({type:"dot",value:_})}else O({type:"text",value:_});else{if("brace"!==b.type){O({type:"text",value:_});continue}let e="close";b=S.pop(),b.close=!0,O({type:e,value:_}),k--,b=S[S.length-1]}else{k++;let e=E.value&&"$"===E.value.slice(-1)||!0===b.dollar;b=O({type:"brace",open:!0,close:!1,dollar:e,depth:k,commas:0,ranges:0,nodes:[]}),S.push(b),O({type:"open",value:_})}else{let e,i=_;for(!0!==t.keepQuotes&&(_="");D<P&&(e=x());)if(e!==o){if(e===i){!0===t.keepQuotes&&(_+=e);break}_+=e}else _+=e+x();O({type:"text",value:_})}else{if("paren"!==b.type){O({type:"text",value:_});continue}b=S.pop(),O({type:"text",value:_}),b=S[S.length-1]}else b=O({type:"paren",nodes:[]}),S.push(b),O({type:"text",value:_});else{R++;let e;for(;D<P&&(e=x());)if(_+=e,e!==p)if(e!==o){if(e===f&&(R--,0===R))break}else _+=x();else R++;O({type:"text",value:_})}else O({type:"text",value:"\\"+_});else O({type:"text",value:(t.keepEscaping?_:"")+x()});do{if(b=S.pop(),"root"!==b.type){b.nodes.forEach(e=>{e.nodes||("open"===e.type&&(e.isOpen=!0),"close"===e.type&&(e.isClose=!0),e.nodes||(e.type="text"),e.invalid=!0)});let e=S[S.length-1],t=e.nodes.indexOf(b);e.nodes.splice(t,1,...b.nodes)}}while(S.length>0);return O({type:"eos"}),C}},function(e,t,i){"use strict";e.exports={MAX_LENGTH:65536,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:"\n",CHAR_NO_BREAK_SPACE:" ",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"\t",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\ufeff"}},function(e,t,i){"use strict";e.exports=i(114)},function(e,t,i){"use strict";const n=i(3),r=i(115),o=i(116),s=i(18),a=i(19),c=(e,t,i=!1)=>{if(Array.isArray(e)){const n=e.map(e=>c(e,t,i));return e=>{for(const t of n){const i=t(e);if(i)return i}return!1}}const n=(r=e)&&"object"==typeof r&&!Array.isArray(r)&&e.tokens&&e.input;var r;if(""===e||"string"!=typeof e&&!n)throw new TypeError("Expected pattern to be a non-empty string");const o=t||{},a=s.isWindows(t),l=n?c.compileRe(e,t):c.makeRe(e,t,!1,!0),u=l.state;delete l.state;let h=()=>!1;if(o.ignore){const e={...t,ignore:null,onMatch:null,onResult:null};h=c(o.ignore,e,i)}const d=(i,n=!1)=>{const{isMatch:r,match:s,output:d}=c.test(i,l,t,{glob:e,posix:a}),p={glob:e,state:u,regex:l,posix:a,input:i,output:d,match:s,isMatch:r};return"function"==typeof o.onResult&&o.onResult(p),!1===r?(p.isMatch=!1,!!n&&p):h(i)?("function"==typeof o.onIgnore&&o.onIgnore(p),p.isMatch=!1,!!n&&p):("function"==typeof o.onMatch&&o.onMatch(p),!n||p)};return i&&(d.state=u),d};c.test=(e,t,i,{glob:n,posix:r}={})=>{if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};const o=i||{},a=o.format||(r?s.toPosixSlashes:null);let l=e===n,u=l&&a?a(e):e;return!1===l&&(u=a?a(e):e,l=u===n),!1!==l&&!0!==o.capture||(l=!0===o.matchBase||!0===o.basename?c.matchBase(e,t,i,r):t.exec(u)),{isMatch:Boolean(l),match:l,output:u}},c.matchBase=(e,t,i,r=s.isWindows(i))=>(t instanceof RegExp?t:c.makeRe(t,i)).test(n.basename(e)),c.isMatch=(e,t,i)=>c(t,i)(e),c.parse=(e,t)=>Array.isArray(e)?e.map(e=>c.parse(e,t)):o(e,{...t,fastpaths:!1}),c.scan=(e,t)=>r(e,t),c.compileRe=(e,t,i=!1,n=!1)=>{if(!0===i)return e.output;const r=t||{},o=r.contains?"":"^",s=r.contains?"":"$";let a=`${o}(?:${e.output})${s}`;e&&!0===e.negated&&(a=`^(?!${a}).*$`);const l=c.toRegex(a,t);return!0===n&&(l.state=e),l},c.makeRe=(e,t,i=!1,n=!1)=>{if(!e||"string"!=typeof e)throw new TypeError("Expected a non-empty string");const r=t||{};let s,a={negated:!1,fastpaths:!0},l="";return e.startsWith("./")&&(e=e.slice(2),l=a.prefix="./"),!1===r.fastpaths||"."!==e[0]&&"*"!==e[0]||(s=o.fastpaths(e,t)),void 0===s?(a=o(e,t),a.prefix=l+(a.prefix||"")):a.output=s,c.compileRe(a,t,i,n)},c.toRegex=(e,t)=>{try{const i=t||{};return new RegExp(e,i.flags||(i.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},c.constants=a,e.exports=c},function(e,t,i){"use strict";const n=i(18),{CHAR_ASTERISK:r,CHAR_AT:o,CHAR_BACKWARD_SLASH:s,CHAR_COMMA:a,CHAR_DOT:c,CHAR_EXCLAMATION_MARK:l,CHAR_FORWARD_SLASH:u,CHAR_LEFT_CURLY_BRACE:h,CHAR_LEFT_PARENTHESES:d,CHAR_LEFT_SQUARE_BRACKET:p,CHAR_PLUS:f,CHAR_QUESTION_MARK:m,CHAR_RIGHT_CURLY_BRACE:g,CHAR_RIGHT_PARENTHESES:v,CHAR_RIGHT_SQUARE_BRACKET:w}=i(19),y=e=>e===u||e===s,_=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};e.exports=(e,t)=>{const i=t||{},C=e.length-1,S=!0===i.parts||!0===i.scanToEnd,b=[],E=[],R=[];let P,D,k=e,x=-1,O=0,A=0,F=!1,T=!1,I=!1,M=!1,N=!1,U=!1,L=!1,H=!1,W=!1,$=0,j={value:"",depth:0,isGlob:!1};const B=()=>x>=C,G=()=>(P=D,k.charCodeAt(++x));for(;x<C;){let e;if(D=G(),D!==s){if(!0===U||D===h){for($++;!0!==B()&&(D=G());)if(D!==s)if(D!==h){if(!0!==U&&D===c&&(D=G())===c){if(F=j.isBrace=!0,I=j.isGlob=!0,W=!0,!0===S)continue;break}if(!0!==U&&D===a){if(F=j.isBrace=!0,I=j.isGlob=!0,W=!0,!0===S)continue;break}if(D===g&&($--,0===$)){U=!1,F=j.isBrace=!0,W=!0;break}}else $++;else L=j.backslashes=!0,G();if(!0===S)continue;break}if(D!==u){if(!0!==i.noext){if(!0===(D===f||D===o||D===r||D===m||D===l)&&k.charCodeAt(x+1)===d){if(I=j.isGlob=!0,M=j.isExtglob=!0,W=!0,!0===S){for(;!0!==B()&&(D=G());)if(D!==s){if(D===v){I=j.isGlob=!0,W=!0;break}}else L=j.backslashes=!0,D=G();continue}break}}if(D===r){if(P===r&&(N=j.isGlobstar=!0),I=j.isGlob=!0,W=!0,!0===S)continue;break}if(D===m){if(I=j.isGlob=!0,W=!0,!0===S)continue;break}if(D===p)for(;!0!==B()&&(e=G());)if(e!==s){if(e===w){if(T=j.isBracket=!0,I=j.isGlob=!0,W=!0,!0===S)continue;break}}else L=j.backslashes=!0,G();if(!0===i.nonegate||D!==l||x!==O){if(!0!==i.noparen&&D===d)for(;!0!==B()&&(D=G());)if(D!==s){if(D===v){if(I=j.isGlob=!0,W=!0,!0===S)continue;break}}else L=j.backslashes=!0,D=G();if(!0===I){if(W=!0,!0===S)continue;break}}else H=j.negated=!0,O++}else{if(b.push(x),E.push(j),j={value:"",depth:0,isGlob:!1},!0===W)continue;if(P===c&&x===O+1){O+=2;continue}A=x+1}}else L=j.backslashes=!0,D=G(),D===h&&(U=!0)}!0===i.noext&&(M=!1,I=!1);let q=k,Q="",V="";O>0&&(Q=k.slice(0,O),k=k.slice(O),A-=O),q&&!0===I&&A>0?(q=k.slice(0,A),V=k.slice(A)):!0===I?(q="",V=k):q=k,q&&""!==q&&"/"!==q&&q!==k&&y(q.charCodeAt(q.length-1))&&(q=q.slice(0,-1)),!0===i.unescape&&(V&&(V=n.removeBackslashes(V)),q&&!0===L&&(q=n.removeBackslashes(q)));const K={prefix:Q,input:e,start:O,base:q,glob:V,isBrace:F,isBracket:T,isGlob:I,isExtglob:M,isGlobstar:N,negated:H};if(!0===i.tokens&&(K.maxDepth=0,y(D)||E.push(j),K.tokens=E),!0===i.parts||!0===i.tokens){let t;for(let n=0;n<b.length;n++){const r=t?t+1:O,o=b[n],s=e.slice(r,o);i.tokens&&(0===n&&0!==O?(E[n].isPrefix=!0,E[n].value=Q):E[n].value=s,_(E[n]),K.maxDepth+=E[n].depth),0===n&&""===s||R.push(s),t=o}if(t&&t+1<e.length){const n=e.slice(t+1);R.push(n),i.tokens&&(E[E.length-1].value=n,_(E[E.length-1]),K.maxDepth+=E[E.length-1].depth)}K.slashes=b,K.parts=R}return K}},function(e,t,i){"use strict";const n=i(19),r=i(18),{MAX_LENGTH:o,POSIX_REGEX_SOURCE:s,REGEX_NON_SPECIAL_CHARS:a,REGEX_SPECIAL_CHARS_BACKREF:c,REPLACEMENTS:l}=n,u=(e,t)=>{if("function"==typeof t.expandRange)return t.expandRange(...e,t);e.sort();const i=`[${e.join("-")}]`;try{new RegExp(i)}catch(t){return e.map(e=>r.escapeRegex(e)).join("..")}return i},h=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,d=(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a string");e=l[e]||e;const i={...t},d="number"==typeof i.maxLength?Math.min(o,i.maxLength):o;let p=e.length;if(p>d)throw new SyntaxError(`Input length: ${p}, exceeds maximum allowed length: ${d}`);const f={type:"bos",value:"",output:i.prepend||""},m=[f],g=i.capture?"":"?:",v=r.isWindows(t),w=n.globChars(v),y=n.extglobChars(w),{DOT_LITERAL:_,PLUS_LITERAL:C,SLASH_LITERAL:S,ONE_CHAR:b,DOTS_SLASH:E,NO_DOT:R,NO_DOT_SLASH:P,NO_DOTS_SLASH:D,QMARK:k,QMARK_NO_DOT:x,STAR:O,START_ANCHOR:A}=w,F=e=>`(${g}(?:(?!${A}${e.dot?E:_}).)*?)`,T=i.dot?"":R,I=i.dot?k:x;let M=!0===i.bash?F(i):O;i.capture&&(M=`(${M})`),"boolean"==typeof i.noext&&(i.noextglob=i.noext);const N={input:e,index:-1,start:0,dot:!0===i.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:m};e=r.removePrefix(e,N),p=e.length;const U=[],L=[],H=[];let W,$=f;const j=()=>N.index===p-1,B=N.peek=(t=1)=>e[N.index+t],G=N.advance=()=>e[++N.index],q=()=>e.slice(N.index+1),Q=(e="",t=0)=>{N.consumed+=e,N.index+=t},V=e=>{N.output+=null!=e.output?e.output:e.value,Q(e.value)},K=()=>{let e=1;for(;"!"===B()&&("("!==B(2)||"?"===B(3));)G(),N.start++,e++;return e%2!=0&&(N.negated=!0,N.start++,!0)},J=e=>{N[e]++,H.push(e)},Y=e=>{N[e]--,H.pop()},X=e=>{if("globstar"===$.type){const t=N.braces>0&&("comma"===e.type||"brace"===e.type),i=!0===e.extglob||U.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||i||(N.output=N.output.slice(0,-$.output.length),$.type="star",$.value="*",$.output=M,N.output+=$.output)}if(U.length&&"paren"!==e.type&&!y[e.value]&&(U[U.length-1].inner+=e.value),(e.value||e.output)&&V(e),$&&"text"===$.type&&"text"===e.type)return $.value+=e.value,void($.output=($.output||"")+e.value);e.prev=$,m.push(e),$=e},z=(e,t)=>{const n={...y[t],conditions:1,inner:""};n.prev=$,n.parens=N.parens,n.output=N.output;const r=(i.capture?"(":"")+n.open;J("parens"),X({type:e,value:t,output:N.output?"":b}),X({type:"paren",extglob:!0,value:G(),output:r}),U.push(n)},Z=e=>{let t=e.close+(i.capture?")":"");if("negate"===e.type){let n=M;e.inner&&e.inner.length>1&&e.inner.includes("/")&&(n=F(i)),(n!==M||j()||/^\)+$/.test(q()))&&(t=e.close=")$))"+n),"bos"===e.prev.type&&j()&&(N.negatedExtglob=!0)}X({type:"paren",extglob:!0,value:W,output:t}),Y("parens")};if(!1!==i.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(e)){let n=!1,o=e.replace(c,(e,t,i,r,o,s)=>"\\"===r?(n=!0,e):"?"===r?t?t+r+(o?k.repeat(o.length):""):0===s?I+(o?k.repeat(o.length):""):k.repeat(i.length):"."===r?_.repeat(i.length):"*"===r?t?t+r+(o?M:""):M:t?e:"\\"+e);return!0===n&&(o=!0===i.unescape?o.replace(/\\/g,""):o.replace(/\\+/g,e=>e.length%2==0?"\\\\":e?"\\":"")),o===e&&!0===i.contains?(N.output=e,N):(N.output=r.wrapOutput(o,N,t),N)}for(;!j();){if(W=G(),"\0"===W)continue;if("\\"===W){const e=B();if("/"===e&&!0!==i.bash)continue;if("."===e||";"===e)continue;if(!e){W+="\\",X({type:"text",value:W});continue}const t=/^\\+/.exec(q());let n=0;if(t&&t[0].length>2&&(n=t[0].length,N.index+=n,n%2!=0&&(W+="\\")),!0===i.unescape?W=G()||"":W+=G()||"",0===N.brackets){X({type:"text",value:W});continue}}if(N.brackets>0&&("]"!==W||"["===$.value||"[^"===$.value)){if(!1!==i.posix&&":"===W){const e=$.value.slice(1);if(e.includes("[")&&($.posix=!0,e.includes(":"))){const e=$.value.lastIndexOf("["),t=$.value.slice(0,e),i=$.value.slice(e+2),n=s[i];if(n){$.value=t+n,N.backtrack=!0,G(),f.output||1!==m.indexOf($)||(f.output=b);continue}}}("["===W&&":"!==B()||"-"===W&&"]"===B())&&(W="\\"+W),"]"!==W||"["!==$.value&&"[^"!==$.value||(W="\\"+W),!0===i.posix&&"!"===W&&"["===$.value&&(W="^"),$.value+=W,V({value:W});continue}if(1===N.quotes&&'"'!==W){W=r.escapeRegex(W),$.value+=W,V({value:W});continue}if('"'===W){N.quotes=1===N.quotes?0:1,!0===i.keepQuotes&&X({type:"text",value:W});continue}if("("===W){J("parens"),X({type:"paren",value:W});continue}if(")"===W){if(0===N.parens&&!0===i.strictBrackets)throw new SyntaxError(h("opening","("));const e=U[U.length-1];if(e&&N.parens===e.parens+1){Z(U.pop());continue}X({type:"paren",value:W,output:N.parens?")":"\\)"}),Y("parens");continue}if("["===W){if(!0!==i.nobracket&&q().includes("]"))J("brackets");else{if(!0!==i.nobracket&&!0===i.strictBrackets)throw new SyntaxError(h("closing","]"));W="\\"+W}X({type:"bracket",value:W});continue}if("]"===W){if(!0===i.nobracket||$&&"bracket"===$.type&&1===$.value.length){X({type:"text",value:W,output:"\\"+W});continue}if(0===N.brackets){if(!0===i.strictBrackets)throw new SyntaxError(h("opening","["));X({type:"text",value:W,output:"\\"+W});continue}Y("brackets");const e=$.value.slice(1);if(!0===$.posix||"^"!==e[0]||e.includes("/")||(W="/"+W),$.value+=W,V({value:W}),!1===i.literalBrackets||r.hasRegexChars(e))continue;const t=r.escapeRegex($.value);if(N.output=N.output.slice(0,-$.value.length),!0===i.literalBrackets){N.output+=t,$.value=t;continue}$.value=`(${g}${t}|${$.value})`,N.output+=$.value;continue}if("{"===W&&!0!==i.nobrace){J("braces");const e={type:"brace",value:W,output:"(",outputIndex:N.output.length,tokensIndex:N.tokens.length};L.push(e),X(e);continue}if("}"===W){const e=L[L.length-1];if(!0===i.nobrace||!e){X({type:"text",value:W,output:W});continue}let t=")";if(!0===e.dots){const e=m.slice(),n=[];for(let t=e.length-1;t>=0&&(m.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&n.unshift(e[t].value);t=u(n,i),N.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){const i=N.output.slice(0,e.outputIndex),n=N.tokens.slice(e.tokensIndex);e.value=e.output="\\{",W=t="\\}",N.output=i;for(const e of n)N.output+=e.output||e.value}X({type:"brace",value:W,output:t}),Y("braces"),L.pop();continue}if("|"===W){U.length>0&&U[U.length-1].conditions++,X({type:"text",value:W});continue}if(","===W){let e=W;const t=L[L.length-1];t&&"braces"===H[H.length-1]&&(t.comma=!0,e="|"),X({type:"comma",value:W,output:e});continue}if("/"===W){if("dot"===$.type&&N.index===N.start+1){N.start=N.index+1,N.consumed="",N.output="",m.pop(),$=f;continue}X({type:"slash",value:W,output:S});continue}if("."===W){if(N.braces>0&&"dot"===$.type){"."===$.value&&($.output=_);const e=L[L.length-1];$.type="dots",$.output+=W,$.value+=W,e.dots=!0;continue}if(N.braces+N.parens===0&&"bos"!==$.type&&"slash"!==$.type){X({type:"text",value:W,output:_});continue}X({type:"dot",value:W,output:_});continue}if("?"===W){if(!($&&"("===$.value)&&!0!==i.noextglob&&"("===B()&&"?"!==B(2)){z("qmark",W);continue}if($&&"paren"===$.type){const e=B();let t=W;if("<"===e&&!r.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");("("===$.value&&!/[!=<:]/.test(e)||"<"===e&&!/<([!=]|\w+>)/.test(q()))&&(t="\\"+W),X({type:"text",value:W,output:t});continue}if(!0!==i.dot&&("slash"===$.type||"bos"===$.type)){X({type:"qmark",value:W,output:x});continue}X({type:"qmark",value:W,output:k});continue}if("!"===W){if(!0!==i.noextglob&&"("===B()&&("?"!==B(2)||!/[!=<:]/.test(B(3)))){z("negate",W);continue}if(!0!==i.nonegate&&0===N.index){K();continue}}if("+"===W){if(!0!==i.noextglob&&"("===B()&&"?"!==B(2)){z("plus",W);continue}if($&&"("===$.value||!1===i.regex){X({type:"plus",value:W,output:C});continue}if($&&("bracket"===$.type||"paren"===$.type||"brace"===$.type)||N.parens>0){X({type:"plus",value:W});continue}X({type:"plus",value:C});continue}if("@"===W){if(!0!==i.noextglob&&"("===B()&&"?"!==B(2)){X({type:"at",extglob:!0,value:W,output:""});continue}X({type:"text",value:W});continue}if("*"!==W){"$"!==W&&"^"!==W||(W="\\"+W);const e=a.exec(q());e&&(W+=e[0],N.index+=e[0].length),X({type:"text",value:W});continue}if($&&("globstar"===$.type||!0===$.star)){$.type="star",$.star=!0,$.value+=W,$.output=M,N.backtrack=!0,N.globstar=!0,Q(W);continue}let t=q();if(!0!==i.noextglob&&/^\([^?]/.test(t)){z("star",W);continue}if("star"===$.type){if(!0===i.noglobstar){Q(W);continue}const n=$.prev,r=n.prev,o="slash"===n.type||"bos"===n.type,s=r&&("star"===r.type||"globstar"===r.type);if(!0===i.bash&&(!o||t[0]&&"/"!==t[0])){X({type:"star",value:W,output:""});continue}const a=N.braces>0&&("comma"===n.type||"brace"===n.type),c=U.length&&("pipe"===n.type||"paren"===n.type);if(!o&&"paren"!==n.type&&!a&&!c){X({type:"star",value:W,output:""});continue}for(;"/**"===t.slice(0,3);){const i=e[N.index+4];if(i&&"/"!==i)break;t=t.slice(3),Q("/**",3)}if("bos"===n.type&&j()){$.type="globstar",$.value+=W,$.output=F(i),N.output=$.output,N.globstar=!0,Q(W);continue}if("slash"===n.type&&"bos"!==n.prev.type&&!s&&j()){N.output=N.output.slice(0,-(n.output+$.output).length),n.output="(?:"+n.output,$.type="globstar",$.output=F(i)+(i.strictSlashes?")":"|$)"),$.value+=W,N.globstar=!0,N.output+=n.output+$.output,Q(W);continue}if("slash"===n.type&&"bos"!==n.prev.type&&"/"===t[0]){const e=void 0!==t[1]?"|$":"";N.output=N.output.slice(0,-(n.output+$.output).length),n.output="(?:"+n.output,$.type="globstar",$.output=`${F(i)}${S}|${S}${e})`,$.value+=W,N.output+=n.output+$.output,N.globstar=!0,Q(W+G()),X({type:"slash",value:"/",output:""});continue}if("bos"===n.type&&"/"===t[0]){$.type="globstar",$.value+=W,$.output=`(?:^|${S}|${F(i)}${S})`,N.output=$.output,N.globstar=!0,Q(W+G()),X({type:"slash",value:"/",output:""});continue}N.output=N.output.slice(0,-$.output.length),$.type="globstar",$.output=F(i),$.value+=W,N.output+=$.output,N.globstar=!0,Q(W);continue}const n={type:"star",value:W,output:M};!0!==i.bash?!$||"bracket"!==$.type&&"paren"!==$.type||!0!==i.regex?(N.index!==N.start&&"slash"!==$.type&&"dot"!==$.type||("dot"===$.type?(N.output+=P,$.output+=P):!0===i.dot?(N.output+=D,$.output+=D):(N.output+=T,$.output+=T),"*"!==B()&&(N.output+=b,$.output+=b)),X(n)):(n.output=W,X(n)):(n.output=".*?","bos"!==$.type&&"slash"!==$.type||(n.output=T+n.output),X(n))}for(;N.brackets>0;){if(!0===i.strictBrackets)throw new SyntaxError(h("closing","]"));N.output=r.escapeLast(N.output,"["),Y("brackets")}for(;N.parens>0;){if(!0===i.strictBrackets)throw new SyntaxError(h("closing",")"));N.output=r.escapeLast(N.output,"("),Y("parens")}for(;N.braces>0;){if(!0===i.strictBrackets)throw new SyntaxError(h("closing","}"));N.output=r.escapeLast(N.output,"{"),Y("braces")}if(!0===i.strictSlashes||"star"!==$.type&&"bracket"!==$.type||X({type:"maybe_slash",value:"",output:S+"?"}),!0===N.backtrack){N.output="";for(const e of N.tokens)N.output+=null!=e.output?e.output:e.value,e.suffix&&(N.output+=e.suffix)}return N};d.fastpaths=(e,t)=>{const i={...t},s="number"==typeof i.maxLength?Math.min(o,i.maxLength):o,a=e.length;if(a>s)throw new SyntaxError(`Input length: ${a}, exceeds maximum allowed length: ${s}`);e=l[e]||e;const c=r.isWindows(t),{DOT_LITERAL:u,SLASH_LITERAL:h,ONE_CHAR:d,DOTS_SLASH:p,NO_DOT:f,NO_DOTS:m,NO_DOTS_SLASH:g,STAR:v,START_ANCHOR:w}=n.globChars(c),y=i.dot?m:f,_=i.dot?g:f,C=i.capture?"":"?:";let S=!0===i.bash?".*?":v;i.capture&&(S=`(${S})`);const b=e=>!0===e.noglobstar?S:`(${C}(?:(?!${w}${e.dot?p:u}).)*?)`,E=e=>{switch(e){case"*":return`${y}${d}${S}`;case".*":return`${u}${d}${S}`;case"*.*":return`${y}${S}${u}${d}${S}`;case"*/*":return`${y}${S}${h}${d}${_}${S}`;case"**":return y+b(i);case"**/*":return`(?:${y}${b(i)}${h})?${_}${d}${S}`;case"**/*.*":return`(?:${y}${b(i)}${h})?${_}${S}${u}${d}${S}`;case"**/.*":return`(?:${y}${b(i)}${h})?${u}${d}${S}`;default:{const t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;const i=E(t[1]);if(!i)return;return i+u+t[2]}}},R=r.removePrefix(e,{negated:!1,prefix:""});let P=E(R);return P&&!0!==i.strictSlashes&&(P+=h+"?"),P},e.exports=d},function(e,t,i){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=n(i(0)),s=n(i(2));function a(e){return o.commands.registerCommand("perforce.currentFile."+e,()=>{return null!==(t=c[e])&&void 0!==t?t:"";var t})}t.initialize=function(e){e.push(r.Display.onActiveFileStatusKnown(u)),e.push(r.Display.onActiveFileStatusCleared(h)),e.push(...Object.keys({status:"",depotPath:"",revision:"",changelist:"",operation:"",filetype:"",message:"",hasRevision:!1,resourceRevision:"",isRightDiffOnRev2:!1}).map(a))};let c={status:"",depotPath:"",revision:"",changelist:"",operation:"",filetype:"",message:"",hasRevision:!1,resourceRevision:"",isRightDiffOnRev2:!1};function l(e){const t=function(e){if(!e)return-1;const t=parseInt(s.getRevOrAtLabel(e));return isNaN(t)?-1:t}(e);return{hasRevision:t>0,resourceRevision:t.toString(),isRightDiffOnRev2:2===t&&!!(null==e?void 0:e.query.includes("leftUri="))}}function u(e){var t,i,n,r,s,a,u,h,d,p,f,m;const g=l(e.file);c={status:e.status.toString(),depotPath:null!==(i=null===(t=e.details)||void 0===t?void 0:t.depotPath)&&void 0!==i?i:"",revision:null!==(r=null===(n=e.details)||void 0===n?void 0:n.revision)&&void 0!==r?r:"",changelist:null!==(a=null===(s=e.details)||void 0===s?void 0:s.chnum)&&void 0!==a?a:"",operation:null!==(h=null===(u=e.details)||void 0===u?void 0:u.operation)&&void 0!==h?h:"",filetype:null!==(p=null===(d=e.details)||void 0===d?void 0:d.filetype)&&void 0!==p?p:"",message:null!==(m=null===(f=e.details)||void 0===f?void 0:f.message)&&void 0!==m?m:"",...g},Object.entries(c).forEach(e=>{o.commands.executeCommand("setContext","perforce.currentFile."+e[0],e[1])})}function h(e){c={status:"",depotPath:"",revision:"",changelist:"",operation:"",filetype:"",message:"",hasRevision:!1,resourceRevision:"",isRightDiffOnRev2:!1};const t=l(e),i={...c,...t};Object.entries(i).forEach(e=>{o.commands.executeCommand("setContext","perforce.currentFile."+e[0],e[1])})}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return B})),i.d(t,"intlDateTimeFormatSupported",(function(){return A})),i.d(t,"intlDateTimeFormatSupportedLocale",(function(){return O}));var n="en",r={};function o(){return n}function s(e){return r[e]}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.localeMatcher||"lookup";switch(i){case"lookup":case"best fit":return c(e);default:throw new RangeError('Invalid "localeMatcher" option: '.concat(i))}}function c(e){if(s(e))return e;for(var t=e.split("-");e.length>1;)if(t.pop(),s(e=t.join("-")))return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var d=["second","minute","hour","day","week","month","quarter","year"],p=["auto","always"],f=["long","short","narrow"],m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,e),h(this,"numeric","always"),h(this,"style","long"),h(this,"localeMatcher","lookup");var n=i.numeric,r=i.style,s=i.localeMatcher;if(n){if(p.indexOf(n)<0)throw new RangeError('Invalid "numeric" option: '.concat(n));this.numeric=n}if(r){if(f.indexOf(r)<0)throw new RangeError('Invalid "style" option: '.concat(r));this.style=r}if(s&&(this.localeMatcher=s),"string"==typeof t&&(t=[t]),t.push(o()),this.locale=e.supportedLocalesOf(t,{localeMatcher:this.localeMatcher})[0],!this.locale)throw new TypeError("No supported locale was found");this.locale=a(this.locale,{localeMatcher:this.localeMatcher}),"undefined"!=typeof Intl&&Intl.NumberFormat&&(this.numberFormat=new Intl.NumberFormat(this.locale))}var t,i,n;return t=e,(i=[{key:"format",value:function(e,t){return this.getRule(e,t).replace("{0}",this.formatNumber(Math.abs(e)))}},{key:"formatToParts",value:function(e,t){var i=this.getRule(e,t),n=i.indexOf("{0}");if(n<0)return[{type:"literal",value:i}];var r=[];return n>0&&r.push({type:"literal",value:i.slice(0,n)}),r.push({unit:t,type:"integer",value:this.formatNumber(Math.abs(e))}),n+"{0}".length<i.length-1&&r.push({type:"literal",value:i.slice(n+"{0}".length)}),r}},{key:"getRule",value:function(e,t){if(d.indexOf(t)<0)throw new RangeError("Unknown time unit: ".concat(t,"."));var i=s(this.locale)[this.style][t];if("auto"===this.numeric)if(-2===e||-1===e){var n=i["previous".concat(-1===e?"":"-"+Math.abs(e))];if(n)return n}else if(1===e||2===e){var r=i["next".concat(1===e?"":"-"+Math.abs(e))];if(r)return r}else if(0===e&&i.current)return i.current;var o=i[e<=0?"past":"future"];if("string"==typeof o)return o;var a=s(this.locale).quantify,c=a&&a(Math.abs(e));return o[c=c||"other"]||o.other}},{key:"formatNumber",value:function(e){return this.numberFormat?this.numberFormat.format(e):String(e)}},{key:"resolvedOptions",value:function(){return{locale:this.locale,style:this.style,numeric:this.numeric}}}])&&u(t.prototype,i),n&&u(t,n),e}();function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}m.supportedLocalesOf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.filter((function(e){return a(e,t)}))},m.addLocale=function(e){if(!e)throw new Error("No locale data passed");r[e.locale]=e},m.setDefaultLocale=function(e){n=e},m.getDefaultLocale=o;var w=function(){function e(){var t,i,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(i="cache")in(t=this)?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n}var t,i,n;return t=e,(i=[{key:"get",value:function(){for(var e=this.cache,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=0;r<i.length;r++){var o=i[r];if("object"!==g(e))return;e=e[o]}return e}},{key:"put",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var n=t.pop(),r=t.pop(),o=this.cache,s=0;s<t.length;s++){var a=t[s];"object"!==g(o[a])&&(o[a]={}),o=o[a]}return o[r]=n}}])&&v(t.prototype,i),n&&v(t,n),e}(),y=86400;function _(e,t){var i=e,n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var o;if(n){if(r>=i.length)break;o=i[r++]}else{if((r=i.next()).done)break;o=r.value}var s=o;if(s.unit===t)return s}}function C(e){return e instanceof Date?e:new Date(e)}var S=[{factor:1,unit:"now"},{threshold:1,threshold_for_now:45,factor:1,unit:"second"},{threshold:45,factor:60,unit:"minute"},{threshold:150,factor:60,granularity:5,unit:"minute"},{threshold:1350,factor:1800,unit:"half-hour"},{threshold:2550,threshold_for_minute:3150,factor:3600,unit:"hour"},{threshold:73800,factor:y,unit:"day"},{threshold:475200,factor:7*y,unit:"week"},{threshold:2116800,factor:2630016,unit:"month"},{threshold:27615168,factor:31556952,unit:"year"}];function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S;if(0!==(n=D(n,i)).length){var r=P(e,t,n),o=n[r];if(-1!==r){if(o.granularity){var s=Math.round(Math.abs(e)/o.factor/o.granularity)*o.granularity;if(0===s&&r>0)return n[r-1]}return o}}}function R(e,t,i,n){var r;if(e&&(e.id||e.unit)&&(r=t["threshold_for_".concat(e.id||e.unit)]),void 0===r&&(r=t.threshold),"function"==typeof r&&(r=r(i,n)),e&&"number"!=typeof r){var o=b(r);throw new Error('Each step of a gradation must have a threshold defined except for the first one. Got "'.concat(r,'", ').concat(o,". Step: ").concat(JSON.stringify(t)))}return r}function P(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.abs(e)<R(i[n-1],i[n],t,e<0)?n-1:n===i.length-1?n:P(e,t,i,n+1)}function D(e,t){return e.filter((function(e){var i=e.unit;return!i||t.indexOf(i)>=0}))}function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){var i=e,n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var o;if(n){if(r>=i.length)break;o=i[r++]}else{if((r=i.next()).done)break;o=r.value}var s=o;if(t(s))return s;for(var a=s.split("-");a.length>1;)if(a.pop(),t(s=a.join("-")))return s}throw new Error("No locale data has been registered for any of the locales: ".concat(e.join(", ")))}function O(e){if(A())return Intl.DateTimeFormat.supportedLocalesOf(e)[0]}function A(){return"object"===("undefined"==typeof Intl?"undefined":k(Intl))&&"function"==typeof Intl.DateTimeFormat}var F={gradation:S,flavour:["long-convenient","long"],units:["now","minute","hour","day","week","month","year"]},T=[{factor:1,unit:"now"},{threshold:.5,factor:1,unit:"second"},{threshold:59.5,factor:60,unit:"minute"},{threshold:3570,factor:3600,unit:"hour"},{threshold:84600,factor:y,unit:"day"},{threshold:561600,factor:7*y,unit:"week"},{threshold:2116800,factor:2630016,unit:"month"},{threshold:30245184,factor:31556952,unit:"year"}];function I(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var M={},N={gradation:[function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){I(e,t,i[t])}))}return e}({},_(T,"minute"),{threshold:45}),_(T,"hour"),{threshold:84600,format:function(e,t){if(A())return M[t]||(M[t]={}),M[t].this_year||(M[t].this_year=new Intl.DateTimeFormat(t,{month:"short",day:"numeric"})),M[t].this_year.format(C(e))}},{threshold:function(e,t){return t?(new Date(new Date(e).getFullYear()+1,0).getTime()-e)/1e3:(e-new Date(new Date(e).getFullYear(),0).getTime())/1e3},format:function(e,t){if(A())return M[t]||(M[t]={}),M[t].other||(M[t].other=new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric"})),M[t].other.format(C(e))}}],flavour:["tiny","short-time","narrow","short"]},U={gradation:S,flavour:"long-time",units:["now","minute","hour","day","week","month","year"]},L={};function H(e){return L[e]}function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];$(this,e),"string"==typeof t&&(t=[t]),this.locale=x(t.concat(m.getDefaultLocale()),H),"undefined"!=typeof Intl&&Intl.NumberFormat&&(this.numberFormat=new Intl.NumberFormat(this.locale)),this.relativeTimeFormatCache=new w}var t,i,n;return t=e,(i=[{key:"format",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F;if("string"==typeof t)switch(t){case"twitter":t=N;break;case"time":t=U;break;default:t=F}var i=G(e),n=i.date,r=i.time,o=this.getLocaleData(t.flavour),s=o.flavour,a=o.localeData,c=t.now||Date.now(),l=(c-r)/1e3;if(t.custom){var u=t.custom({now:c,date:n,time:r,elapsed:l,locale:this.locale});if(void 0!==u)return u}var h=q(a,t.units);if(0===h.length)return console.error('Units "'.concat(h.join(", "),'" were not found in locale data for "').concat(this.locale,'".')),"";var d=E(l,c,h,t.gradation);if(!d)return"";if(d.format)return d.format(n||r,this.locale);var p=d.unit,f=d.factor,m=d.granularity,g=Math.abs(l)/f;if(m&&(g=Math.round(g/m)*m),"now"===p)return Q(a,-1*Math.sign(l));switch(s){case"long":case"short":case"narrow":return this.getFormatter(s).format(-1*Math.sign(l)*Math.round(g),p);default:return this.formatValue(-1*Math.sign(l)*Math.round(g),p,a)}}},{key:"formatValue",value:function(e,t,i){return this.getRule(e,t,i).replace("{0}",this.formatNumber(Math.abs(e)))}},{key:"getRule",value:function(e,t,i){var n=i[t];if("string"==typeof n)return n;var r=n[e<=0?"past":"future"]||n;if("string"==typeof r)return r;var o=H(this.locale).quantify,s=o&&o(Math.abs(e));return r[s=s||"other"]||r.other}},{key:"formatNumber",value:function(e){return this.numberFormat?this.numberFormat.format(e):String(e)}},{key:"getFormatter",value:function(e){return this.relativeTimeFormatCache.get(this.locale,e)||this.relativeTimeFormatCache.put(this.locale,e,new m(this.locale,{style:e}))}},{key:"getLocaleData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=H(this.locale);"string"==typeof e&&(e=[e]);var i=e=e.concat("long"),n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var o;if(n){if(r>=i.length)break;o=i[r++]}else{if((r=i.next()).done)break;o=r.value}var s=o;if(t[s])return{flavour:s,localeData:t[s]}}}}])&&j(t.prototype,i),n&&j(t,n),e}();function G(e){if(e.constructor===Date||"object"===W(t=e)&&"function"==typeof t.getTime)return{date:e,time:e.getTime()};var t;if("number"==typeof e)return{time:e};throw new Error("Unsupported relative time formatter input: ".concat(W(e),", ").concat(e))}function q(e,t){var i=Object.keys(e);return t&&(i=t.filter((function(e){return i.indexOf(e)>=0}))),(!t||t.indexOf("now")>=0)&&i.indexOf("now")<0&&e.second.current&&i.unshift("now"),i}function Q(e,t){return e.now?"string"==typeof e.now?e.now:t<=0?e.now.past:e.now.future:e.second.current}B.getDefaultLocale=m.getDefaultLocale,B.setDefaultLocale=m.setDefaultLocale,B.addLocale=function(e){!function(e){if(!e)throw new Error("[javascript-time-ago] No locale data passed.");L[e.locale]=e}(e),m.addLocale(e)},B.locale=B.addLocale}]);
//# sourceMappingURL=extension.js.map